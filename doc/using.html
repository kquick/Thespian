<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2025-02-03 Mon 18:20 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>[[https://thespianpy.com][@@html:&lt;img src="thesplogo2.png" alt="Thespian" width="50%" style="inline" /&gt;@@]] Actors User's Guide</title>
<meta name="author" content="Kevin Quick &lt;kq1quick@gmail.com&gt;" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<link rel="icon" type="image/png" href="/favicon.png" />
<link rel="stylesheet" type="text/css" href="styles/bigblow/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="styles/bigblow/css/bigblow.css"/>
<link rel="stylesheet" type="text/css" href="styles/bigblow/css/hideshow.css"/>
<script type="text/javascript" src="styles/bigblow/js/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="styles/bigblow/js/jquery-ui-1.10.2.min.js"></script>
<script type="text/javascript" src="styles/bigblow/js/jquery.localscroll-min.js"></script>
<script type="text/javascript" src="styles/bigblow/js/jquery.scrollTo-1.4.3.1-min.js"></script>
<script type="text/javascript" src="styles/bigblow/js/jquery.zclip.min.js"></script>
<script type="text/javascript" src="styles/bigblow/js/bigblow.js"></script>
<script type="text/javascript" src="styles/bigblow/js/hideshow.js"></script>
<script type="text/javascript" src="styles/lib/js/jquery.stickytableheaders.min.js"></script>
<link href="https://fonts.googleapis.com/css?family=Actor" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet">
<link href="thespian.css" rel="stylesheet" type="text/css"/>
<link href="thespian_using.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="content" class="content">
<h1 class="title"><a href="https://thespianpy.com"><img src="thesplogo2.png" alt="Thespian" width="50%" style="inline" /></a> Actors User's Guide</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#hH-f23d674d-ce24-48b4-8ad8-be8eb299e89e">1. Actor Overview</a>
<ul>
<li><a href="#hH-2889c112-6505-4b32-9dce-ac3e4a16ad11">1.1. Actors</a></li>
<li><a href="#hH-1348ab18-1a45-495b-ad27-84810a0b42f4">1.2. Actor Addresses</a></li>
<li><a href="#hH-4adf735c-f237-4a8e-98db-ec52567353ac">1.3. ActorSystem</a>
<ul>
<li><a href="#hH-27f1994d-f66e-4be7-a671-8eeeb81bbd4b">1.3.1. Different Implementations</a></li>
<li><a href="#hH-461f4dc3-4bd6-46fe-a33e-2ad2a8d82d53">1.3.2. Multiple Systems</a></li>
</ul>
</li>
<li><a href="#hH-c183ae4b-b397-433f-aa4e-69a6838ece38">1.4. External Communications</a></li>
<li><a href="#hH-f9386620-2d2e-4f28-b971-0f106881f583">1.5. Effects</a></li>
<li><a href="#hH-4f420b34-24a5-49a0-b70b-e34a925e7c17">1.6. Comparisons</a>
<ul>
<li><a href="#hH-357ddb80-542c-47d6-aa68-1964639777e9">1.6.1. Message Bus (Pub/Sub) Architecture</a></li>
<li><a href="#hH-aeed6732-198c-41a6-8d2b-45c3b57a120f">1.6.2. Logging Systems</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#hH-bfd7e2ce-64cc-4267-85ce-091a3fd29a8b">2. Using Thespian</a>
<ul>
<li><a href="#hH-0c5d14ea-e462-4a9c-b078-58341cc70e6d">2.1. Starting an Actor System</a></li>
<li><a href="#hH-41cd5450-c34f-4672-aafa-c96ed29c3f01">2.2. Actor Lifecycle</a>
<ul>
<li><a href="#hH-df9e99d0-dac0-4cbb-8852-6a3bb95c68f9">2.2.1. Creating a Top-Level Actor</a></li>
<li><a href="#hH-de8ad884-0d69-4734-abf5-eb3f1e4a8723">2.2.2. Creating an Actor</a></li>
<li><a href="#hH-e1d97e35-1d26-4277-b06b-239b6ab4d5d3">2.2.3. Killing an Actor</a></li>
<li><a href="#hH-3868571d-e754-42a2-840e-6629e817903b">2.2.4. Parent Actor</a></li>
<li><a href="#hH-fb0eba5e-9d12-4cfe-8e8c-fe77b6658065">2.2.5. Actor Failure</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#hH-bb3655d6-66df-42d5-9486-e81c8687e9d6">3. Guidelines for Actors and their messages</a></li>
<li><a href="#hH-330e09d9-4a98-4814-8a1c-6003ce6a7995">4. Thespian Actor Feature Extensions</a>
<ul>
<li><a href="#hH-3d280f21-4a99-416f-8cd7-9c9380a1c86c">4.1. Message Delivery</a>
<ul>
<li><a href="#hH-23ac66d7-ba55-40dc-ade8-a71e51c7a404">4.1.1. Message Mutability</a></li>
</ul>
</li>
<li><a href="#hH-5af075c1-73b1-4f7c-8515-e55ed96c03a9">4.2. Dead Letter Handling</a></li>
<li><a href="#hH-badcba33-bc39-4009-833f-07617ec72e12">4.3. Non-startable Actors</a></li>
<li><a href="#hH-62e20202-9bff-4455-968e-73fee0b9f66a">4.4. PoisonMessage Returns</a></li>
<li><a href="#hH-91e3dc4e-af22-4076-94ee-43f60458f0e0">4.5. Top-Level Actors</a></li>
<li><a href="#hH-2d5ef9c7-2132-45f9-b6eb-6f2729f5b232">4.6. Named Actors</a></li>
<li><a href="#hH-9cc1acd4-7f35-44ac-94fc-0326dc87a7a5">4.7. Timer Messages</a></li>
<li><a href="#hH-94edef18-154e-4847-864f-027dff4f6e0a">4.8. Watching File Descriptors</a>
<ul>
<li><a href="#hH-df96b2ed-e292-4ded-a614-30cfa1557858">4.8.1. Blocking Actors</a></li>
</ul>
</li>
<li><a href="#hH-19cf92bf-a6ae-492c-844c-b0831c108a3a">4.9. Actor Troupes</a></li>
<li><a href="#hH-a17e6c70-5592-4d06-b818-bd25350c4c53">4.10. ActorSystem Capabilities</a></li>
<li><a href="#hH-3c8aa454-9a21-4d24-a623-ad86bfd4f5a7">4.11. Other Actor Systems</a>
<ul>
<li><a href="#hH-bd57f29e-4a5e-4725-9ced-7e0c5fa5bcbd">4.11.1. Convention Establishment</a></li>
<li><a href="#hH-0500ead3-28ea-440c-9ad6-56cb9fbdd648">4.11.2. Convention Administrator Communications</a></li>
<li><a href="#hH-33d27852-9cfd-4583-b0c0-5c05f2cb8e5a">4.11.3. Multi-system Global Name support</a></li>
</ul>
</li>
<li><a href="#hH-5e670e59-8334-477e-a9d2-0c2dc39d82dd">4.12. Performance</a></li>
<li><a href="#hH-ce55494c-dd7a-4258-a1e8-b090c3bbb1e6">4.13. Logging</a>
<ul>
<li><a href="#h:3ef538e8-a989-481b-992d-a9d165a2ce26">4.13.1. Logging Level Management</a></li>
<li><a href="#h:46850001-c8cf-42e6-90cf-dd7236ae9436">4.13.2. Logging Transmit Overruns</a></li>
<li><a href="#hH-856a7ffe-676b-42a9-95eb-bd89a5810f53">4.13.3. Thespian Internals Logging</a></li>
</ul>
</li>
<li><a href="#hH-955ec990-a267-4d08-8f4d-5f980c777173">4.14. Actor Code Distribution</a></li>
</ul>
</li>
<li><a href="#hH-c3ba9430-5229-44ad-bbd5-ff5426e03e5e">5. Actor API</a>
<ul>
<li><a href="#hH-584dd408-9496-4f6f-8a86-0f0236f73893">5.1. myAddress</a></li>
<li><a href="#hH-f89540de-f853-42e3-9d52-23b1f84a251e">5.2. receiveMessage</a>
<ul>
<li><a href="#hH-c7c7275c-fa32-4466-9d1a-e888f993e67c">5.2.1. Return Value</a></li>
</ul>
</li>
<li><a href="#hH-3663d87d-8a2f-485b-aeef-c6e9cf418b4c">5.3. createActor</a>
<ul>
<li><a href="#hH-c5ae8d61-9358-463d-b0f0-d15ae0246059">5.3.1. globalName</a></li>
<li><a href="#hH-57dd8b71-0f60-4ad2-9628-08edf2c5b00c">5.3.2. Actor Creation Gotchas</a></li>
</ul>
</li>
<li><a href="#hH-28cb6d46-fa93-4efd-bc83-88bbbd50df66">5.4. send</a></li>
<li><a href="#hH-b2b4b63a-c256-4793-8591-1ce8dbd87131">5.5. wakeupAfter</a></li>
<li><a href="#hH-4022d522-cdc6-487a-b5d5-5d992572c531">5.6. handleDeadLetters</a></li>
<li><a href="#hH-b9f7a2f0-7d2a-4cc0-8241-1fee7c62c44e">5.7. notifyOnSystemRegistrationChanges</a></li>
<li><a href="#hH-5ae05479-5a6d-4f01-bd7d-c4f544f7b98a">5.8. registerSourceAuthority</a></li>
<li><a href="#hH-731cff6e-674d-4341-bd92-80a08113d5df">5.9. loadActorSource</a></li>
<li><a href="#hH-02eaa317-996a-419b-b9e5-462a28a749c0">5.10. unloadActorSource</a></li>
<li><a href="#hH-460d04d8-3961-43c4-a4c3-8282c2e4a892">5.11. notifyOnSourceAvailability</a></li>
<li><a href="#hH-0e9f4a6a-3083-40fa-a75b-ced37d70eef0">5.12. actorSystemCapabilityCheck</a>
<ul>
<li><a href="#hH-3bafc1e2-9e3d-4073-8e75-c01ad792b5be">5.12.1. requireCapability decorator</a></li>
</ul>
</li>
<li><a href="#hH-1dc4362f-78dd-4adf-833c-d7bebda07ef8">5.13. updateCapability</a></li>
<li><a href="#hH-956e30d5-c035-4e1e-86cb-73332e28d8d4">5.14. preRegisterRemoteSystem</a></li>
<li><a href="#hH-ce801678-bcff-497d-be2a-439cb34fc519">5.15. deRegisterRemoteSystem</a></li>
<li><a href="#hH-9e800ed1-ed40-4ff3-8445-f795719f6218">5.16. actorSystemShutdown</a></li>
<li><a href="#hH-2f5b52bd-72b8-41eb-b879-809d174c0e30">5.17. ActorTypeDispatcher</a>
<ul>
<li><a href="#h:96440ac7-3db5-4cb4-9496-6c8c46075f14">5.17.1. Derived Classes</a></li>
<li><a href="#h:d92333c1-bb53-48d1-8323-f6013e479750">5.17.2. Unrecognized Messages</a></li>
<li><a href="#hH-e58ce3a1-df40-4d3f-bc1f-e7743e3c1dc1">5.17.3. Type Handling Deferral</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#hH-7d2b4986-95d3-4460-9d19-ea0dcdb34fca">6. ActorSystem API</a>
<ul>
<li><a href="#hH-a91e6169-660d-4df0-af13-15b3ad5e63bc">6.1. Exceptions</a></li>
<li><a href="#hH-f71b7bfa-c57b-4716-a2c7-ad83a2ed3582">6.2. ActorSystem</a></li>
<li><a href="#hH-654a6c81-b326-4c0a-98bc-638ac5ce631f">6.3. ActorSystem.shutdown</a></li>
<li><a href="#hH-a565af1b-aabb-4336-a51d-7505c072c319">6.4. ActorSystem.createActor</a></li>
<li><a href="#hH-a5dcf9d2-7bda-43c7-ab44-86265992e972">6.5. tell</a></li>
<li><a href="#hH-8e52624b-cda1-4218-bc9f-693cf06b0758">6.6. ask</a>
<ul>
<li><a href="#hH-b660216f-003b-4041-93cb-566be7edf72c">6.6.1. Gotchas</a></li>
</ul>
</li>
<li><a href="#hH-c68f8ef8-94e9-46d6-8e67-634d04c16562">6.7. listen</a></li>
<li><a href="#actorsystem.private">6.8. private</a></li>
<li><a href="#hH-bf228654-b542-48f0-a5b5-78bc883528b9">6.9. updateCapability</a></li>
<li><a href="#hH-73b564d2-faa3-4fc8-bfdf-5362626c03be">6.10. loadActorSource</a>
<ul>
<li><a href="#hH-e23490e4-d720-4e84-9b9a-e768fa3e717d">6.10.1. Source Loading Issues</a></li>
<li><a href="#hH-b26e4f60-d3fa-40b1-bc33-bb20b61ff2d4">6.10.2. Security Considerations</a></li>
</ul>
</li>
<li><a href="#hH-3e2f292f-2797-46d7-9fc6-48c1619d4bec">6.11. unloadActorSource</a></li>
</ul>
</li>
<li><a href="#hH-b889aca8-b50d-4920-8496-34b1420cf664">7. ActorSystem Messages</a>
<ul>
<li><a href="#hH-407c4c79-2a05-442d-b6e8-5bf7c2f2d068">7.1. PoisonMessage</a>
<ul>
<li><a href="#hH-7655532a-ec5a-49c0-9f4e-0b4207f21080">7.1.1. Attributes</a></li>
</ul>
</li>
<li><a href="#hH-32b3df34-552e-4398-83bb-b78f3f6483bc">7.2. WakeupMessage</a>
<ul>
<li><a href="#hH-865814f4-6d08-4657-bb89-c3be8b8a9453">7.2.1. Attributes</a></li>
</ul>
</li>
<li><a href="#hH-8a46cfae-7ccc-407a-91c1-d4301b7a653c">7.3. WatchMessage</a>
<ul>
<li><a href="#hH-a4719aee-2054-466c-a013-03b6938b084e">7.3.1. Attributes</a></li>
</ul>
</li>
<li><a href="#hH-7e6106e4-a631-47a4-9d22-3fd63f7e1951">7.4. ActorExitRequest</a>
<ul>
<li><a href="#hH-8155fe0d-ad17-4677-b606-f830c6f9f249">7.4.1. Attributes</a></li>
</ul>
</li>
<li><a href="#hH-ed408390-5a74-4955-9f7d-a84e87595459">7.5. ChildActorExited</a>
<ul>
<li><a href="#hH-c32348b6-fed3-4ff1-bf95-3cf491049518">7.5.1. Attributes</a></li>
</ul>
</li>
<li><a href="#hH-e3d4bfa0-7fad-4622-b707-8f67e4f75d5c">7.6. DeadEnvelope</a>
<ul>
<li><a href="#hH-fc0fb45a-a981-42ce-9922-705dabbbda37">7.6.1. Attributes</a></li>
</ul>
</li>
<li><a href="#hH-f311fc02-d355-4d68-b9af-958404637e57">7.7. ActorSystemConventionUpdate</a>
<ul>
<li><a href="#hH-a1cda86c-ca86-4aaa-bcb5-935e92435647">7.7.1. Attributes</a></li>
</ul>
</li>
<li><a href="#hH-3119580d-80a6-4061-a217-1b2b21014172">7.8. ValidateSource</a>
<ul>
<li><a href="#hH-d6db3148-7664-4e50-9061-6733fe5d3a3f">7.8.1. Attributes</a></li>
</ul>
</li>
<li><a href="#hH-1db8e94e-ca54-4817-b120-b4c51c680cdd">7.9. ValidatedSource</a>
<ul>
<li><a href="#hH-92e91efa-fdc2-42bb-94f8-8a329618214c">7.9.1. Attributes</a></li>
</ul>
</li>
<li><a href="#hH-7cc41555-6b60-4844-8cea-0ec3714cf8f8">7.10. LoadedSource</a>
<ul>
<li><a href="#hH-54e4613a-3c85-4d1e-a81d-0dd348af4199">7.10.1. Attributes</a></li>
</ul>
</li>
<li><a href="#hH-72c2180e-97c4-4209-9f09-031069cb5cbe">7.11. UnloadedSource</a>
<ul>
<li><a href="#hH-3b58b48d-4d73-45c1-9486-3f6b8eb80d59">7.11.1. Attributes</a></li>
</ul>
</li>
<li><a href="#hH-6428fa90-8749-4777-a0b1-752ec5eb1650">7.12. Thespian_StatusReq</a>
<ul>
<li><a href="#hH-02212902-4a42-4f1e-ae6a-59464043ff50">7.12.1. Attributes</a></li>
</ul>
</li>
<li><a href="#hH-704cb0e0-30c0-4e30-82cb-52718839704f">7.13. Thespian_SystemStatus</a></li>
<li><a href="#hH-1a0b5d02-e4b6-4c8c-9687-6e5f939d3827">7.14. Thespian_ActorStatus</a></li>
</ul>
</li>
<li><a href="#hH-d4e592db-8bab-45bd-9643-e952510bd7dc">8. Patterns and Helpers</a>
<ul>
<li><a href="#hH-c796bc0d-a150-4fb9-8918-58f470813175">8.1. Actor Troupe Support</a></li>
<li><a href="#hH-99783a4a-183f-4b69-8910-014d01edbf1c">8.2. Transient Actors</a></li>
<li><a href="#h:5f80e194-ab38-406e-b077-984496b37073">8.3. Initialization Messages</a></li>
<li><a href="#h:523e1df1-8cab-44dc-a46b-f7638dded176">8.4. Thespian Director</a></li>
<li><a href="#h:108786e0-6ddd-46c3-974b-ffa353c4f1f1">8.5. RunCommand support</a></li>
</ul>
</li>
<li><a href="#hH-2a5fa63d-e6eb-43b9-bea8-47223b27544e">9. ActorSystem Implementations</a>
<ul>
<li><a href="#hH-2a4bcad4-9fe0-4399-86d4-4bbf0ba0acb7">9.1. Common Capabilities</a></li>
<li><a href="#hH-924dc0fe-c15b-491e-a6d1-8b88683d4c0d">9.2. simpleSystemBase</a></li>
<li><a href="#hH-59ea5ca7-a167-4d51-bd1b-78119eab6df6">9.3. multiprocQueueBase</a>
<ul>
<li><a href="#h:815365aa-17f0-46a0-a6c9-def03eb7c5e3">9.3.1. Potential issues</a></li>
</ul>
</li>
<li><a href="#hH-9d33a877-b4f0-4012-9510-442d81b0837c">9.4. multiprocTCPBase</a>
<ul>
<li><a href="#h:ca576db1-3923-4db4-aaad-e6c41730f552">9.4.1. Configuration Environment Variables</a></li>
</ul>
</li>
<li><a href="#hH-25cfa213-13a6-4265-8828-86ffffed0e12">9.5. multiprocUDPBase</a></li>
</ul>
</li>
<li><a href="#h:f3cb3837-435b-4551-91bc-1913af405a67">10. Potential Concerns and FAQ</a></li>
<li><a href="#hH-23bdc6e2-a5c4-4228-a75c-fb213f537732">11. Deploying Actor-based Projects</a>
<ul>
<li><a href="#hH-7e109f00-76ff-49a1-b307-2166154c3921">11.1. Overall Security Considerations</a>
<ul>
<li><a href="#hH-fcabc7dd-327f-47cf-bcb7-5dd4d202ebdc">11.1.1. Security Scenarios</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>


<div id="outline-container-hH-f23d674d-ce24-48b4-8ad8-be8eb299e89e" class="outline-2">
<h2 id="hH-f23d674d-ce24-48b4-8ad8-be8eb299e89e"><span class="section-number-2">1.</span> Actor Overview</h2>
<div class="outline-text-2" id="text-hH-f23d674d-ce24-48b4-8ad8-be8eb299e89e">
</div>

<div id="outline-container-hH-2889c112-6505-4b32-9dce-ac3e4a16ad11" class="outline-3">
<h3 id="hH-2889c112-6505-4b32-9dce-ac3e4a16ad11"><span class="section-number-3">1.1.</span> Actors</h3>
<div class="outline-text-3" id="text-hH-2889c112-6505-4b32-9dce-ac3e4a16ad11">
<p>
At the core, an Actor system is simple.  An Actor is a standalone
entity that receives messages from other Actors and does one of three
things:
</p>

<ol class="org-ol">
<li>Changes internal state</li>
<li>Creates other Actors</li>
<li>Sends a finite number of messages to other Actors</li>
</ol>

<p>
Importantly, an Actor cannot access internals of other Actors, and it
should not access any globals.  The Actor operates solely on
information passed to the Actor via a message or else generated
internally by the Actor itself.
</p>

<p>
Actors may only communicate with other Actors by sending messages to
those Actors, using known addresses for those target Actors.
</p>

<p>
Note that messages are unidirectional: there is no required
acknowledgement from an Actor that it has received a message.  Actors
are free to exchange whatever messages their implementation dictates
however, including sending acknowledgement messages back to the
sender.
</p>

<p>
In practice, an Actor receiving a message will perform some sort of
application-specific processing as a result.
</p>
</div>
</div>

<div id="outline-container-hH-1348ab18-1a45-495b-ad27-84810a0b42f4" class="outline-3">
<h3 id="hH-1348ab18-1a45-495b-ad27-84810a0b42f4"><span class="section-number-3">1.2.</span> Actor Addresses</h3>
<div class="outline-text-3" id="text-hH-1348ab18-1a45-495b-ad27-84810a0b42f4">
<p>
All Actors have an Address which identifies them uniquely within the
ActorSystem.  The ActorSystem assigns an Address to an Actor and the
Actor should treat that Address as an opaque value.
</p>

<p>
Actors will communicate with other Actors using the ActorAddress of
the other actors.  ActorAddress values cannot be synthesized.  An
Actor obtains the ActorAddress of other actors in one of two ways:
</p>

<ol class="org-ol">
<li>The return value from an Actor create request is an ActorAddress</li>
<li>Receiving an ActorAddress in a message from another Actor</li>
</ol>

<p>
The ActorSystem determines the actual value of an ActorAddress and the
value varies with the implementation of the ActorSystem and the
transport mechanism used.  Actors may print the string form of
ActorAddresses, and they may compare ActorAddresses for equality or
inequality and use them as hash values (e.g. for dictionary keys), but
they should not otherwise depend on or attempt to utilize the value of
an ActorAddress.
</p>

<p>
An Actor can refer to its own ActorAddress using the <code>.myAddress</code>
property.
</p>
</div>
</div>

<div id="outline-container-hH-4adf735c-f237-4a8e-98db-ec52567353ac" class="outline-3">
<h3 id="hH-4adf735c-f237-4a8e-98db-ec52567353ac"><span class="section-number-3">1.3.</span> ActorSystem</h3>
<div class="outline-text-3" id="text-hH-4adf735c-f237-4a8e-98db-ec52567353ac">
<p>
The ActorSystem is the framework within which the Actors reside.  The
ActorSystem is responsible for Actor lifecycle management (creating
and terminating Actors) and message delivery functions.
</p>


<div id="org71bc4d2" class="figure">
<p><img src="fig1.png" alt="fig1.png" />
</p>
</div>
</div>


<div id="outline-container-hH-27f1994d-f66e-4be7-a671-8eeeb81bbd4b" class="outline-4">
<h4 id="hH-27f1994d-f66e-4be7-a671-8eeeb81bbd4b"><span class="section-number-4">1.3.1.</span> Different Implementations</h4>
<div class="outline-text-4" id="text-hH-27f1994d-f66e-4be7-a671-8eeeb81bbd4b">
<p>
There are multiple different types of ActorSystem implementations.
Switching from one system to another can does not require any
changes to the Actors that run in those systems: the ActorSystem
cleanly abstracts the scheduling and message delivery to allow the
Actors to be oblivious to those elements.
</p>

<p>
Each implementation may require a different type of addressing, but
as described previously in <a href="#hH-1348ab18-1a45-495b-ad27-84810a0b42f4">Actor Addresses</a> the Actors themselves
should treat the ActorAddress objects as opaque.  In addition, an
Actor cannot generate an ActorAddress; the Actor receives an
ActorAddress as a result of creating an Actor or in a message
received from another Actor.
</p>

<p>
Not all implementations are equivalent, however.  Although all
ActorSystem implementations must support the standard Actor API for
Actors to use, some implementations do not support specific features
or functionality, and some implementations are not suitable for use
with the type of applications the Actors implement.
</p>

<p>
As an example, some ActorSystems will run Actors as multiple
threads, whereas other ActorSystems will run Actors as multiple
processes.
</p>

<p>
Another example is an ActorSystem that uses TCP networking to
communicate between Actors v.s. a system that uses local
shared-memory queue structures.
</p>

<p>
The <a href="#hH-2a5fa63d-e6eb-43b9-bea8-47223b27544e">ActorSystem Implementations</a> section provides detailed
information about the known ActorSystem implementations including
their level of feature support and any known issues.
</p>
</div>
</div>

<div id="outline-container-hH-461f4dc3-4bd6-46fe-a33e-2ad2a8d82d53" class="outline-4">
<h4 id="hH-461f4dc3-4bd6-46fe-a33e-2ad2a8d82d53"><span class="section-number-4">1.3.2.</span> Multiple Systems</h4>
<div class="outline-text-4" id="text-hH-461f4dc3-4bd6-46fe-a33e-2ad2a8d82d53">
<p>
There can be more than one ActorSystem running on the current host
system, and there can be ActorSystems running on other host systems
that can coordinate activities with the current ActorSystem.
</p>

<p>
Actors can be created within "remote" ActorSystems as well as the
local ActorSystem.  This locality flexibility does not affect each
Actor implementation at all: the ActorAddress of an Actor can
indicate either a remote or local Actor but the ActorAddress itself
is opaque to the Actor.
</p>


<div id="org3184f05" class="figure">
<p><img src="fig2.png" alt="fig2.png" />
</p>
</div>

<p>
This facility allows for location independence and also provides for
essentially unlimited scalability of the underlying support environment.
</p>
</div>
</div>
</div>

<div id="outline-container-hH-c183ae4b-b397-433f-aa4e-69a6838ece38" class="outline-3">
<h3 id="hH-c183ae4b-b397-433f-aa4e-69a6838ece38"><span class="section-number-3">1.4.</span> External Communications</h3>
<div class="outline-text-3" id="text-hH-c183ae4b-b397-433f-aa4e-69a6838ece38">
<p>
Actors run in an ActorSystem and communicate with each other using the
message sending capability, but it is also typically necessary for the
external world to communicate with Actors to initiate activity by
those Actors and obtain the corresponding results.  External
applications use the following ActorSystem operations to communicate
with Actors in that system (these operations are not intended for use
by Actors themselves):
</p>

<ul class="org-ul">
<li><b>tell</b> &#x2013; sends a message to a target Actor (as specified by the
target Actor's ActorAddress)</li>

<li><b>ask</b> &#x2013; sends a message to a target Actor and waits for the
Actor to send a response message.</li>

<li><b>createActor</b> &#x2013; creates a new Actor.  There is no <a href="#hH-3868571d-e754-42a2-840e-6629e817903b">Parent Actor</a>
for the newly created Actor; this Actor is referred to as a "top-level
Actor" and it is managed by the ActorSystem itself.  No
other Actor will be notified if the top-level Actor exits.</li>
</ul>

<p>
To the Actor's themselves the messages delivered via the <code>tell</code> or
<code>ask</code> operations appear to have come from another Actor with an
ActorAddress.  The Actor is unaware that these messages originated
from external code.
</p>


<div id="org558ace1" class="figure">
<p><img src="fig3.png" alt="fig3.png" />
</p>
</div>

<p>
The <a href="#hH-7d2b4986-95d3-4460-9d19-ea0dcdb34fca">ActorSystem API</a> section has more details on the ActorSystem
operations.
</p>
</div>
</div>

<div id="outline-container-hH-f9386620-2d2e-4f28-b971-0f106881f583" class="outline-3">
<h3 id="hH-f9386620-2d2e-4f28-b971-0f106881f583"><span class="section-number-3">1.5.</span> Effects</h3>
<div class="outline-text-3" id="text-hH-f9386620-2d2e-4f28-b971-0f106881f583">
<p>
Using an Actor system like Thespian tends to be a transformative
experience in code generation.  Aspects which were previously
difficult to work with (multi-processing, concurrency, inter-process
communications and networking, scalability, fault tolerance and
recovery, etc) are all handled by the Actor System itself, allowing
the Actors to focus on the primary needs of the application itself.
</p>
</div>
</div>

<div id="outline-container-hH-4f420b34-24a5-49a0-b70b-e34a925e7c17" class="outline-3">
<h3 id="hH-4f420b34-24a5-49a0-b70b-e34a925e7c17"><span class="section-number-3">1.6.</span> Comparisons</h3>
<div class="outline-text-3" id="text-hH-4f420b34-24a5-49a0-b70b-e34a925e7c17">
</div>

<div id="outline-container-hH-357ddb80-542c-47d6-aa68-1964639777e9" class="outline-4">
<h4 id="hH-357ddb80-542c-47d6-aa68-1964639777e9"><span class="section-number-4">1.6.1.</span> Message Bus (Pub/Sub) Architecture</h4>
<div class="outline-text-4" id="text-hH-357ddb80-542c-47d6-aa68-1964639777e9">
<p>
The Actor model provides a higher level of abstraction than a Message
Bus architecture (also known as a "pub/sub" architecture).  An Actor
system could be implemented on top of a message-bus architecture; the
Actors themselves are unaware of this implementation method.
</p>
</div>
</div>

<div id="outline-container-hH-aeed6732-198c-41a6-8d2b-45c3b57a120f" class="outline-4">
<h4 id="hH-aeed6732-198c-41a6-8d2b-45c3b57a120f"><span class="section-number-4">1.6.2.</span> Logging Systems</h4>
<div class="outline-text-4" id="text-hH-aeed6732-198c-41a6-8d2b-45c3b57a120f">
<p>
Log-based architectures (e.g. Kafka) are fundamentally "pub/sub"
architectures that use persistent storage for the published messages.
As noted in the <a href="#hH-357ddb80-542c-47d6-aa68-1964639777e9">Message Bus (Pub/Sub) Architecture</a>, the Actor model is
a higher-level abstraction layer that encompasses the pub/sub
functionality. The Actor model therefore also abstracts a Logging
System with the exception of the persistent storage/replay
functionality of the latter.
</p>

<p>
It is possible to implement message persistence and/or replay
functionality for an Actor system by using Actors specifically
designed to provide this functionality.  The Actor model can thus
easily mimic a Logging System.
</p>
</div>
</div>
</div>
</div>


<div id="outline-container-hH-bfd7e2ce-64cc-4267-85ce-091a3fd29a8b" class="outline-2">
<h2 id="hH-bfd7e2ce-64cc-4267-85ce-091a3fd29a8b"><span class="section-number-2">2.</span> Using Thespian</h2>
<div class="outline-text-2" id="text-hH-bfd7e2ce-64cc-4267-85ce-091a3fd29a8b">
<p>
In order to use Thespian, it must be installed in the current Python
environment.  Once installed, all Thespian features are available
within Python by simply importing the <code>actors</code> module from the <code>thespian</code>
package:
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-operator">&gt;&gt;&gt;</span> <span class="org-keyword">import</span> thespian
</pre>
</div>
</div>

<div id="outline-container-hH-0c5d14ea-e462-4a9c-b078-58341cc70e6d" class="outline-3">
<h3 id="hH-0c5d14ea-e462-4a9c-b078-58341cc70e6d"><span class="section-number-3">2.1.</span> Starting an Actor System</h3>
<div class="outline-text-3" id="text-hH-0c5d14ea-e462-4a9c-b078-58341cc70e6d">
<p>
An ActorSystem is created simply by instantiating an <code>ActorSystem()</code>
object and specifying the type or "base" of the ActorSystem, as well
as any optional capabilities of that system.  For example, to startup
an ActorSystem using the "multiprocTCPBase":
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-operator">&gt;&gt;&gt;</span> <span class="org-variable-name">asys</span> <span class="org-operator">=</span> ActorSystem(<span class="org-string">'multiprocTCPBase'</span>)
</pre>
</div>

<p>
More details on the explicit parameters for this call are found in the
<a href="#hH-f71b7bfa-c57b-4716-a2c7-ad83a2ed3582">ActorSystem</a> section of this document and the known system bases are
describe in the <a href="#hH-2a5fa63d-e6eb-43b9-bea8-47223b27544e">ActorSystem Implementations</a> section.
</p>

<p>
Once created, the running ActorSystem is (by default) a singleton
instance for the current process.  This means that subsequent
references can either use the direct reference (e.g. <code>asys</code> in the example
above) or another <code>ActorSystem()</code> instantiation with no parameters.
</p>
</div>
</div>


<div id="outline-container-hH-41cd5450-c34f-4672-aafa-c96ed29c3f01" class="outline-3">
<h3 id="hH-41cd5450-c34f-4672-aafa-c96ed29c3f01"><span class="section-number-3">2.2.</span> Actor Lifecycle</h3>
<div class="outline-text-3" id="text-hH-41cd5450-c34f-4672-aafa-c96ed29c3f01">
<p>
Actors are created on demand and then persist until they receive a
request to exit.  Actors in a multiprocess System Base are independent
of the process that created them and can outlive that process; Actors
in a multi-threaded or synchronous System Base exist within the
lifetime of the process itself.
</p>

<p>
Actors exit when explicitly requested to exit, or when the ActorSystem
itself is shutdown.
</p>
</div>

<div id="outline-container-hH-df9e99d0-dac0-4cbb-8852-6a3bb95c68f9" class="outline-4">
<h4 id="hH-df9e99d0-dac0-4cbb-8852-6a3bb95c68f9"><span class="section-number-4">2.2.1.</span> Creating a Top-Level Actor</h4>
<div class="outline-text-4" id="text-hH-df9e99d0-dac0-4cbb-8852-6a3bb95c68f9">
<p>
Actors can be created by other Actors or by external applications
making a request to the running ActorSystem.  In the former case, the
Actor making the request becomes the "<a href="#hH-3868571d-e754-42a2-840e-6629e817903b">Parent Actor</a>" of the newly
created Actor, whereas there is no parent in the latter case and the
newly created actor is therefore referred to as a "Top-Level" Actor.
</p>

<p>
The <a href="#hH-a565af1b-aabb-4336-a51d-7505c072c319">ActorSystem.createActor</a> call creates a Top-Level Actor:
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-operator">&gt;&gt;&gt;</span> <span class="org-keyword">class</span> <span class="org-type">MyFirstActor</span>(Actor):
...     <span class="org-keyword">def</span> <span class="org-function-name">receiveMessage</span>(<span class="org-keyword">self</span>, message, sender):
...         <span class="org-keyword">pass</span>
...
<span class="org-operator">&gt;&gt;&gt;</span> <span class="org-variable-name">mfa_addr</span> <span class="org-operator">=</span> asys.createActor(MyFirstActor)
</pre>
</div>

<p>
The result of the call is the ActorAddress associated with the Actor.
The ActorSystem's <a href="#hH-8e52624b-cda1-4218-bc9f-693cf06b0758">ask</a>() or <a href="#hH-a5dcf9d2-7bda-43c7-ab44-86265992e972">tell</a>() methods use this ActorAddress to
communicate with the created Actor.
</p>
</div>
</div>

<div id="outline-container-hH-de8ad884-0d69-4734-abf5-eb3f1e4a8723" class="outline-4">
<h4 id="hH-de8ad884-0d69-4734-abf5-eb3f1e4a8723"><span class="section-number-4">2.2.2.</span> Creating an Actor</h4>
<div class="outline-text-4" id="text-hH-de8ad884-0d69-4734-abf5-eb3f1e4a8723">
<p>
Within the ActorSystem an Actor can create another Actor by making
a request to the ActorSystem. This is done by calling the
<a href="#hH-3663d87d-8a2f-485b-aeef-c6e9cf418b4c">createActor</a>() method on its
own instance:
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-operator">&gt;&gt;&gt;</span> <span class="org-keyword">class</span> <span class="org-type">Support</span>(Actor):
...     <span class="org-keyword">def</span> <span class="org-function-name">receiveMessage</span>(<span class="org-keyword">self</span>, message, sender):
...         <span class="org-keyword">pass</span>
...
<span class="org-operator">&gt;&gt;&gt;</span> <span class="org-keyword">class</span> <span class="org-type">MyFirstActor</span>(Actor):
...     <span class="org-keyword">def</span> <span class="org-function-name">receiveMessage</span>(<span class="org-keyword">self</span>, message, sender):
...         <span class="org-keyword">if</span> message <span class="org-operator">==</span> <span class="org-string">'create another actor'</span>:
...             <span class="org-variable-name">newActor</span> <span class="org-operator">=</span> <span class="org-keyword">self</span>.createActor(Support)
</pre>
</div>

<p>
As with the creation of a Top-Level actor, the <code>createActor()</code> method
of class Actor creates a new Actor instance and returns the ActorAddress
associated with it.  The creating Actor can then send messages to the new
Actor via its own <a href="#hH-28cb6d46-fa93-4efd-bc83-88bbbd50df66">send</a>()
method while passing the ActorAddress of the new Actor
(which is <code>newActor</code> in the example above) as the target address.
The creating Actor becomes the
<a href="#hH-3868571d-e754-42a2-840e-6629e817903b">Parent Actor</a> of the created Actor.
</p>
</div>
</div>

<div id="outline-container-hH-e1d97e35-1d26-4277-b06b-239b6ab4d5d3" class="outline-4">
<h4 id="hH-e1d97e35-1d26-4277-b06b-239b6ab4d5d3"><span class="section-number-4">2.2.3.</span> Killing an Actor</h4>
<div class="outline-text-4" id="text-hH-e1d97e35-1d26-4277-b06b-239b6ab4d5d3">
<p>
Actors normally continue to exist and handle messages until they are
explicitly killed.  An Actor can be killed by sending it an
<a href="#hH-7e6106e4-a631-47a4-9d22-3fd63f7e1951">ActorExitRequest</a> message.
</p>

<p>
The Actor will receive that message directly on its
<code>.receiveMessage()</code> method, which allows the Actor to make any
preparations for its demise, but it cannot refuse to exit and when it
returns from <code>.receiveMessage()</code>, the ActorSystem will kill the
Actor.
</p>

<p>
A killed Actor's Address is dead-lettered; any subsequent messages
sent to the Actor's address will be handled as described in <a href="#hH-5af075c1-73b1-4f7c-8515-e55ed96c03a9">Dead
Letter Handling</a>.
</p>
</div>
</div>


<div id="outline-container-hH-3868571d-e754-42a2-840e-6629e817903b" class="outline-4">
<h4 id="hH-3868571d-e754-42a2-840e-6629e817903b"><span class="section-number-4">2.2.4.</span> Parent Actor</h4>
<div class="outline-text-4" id="text-hH-3868571d-e754-42a2-840e-6629e817903b">
<p>
An Actor which creates other Actors automatically becomes the
"Parent" of the created Actor(s).  In the example in the <a href="#hH-de8ad884-0d69-4734-abf5-eb3f1e4a8723">Creating
an Actor</a> section above, the MyFirstActor Actor is the parent of
any created Supporting Actor.
</p>

<p>
The ActorSystem notifies the Parent Actor when any of its child
Actors exit.  Child Actors are killed when the Parent dies unless
the Parent indicates that the ActorExitRequest should not
propagate to the children (see method
<a href="#hH-7e6106e4-a631-47a4-9d22-3fd63f7e1951">notRecursive</a>()).
</p>

<p>
Notification of exited children is done via the <code>ChildActorExited</code>
message.  This message has the following attributes:
</p>

<ul class="org-ul">
<li><code>.childAddress</code> to specify the ActorAddress of the child</li>
</ul>
</div>
</div>

<div id="outline-container-hH-fb0eba5e-9d12-4cfe-8e8c-fe77b6658065" class="outline-4">
<h4 id="hH-fb0eba5e-9d12-4cfe-8e8c-fe77b6658065"><span class="section-number-4">2.2.5.</span> Actor Failure</h4>
<div class="outline-text-4" id="text-hH-fb0eba5e-9d12-4cfe-8e8c-fe77b6658065">
<p>
If the Actor code handling a message fails by throwing an
exception, the ActorSystem will automatically catch that exception.
The message is automatically re-issued to the Actor to give it a
second chance to handle the message.  If the second attempt also
throws an exception, the message is returned via a <code>PoisonMessage</code>
to the caller and that Actor continues with the next message.  For
this reason, Actor-based code is typically much simpler than
conventional code because it does not have the overhead of lots of
exception checking and error condition handling.
</p>

<p>
If a process-based Actor process exits (e.g. via a signal or
un-catcheable exception) then the Thespian Actor System will
(eventually) detect the exited process and deliver a
<code>ChildActorExited</code> message to the parent Actor.  It is up to the
parent Actor to determine what to do in this situation, but a
common response is to simply create another instance of that exited
child Actor.
</p>

<p>
When writing Actor code, the general philosophy is "fail early";
the ActorSystem itself will restart the Actor in the event of a
failure and possibly retry the message or abort that specific
message.  See <a href="#hH-62e20202-9bff-4455-968e-73fee0b9f66a">PoisonMessage Returns</a> for more details.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-hH-bb3655d6-66df-42d5-9486-e81c8687e9d6" class="outline-2">
<h2 id="hH-bb3655d6-66df-42d5-9486-e81c8687e9d6"><span class="section-number-2">3.</span> Guidelines for Actors and their messages</h2>
<div class="outline-text-2" id="text-hH-bb3655d6-66df-42d5-9486-e81c8687e9d6">
<ul class="org-ul">
<li>The ActorSystemMessage class is the base class of all ActorSystem
internal messages.  Messages sent by Actors should not subclass
ActorSystemMessage, but Actors may differentiate their messages
from Thespian messages by <code>isinstance()</code> testing against the
ActorSystemMessage.</li>

<li>Actors should discard messages they do not recognize.</li>

<li>Actors should allow unexpected or unreasonable exceptions and
errors to cause them to fail.  The ActorSystem will restart the
actor automatically to handle subsequent messages; the ActorSystem
will return the message that caused the failure to the sender in a
PoisonMessage wrapper.</li>

<li><p>
The messages that the ActorSystem can synthesize and deliver to an
Actor are:
</p>

<ul class="org-ul">
<li>ActorExitRequest   (see <a href="#hH-e1d97e35-1d26-4277-b06b-239b6ab4d5d3">Killing an Actor</a>)</li>
<li>ChildActorExited   (see <a href="#hH-3868571d-e754-42a2-840e-6629e817903b">Parent Actor</a>)</li>
<li>PoisonMessage      (see <a href="#hH-62e20202-9bff-4455-968e-73fee0b9f66a">PoisonMessage Returns</a>)</li>
<li>ActorSystemConventionUpdate  (see <a href="#hH-3c8aa454-9a21-4d24-a623-ad86bfd4f5a7">Other Actor Systems</a>)</li>
<li>WakeupMessage      (see <a href="#hH-9cc1acd4-7f35-44ac-94fc-0326dc87a7a5">Timer Messages</a>)</li>
</ul>

<p>
Most simple actors can safely ignore any and all messages from the
ActorSystem; more sophisticated Actors will handle ActorSystem
messages to handle unusual or out-of-band events.
</p></li>

<li>Use simpleActorSystem for easy testing (and automated unit
testing).  Then use MultiprocQueue for testing with multiple
processes to ensure Actor isolation.</li>

<li><p>
It is a common practice to have an Actor probe for functional
aspects of the current environment and update the ActorSystem
capabilities based on the results of the probing (see
<a href="#hH-1dc4362f-78dd-4adf-833c-d7bebda07ef8">updateCapability</a>).  Changing the existing capabilities <b>may</b>
result in all existing actors being killed, including the Actor
initiating the change.
</p>

<p>
If the probing Actor is restarted, it has no context regarding
the previous probe, but presumably the probe will return the same
result as previous, and an updateCapability call that does not
actually change capability values does not impact currently
running Actors in that ActorSystem.  Care should be taken to
ensure that the probe Actor reaches a stable condition in this
manner.
</p></li>

<li>Actors are not intended to create other processes or threads;
attempts to do so may create undefined behavior.</li>

<li>Actors should not block indefinitely on IO operations; while the
Actor is running in the <code>receiveMessage()</code> method it is not able
to handle other messages, including ActorSystem internal
messages.  The Actor will appear to be frozen and this will result
in PoisonMessage delivery failures to Actors attempting to
communicate with the busy Actor.</li>

<li><p>
The ActorSystem is limited by system execution limits.  For
example, ActorSystems implementing actors as separate processes
may be limited by the number of processes that can be created
(e.g. <code>$ ulimit -u</code> on Unix), and ActorSystems using sockets for
communications may be limited by the number of file descriptors
(<code>$ ulimit -n</code>), the max syn backlog (<code>$ sysctl
    net.ipv4.tcp_max_syn_backlog</code>), local port ranges (<code>$ sysctl
    net.ipv4.ip_local_port_range</code>), and various other system limits.
</p>

<p>
Thespian does not make any attempt to adjust these values, and
will do its best to work within the available limits (e.g. closing
idle sockets when the allowed socket limit is reached), but the
user should ensure that the ActorSystem is configured properly
for the expected utilization.
</p></li>
</ul>
</div>
</div>

<div id="outline-container-hH-330e09d9-4a98-4814-8a1c-6003ce6a7995" class="outline-2">
<h2 id="hH-330e09d9-4a98-4814-8a1c-6003ce6a7995"><span class="section-number-2">4.</span> Thespian Actor Feature Extensions</h2>
<div class="outline-text-2" id="text-hH-330e09d9-4a98-4814-8a1c-6003ce6a7995">
<p>
The Thespian system provides several extended features not present
in a simple definition of an Actor environment.  These features
provide the additional functionality for error-handling,
scalability, and enterprise-level deployment of Thespian-based code.
</p>
</div>

<div id="outline-container-hH-3d280f21-4a99-416f-8cd7-9c9380a1c86c" class="outline-3">
<h3 id="hH-3d280f21-4a99-416f-8cd7-9c9380a1c86c"><span class="section-number-3">4.1.</span> Message Delivery</h3>
<div class="outline-text-3" id="text-hH-3d280f21-4a99-416f-8cd7-9c9380a1c86c">
<p>
Messages are delivered to Actors on a <i>best-effort</i> basis.  This
means that under normal or even most abnormal circumstances, the
ActorSystem effectively guarantees that an Actor's send will reach
the intended recipient (eventually).  However, under extreme
circumstances (grand-mal failure of a multiprocessing system
environment, completely hung Actors, etc.) the ActorSystem may not
deliver a message; this is why it is classified as <i>best-effort</i>
instead of <i>guaranteed delivery</i>.
</p>

<p>
When the recipient is busy, the outgoing message is queued in the
<i>sending</i> Actor's system space.  The sending Actor will retry the
send periodically.  The sending Actor can have multiple messages
queued for different targets, but each target is independently handled: messages for a specific target are sent in order but messages
queued to different targets are sent independently.  Eventually
the Actor's <code>.send()</code> request <i>will</i> block if there are too many
messages queued for the intended target.  This queueing mechanism
provides a "back-pressure" mechanism throughout the system to
prevent too many messages being held in limbo.
</p>

<p>
If the recipient exits before the sent message is delivered, the
message is redirected as described in <a href="#hH-5af075c1-73b1-4f7c-8515-e55ed96c03a9">Dead Letter Handling</a>.
</p>
</div>

<div id="outline-container-hH-23ac66d7-ba55-40dc-ade8-a71e51c7a404" class="outline-4">
<h4 id="hH-23ac66d7-ba55-40dc-ade8-a71e51c7a404"><span class="section-number-4">4.1.1.</span> Message Mutability</h4>
<div class="outline-text-4" id="text-hH-23ac66d7-ba55-40dc-ade8-a71e51c7a404">
<p>
Thespian does not automatically generate copies of sent messages,
but instead sends the original directly.  This covers most use cases
and has performance advantages in avoidance of extra copying, but it
does expose a potential for leakage of information between Actors in
some implementations.
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">class</span> <span class="org-type">MyActor</span>(Actor):
    <span class="org-keyword">def</span> <span class="org-function-name">receiveMessage</span>(<span class="org-keyword">self</span>, message, sender):
        ...
        <span class="org-keyword">self</span>.send(actor2, NewMessage(...))
        ...
</pre>
</div>

<p>
The above example shows a common use case where the outgoing message
is directly generated, and no longer used or referenced by the
sending Actor after the <code>.send()</code> call.  This pattern is entirely
safe in all instances.  However, if the sending Actor maintains a
reference to the sent message, as in the example below, that message
data <b>may</b> be modified by code in the recipient.
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="linenr"> 1: </span><span class="org-keyword">class</span> <span class="org-type">ActorA</span>(Actor):
<span class="linenr"> 2: </span>    <span class="org-keyword">def</span> <span class="org-function-name">receiveMessage</span>(<span class="org-keyword">self</span>, message, sender):
<span class="linenr"> 3: </span>        ...
<span class="linenr"> 4: </span>        <span class="org-variable-name">actorb</span> <span class="org-operator">=</span> <span class="org-keyword">self</span>.createActor(ActorB)
<span class="linenr"> 5: </span>        <span class="org-variable-name">newmsg</span> <span class="org-operator">=</span> NewMessage(foo<span class="org-operator">=</span><span class="org-string">"foo"</span>)
<span class="linenr"> 6: </span>        <span class="org-keyword">self</span>.messages.append(newmsg)
<span class="linenr"> 7: </span>        <span class="org-keyword">self</span>.send(actorb, newmsg)
<span class="linenr"> 8: </span>        ...
<span class="linenr"> 9: </span>        <span class="org-keyword">for</span> each <span class="org-keyword">in</span> <span class="org-keyword">self</span>.messages:
<span id="coderef-assertFoo" class="coderef-off"><span class="linenr">10: </span>            <span class="org-keyword">assert</span> each.foo <span class="org-operator">==</span> <span class="org-string">"foo"</span></span>
<span class="linenr">11: </span>
<span class="linenr">12: </span><span class="org-keyword">class</span> <span class="org-type">ActorB</span>(Actor):
<span class="linenr">13: </span>    <span class="org-keyword">def</span> <span class="org-function-name">receiveMessage</span>(<span class="org-keyword">self</span>, message, sender):
<span id="coderef-changeFoo" class="coderef-off"><span class="linenr">14: </span>        message.<span class="org-variable-name">foo</span> <span class="org-operator">=</span> <span class="org-string">"bar"</span></span>
</pre>
</div>

<p>
In the example shown above, the assertion in <a href="#coderef-assertFoo" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-assertFoo');" onmouseout="CodeHighlightOff(this, 'coderef-assertFoo');">line 10</a> may
fail because ActorB has modified ActorA's original copy in <a href="#coderef-changeFoo" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-changeFoo');" onmouseout="CodeHighlightOff(this, 'coderef-changeFoo');">line
14</a>.  The system Base being used and the timing of execution
between the two actors determines whether or not ActorA's message
will pass the asserting test.  When using a multi-process system
base, ActorA's version is independent because the two Actors run as
separate processes and so ActorB has a separate copy of the message
and does not modify the version that ActorA references, but the
<a href="#hH-924dc0fe-c15b-491e-a6d1-8b88683d4c0d">simpleSystemBase</a> (for example) would allow this modification.
</p>

<p>
If an Actor references a message post-send, it should be aware of
this potential for modification.  ActorA can make a copy of the
message (e.g. <code>self.send(actorb, copy.deepcopy(newmsg))</code>) to avoid
this issue although this has negative performance implications
(which is why Thespian does not automatically perform this copy).
</p>
</div>
</div>
</div>


<div id="outline-container-hH-5af075c1-73b1-4f7c-8515-e55ed96c03a9" class="outline-3">
<h3 id="hH-5af075c1-73b1-4f7c-8515-e55ed96c03a9"><span class="section-number-3">4.2.</span> Dead Letter Handling</h3>
<div class="outline-text-3" id="text-hH-5af075c1-73b1-4f7c-8515-e55ed96c03a9">
<p>
If the ActorSystem is unable to deliver a message to the target
Actor (usually because the target Actor is dead or has otherwise
exited), the ActorSystem will route that message to Dead Letter
handling.  A <a href="#hH-e3d4bfa0-7fad-4622-b707-8f67e4f75d5c">DeadEnvelope</a> wrapper is placed around the message to
indicate this situation.
</p>

<p>
By default, the Dead Letter handling will discard the message in
question (possibly logging the event).
</p>

<p>
It is possible for an Actor to register for handling Dead Letters.
In this case, the dead-letter handling Actor receives all messages
that could not be delivered to their target address.
</p>

<p>
Dead letter handling is not a fail-safe to prevent messages from
getting lost, but it is a recommended method by which Actors update
their knowledge about other Actors that no longer exist and cease
sending messages to those other Actors.  One reason for this is that
the address of the Actor that no longer exists may&#x2014;at some
point&#x2014;be assigned to a new and completely different Actor; if the
original Actor persisted in sending messages to the dead Actor the
new Actor would receive those messages which would undoubtably cause
confusion.
</p>
</div>
</div>

<div id="outline-container-hH-badcba33-bc39-4009-833f-07617ec72e12" class="outline-3">
<h3 id="hH-badcba33-bc39-4009-833f-07617ec72e12"><span class="section-number-3">4.3.</span> Non-startable Actors</h3>
<div class="outline-text-3" id="text-hH-badcba33-bc39-4009-833f-07617ec72e12">
<p>
Actors that cannot be started at all will be Dead Lettered by the
ActorSystem.  If an Actor has registered for receiving Dead Letters
(see <a href="#hH-5af075c1-73b1-4f7c-8515-e55ed96c03a9">Dead Letter Handling</a>) then it can perform special actions to
handle the non-starting Actor, but by default Dead Letter Handling
discards all messages sent to a non-starting Actor.
</p>
</div>
</div>

<div id="outline-container-hH-62e20202-9bff-4455-968e-73fee0b9f66a" class="outline-3">
<h3 id="hH-62e20202-9bff-4455-968e-73fee0b9f66a"><span class="section-number-3">4.4.</span> PoisonMessage Returns</h3>
<div class="outline-text-3" id="text-hH-62e20202-9bff-4455-968e-73fee0b9f66a">
<p>
If an Actor experiences a failure (an uncaught exception) when
processing a message, the ActorSystem will catch the exception and
retry delivery of the message to the target Actor (as describe in
<a href="#hH-fb0eba5e-9d12-4cfe-8e8c-fe77b6658065">Actor Failure</a>).
</p>

<p>
If the target Actor generates another exception when handling the
message the second time, the ActorSystem will assume that the
message has caused the failure and will wrap the message in a
<code>PoisonMessage</code> wrapper object and send it back to the sender of
the original message.  The Actor experiencing the exception is
still live, and delivery of subsequent messages still occurs.
</p>

<p>
See <a href="#hH-407c4c79-2a05-442d-b6e8-5bf7c2f2d068">PoisonMessage</a> for details on the <code>PoisonMessage</code> object.
</p>
</div>
</div>

<div id="outline-container-hH-91e3dc4e-af22-4076-94ee-43f60458f0e0" class="outline-3">
<h3 id="hH-91e3dc4e-af22-4076-94ee-43f60458f0e0"><span class="section-number-3">4.5.</span> Top-Level Actors</h3>
<div class="outline-text-3" id="text-hH-91e3dc4e-af22-4076-94ee-43f60458f0e0">
<p>
Actors created by the external environment are called "Top-Level
Actors" and are unique in that they have no "parent" Actor (see
<a href="#hH-3868571d-e754-42a2-840e-6629e817903b">Parent Actor</a>).  Since there is no Parent Actor, there is nowhere to
send a ChildActorExited message when the Actor dies and therefore
there is no allowance for restarting Top Level Actors.
</p>

<p>
Messages sent to a Top Level Actor that has died will still be
redirected to the Dead Letter Handler (see <a href="#hH-5af075c1-73b1-4f7c-8515-e55ed96c03a9">Dead Letter Handling</a>).
</p>
</div>
</div>

<div id="outline-container-hH-2d5ef9c7-2132-45f9-b6eb-6f2729f5b232" class="outline-3">
<h3 id="hH-2d5ef9c7-2132-45f9-b6eb-6f2729f5b232"><span class="section-number-3">4.6.</span> Named Actors</h3>
<div class="outline-text-3" id="text-hH-2d5ef9c7-2132-45f9-b6eb-6f2729f5b232">
<p>
Most Actors are created and subsequently referenced by the
ActorAddress. Any Actor can use this ActorAddress to send a message
to the created Actor.
</p>

<p>
At times, however, it may be convenient to explicitly refer to a
single Actor in the entire system&#x2014;a Singleton&#x2014;without knowing
the Address of that Actor.  To support this, Thespian allows the
creation of "Named Actors" where the name given uniquely identifies
the Actor.
</p>

<p>
The initial Actor creation request with the name will create the
requested Actor, but the ActorSystem will remember the Actor
associated with that name andall subsequent Actor creation requests
with the same name will return the originally created Actor (see the
<code>globalName</code> parameter to the ActorSystem's <a href="#hH-a565af1b-aabb-4336-a51d-7505c072c319">createActor</a> call or the
Actor's <a href="#hH-3663d87d-8a2f-485b-aeef-c6e9cf418b4c">createActor</a> call).
</p>

<p>
It is possible to create any number of Named Actors in the system,
although it is the responsibility of the creators to manage the
namespace of those Actors.
</p>

<p>
There are a couple of disadvantages to Named Actors to consider as
offsets relative to their convenience:
</p>

<ol class="org-ol">
<li>The ActorSystem itself manages all Named Actors (similar to
<a href="#hH-91e3dc4e-af22-4076-94ee-43f60458f0e0">Top-Level Actors</a>) rather than a Parent Actor and therefore there
is no notification when a Named Actor exits, and any messages
sent to a Named Actor that has exited will be sent to the Dead
Letter Handler.</li>

<li>Interaction with Named Actors can be slower than for standard
Actors because of the need to perform global lookup and
coordination based on the name.</li>

<li>The globalName is (at present time) unique only to the Actor
System within which it is running.  There may be multiple Actor
Systems running and communicating as part of a Convention (see
<a href="#hH-3c8aa454-9a21-4d24-a623-ad86bfd4f5a7">Other Actor Systems</a>), but the uniqueness of the globalName (and
corresponding Actor instance) applies only to the system that
has created it.  See <a href="#hH-33d27852-9cfd-4583-b0c0-5c05f2cb8e5a">Multi-system Global Name support</a> for more
details and recommendations.</li>
</ol>


<p>
It is recommended (but not required) that only the top-level,
coordinating Actors be Named Actors and that most Actors in the
system be unnamed Actors to avoid these disadvantages.
</p>
</div>
</div>

<div id="outline-container-hH-9cc1acd4-7f35-44ac-94fc-0326dc87a7a5" class="outline-3">
<h3 id="hH-9cc1acd4-7f35-44ac-94fc-0326dc87a7a5"><span class="section-number-3">4.7.</span> Timer Messages</h3>
<div class="outline-text-3" id="text-hH-9cc1acd4-7f35-44ac-94fc-0326dc87a7a5">
<p>
Normally Actors respond to messages sent to them by other Actors,
but sometimes an Actor would like to run again after a timed delay.
While it is possible for the Actor to sleep internally, this will
prevent it from responding to other messages and cause messages to
be queued causing eventual delivery failure (see <a href="#hH-3d280f21-4a99-416f-8cd7-9c9380a1c86c">Message Delivery</a>).
</p>

<p>
To avoid this, each Actor has a <code>.wakeupAfter()</code> method that can be
called with a specified Python <code>timedelta</code> value.  The ActorSystem
will schedule the delivery of a <code>WakeupMessage</code> after that time
period has elapsed.  Multiple wakeups can be pending for an Actor at
any single time, and the delivery of the <code>WakeupMessage</code> is
interleaved into the normal incoming message stream for the Actor.
</p>

<p>
To distinguish <code>WakeupMessage</code> instances that have been scheduled
for different purposes, it is possible to supply a <code>payload</code>
as a second parameter to <code>.wakeupAfter()</code>. The <code>payload</code> can be
arbitrary but it is accrued against the actor's memory until it is
delivered. Hence, it is recommended to keep the <code>payload</code>
reasonably small.
</p>

<p>
There is no provision for cancelling a pending wakeup; the Actor
should simply ignore the <code>WakeupMessage</code> when it is received.
</p>
</div>
</div>

<div id="outline-container-hH-94edef18-154e-4847-864f-027dff4f6e0a" class="outline-3">
<h3 id="hH-94edef18-154e-4847-864f-027dff4f6e0a"><span class="section-number-3">4.8.</span> Watching File Descriptors</h3>
<div class="outline-text-3" id="text-hH-94edef18-154e-4847-864f-027dff4f6e0a">
<p>
The Actor model itself is a pure specification that is good for
concurrent computational tasks, but real-world Actors must often
interact with or control the external world via sockets, files, or
other interface elements.
</p>

<p>
One way to accomplish this is to use the <code>.wakeupAfter()</code>
functionality described in the previous section to periodically run
the Actor, whereupon it may check to see if there is any pending I/O
for these interface elements.  Each interface element should be
accessed in "non-blocking" mode so that the Actor itself can exit
immediately if there is no work to be done (thereby allowing the
Actor to process new messages as soon as they are received).  The
<a href="https://github.com/kquick/Thespian/blobl/master/examples/httpserver/http_server1.py">http_server1.py</a> file is an example of a simple HTTP server based on
this model.
</p>

<p>
The above model is fairly limited however: it is essentially a
busy-wait loop that consumes resources even when there is no work to
do, and its responsiveness is limited by the period of the wakeup
calls.  An alternative approach provided by <i>some</i> Thespian
SytemBases is the "Watch" extension (as indicated by a System
Capability of "Thespian Watch Supported" with a value of True).
</p>

<p>
When using the Watch extension, the Actor should return a
<code>ThespianWatch</code> object each time its <code>.receiveMessage()</code> method is
called.  The <code>ThespianWatch</code> object is initialized with a list of
file descriptors (from sockets or files) that should be watched, and
if any of these have readable data, the Actor will be called with a
<code>WatchMessage</code> message.  The <code>WatchMessage.ready</code> member is a list
of the supplied file descriptors that can be read from.  The
<code>ThespianWatch</code> is <b>only</b> valid for that single return from the
Actor's <code>.receiveMessage()</code> call, and it must be supplied each time
the <code>.receiveMessage()</code> returns to specify any file descriptors that
should be watched during the wait for the next <code>.receiveMessage()</code>
invocation.
</p>

<p>
The <a href="https://github.com/kquick/Thespian/blobl/master/examples/httpserver/http_server2.py">http_server2.py</a> file is an example of a simple HTTP server that
is similar to the http_server1.py but this example is modified to
use the Watch extension.
</p>

<p>
The Watch extension has a number of limitations:
</p>

<ol class="org-ol">
<li>It is not available for all ActorSystem bases (only those with a
system capability of "Thespian Watch Supported" where the value
is True).</li>

<li>It is OS-dependent: on Linux, any file object may be watched,
but on Windows only sockets may be watched.</li>

<li>It only watches for "readable" events, not writable or exception
events.</li>

<li>It implies the use of <code>select.select()</code>.</li>

<li>There is no timeout (use <code>.wakeupAfter()</code> for this).</li>
</ol>

<p>
Writing Actors which utilize the Watch extension may siginificantly
limit the portability of these Actors.
</p>
</div>

<div id="outline-container-hH-df96b2ed-e292-4ded-a614-30cfa1557858" class="outline-4">
<h4 id="hH-df96b2ed-e292-4ded-a614-30cfa1557858"><span class="section-number-4">4.8.1.</span> Blocking Actors</h4>
<div class="outline-text-4" id="text-hH-df96b2ed-e292-4ded-a614-30cfa1557858">
<p>
There are some cases where the desired functionality of the Actor is
to actually block on external operations.  For example, an Actor
that acts as a client making calls to an external service might be
best written to block on those external calls.  When the Actor
blocks, other Actors cannot deliver messages to that Actor and
backpressure builds (see <a href="#hH-3d280f21-4a99-416f-8cd7-9c9380a1c86c">Message Delivery</a> for more details).
</p>

<p>
The effect of this blocking functionality is to regulate the number
of requests to the external service.  If the Actor performed
non-blocking requests to the external service, it could flood the
service with large numbers of requests.
</p>

<p>
The disadvantage of the blocking approach is that the Actor is
unresponsive while blocked on the external service call.  More
sophisticated methods involving internal queueing and timeouts could
be used as well.
</p>
</div>
</div>
</div>

<div id="outline-container-hH-19cf92bf-a6ae-492c-844c-b0831c108a3a" class="outline-3">
<h3 id="hH-19cf92bf-a6ae-492c-844c-b0831c108a3a"><span class="section-number-3">4.9.</span> Actor Troupes</h3>
<div class="outline-text-3" id="text-hH-19cf92bf-a6ae-492c-844c-b0831c108a3a">
<p>
If specified appropriately, multiple instances of an Actor can be
created which share the same ActorAddress; this is known as an
Actor Troupe.
</p>

<ul class="org-ul">
<li>Messages sent to the ActorAddress associated with the Troupe may
be handled by any of the members of the Troupe,</li>

<li>A message will be delivered to only one member of the Troupe, but
the handling of that message will be performed independently and
asynchronously to any other message being handled by a member of
the Troupe.</li>
</ul>

<p>
The Actor Troupe allows for scalability and parallelization of
individual Actor functionality.  Conversely, the use of a single
Actor (instead of a Troupe) ensures single-threaded, synchronous
handling of messages for that Actor.
</p>

<p>
See <a href="#hH-c796bc0d-a150-4fb9-8918-58f470813175">Actor Troupe Support</a> for more details.
</p>
</div>
</div>

<div id="outline-container-hH-a17e6c70-5592-4d06-b818-bd25350c4c53" class="outline-3">
<h3 id="hH-a17e6c70-5592-4d06-b818-bd25350c4c53"><span class="section-number-3">4.10.</span> ActorSystem Capabilities</h3>
<div class="outline-text-3" id="text-hH-a17e6c70-5592-4d06-b818-bd25350c4c53">
<p>
Actors can stipulate the requirements of the ActorSystem that they
will run in by matching "Capabilities" of the ActorSystem.  Each
ActorSystem has a set of Capabilities specified as a key/value
dictionary.  This dictionary is passed to an Actor's
<code>ActorSystemCapabilityCheck()</code> static method, which examines the
capabilities and returns <code>True</code> or <code>False</code> to indicate whether or
not the current ActorSystem is viable for the Actor.
</p>

<p>
If the current ActorSystem is rejected for creating the Actor, the
ActorSystem will pass the Actor Create request to other ActorSystems
to see if any of those systems can create the requested Actor.
</p>

<p>
The Capabilities of an ActorSystem are free form and the actual
capability keys and values are determined by whatever agent
specifies them.
</p>

<p>
All Thespian ActorSystem instances automatically supply a set of
common capabilities described in the <a href="#hH-2a4bcad4-9fe0-4399-86d4-4bbf0ba0acb7">Common Capabilities</a> section.
</p>
</div>
</div>

<div id="outline-container-hH-3c8aa454-9a21-4d24-a623-ad86bfd4f5a7" class="outline-3">
<h3 id="hH-3c8aa454-9a21-4d24-a623-ad86bfd4f5a7"><span class="section-number-3">4.11.</span> Other Actor Systems</h3>
<div class="outline-text-3" id="text-hH-3c8aa454-9a21-4d24-a623-ad86bfd4f5a7">
<p>
The current ActorSystem can communicate with other ActorSystems to
coordinate Actor activities as described in <a href="#hH-461f4dc3-4bd6-46fe-a33e-2ad2a8d82d53">Multiple Systems</a>.  To
support this, the ActorSystems communicate on known transport
addresses to form a "Convention" of ActorSystems.
</p>

<p>
When new Actors are created, the <a href="#hH-a17e6c70-5592-4d06-b818-bd25350c4c53">ActorSystem Capabilities</a> of the
ActorSystems that are part of the Convention are used to determine
where to start up the requested new Actor.
</p>

<p>
Remote ActorSystem implementations can be different than the local
ActorSystem as long as they properly handle communications between
the two ActorSystems and the Actors contained therein.
</p>

<p>
Actors can also register to be aware of when remote ActorSystems
enter or exit the convention.  Registered Actors will receive an
<a href="#hH-f311fc02-d355-4d68-b9af-958404637e57">ActorSystemConventionUpdate</a> message for these events.  Actors
register for these updates using the
<a href="#hH-b9f7a2f0-7d2a-4cc0-8241-1fee7c62c44e">notifyOnSystemRegistrationChanges</a> API call.
</p>

<p>
An Actor System Convention is managed by one or more convention
leaders, whose job is to help route actor creation and actor
messages between different systems with potentially different
capabilities.  There is currently Beta support for having multiple
convention leaders to provide a measure of fault-tolerance in case a
convention leader fails or exits the convention; this support is
currently in Beta status and should not be used in a production
environment.
</p>

<p>
Not all ActorSystems support multi-system communications, and those
that do are normally of the multi-process variety.
</p>
</div>

<div id="outline-container-hH-bd57f29e-4a5e-4725-9ced-7e0c5fa5bcbd" class="outline-4">
<h4 id="hH-bd57f29e-4a5e-4725-9ced-7e0c5fa5bcbd"><span class="section-number-4">4.11.1.</span> Convention Establishment</h4>
<div class="outline-text-4" id="text-hH-bd57f29e-4a5e-4725-9ced-7e0c5fa5bcbd">
<p>
The ActorSystem implementation determines the manner in which
Conventions are established and should be consulted for details and
capabilities, but at the present time there are two main methods for
establishing a Convention:
</p>

<ol class="org-ol">
<li>Members known the Convention Leader and upon startup register
with the Convention Leader.  In this mode, the Convention Leader
operates passively and does not initiate or drive the Convention
membership.</li>

<li><p>
The Convention Leader is told about members and actively attempts
to establish communications with those members.  This is done
using the <a href="#hH-956e30d5-c035-4e1e-86cb-73332e28d8d4">preRegisterRemoteSystem()</a> call.  In this mode, the
Convention Leader will actively connect to the remote to
establish or re-establish connectivity (until the membership is
cancelled, for example, with the <a href="#hH-ce801678-bcff-497d-be2a-439cb34fc519">deRegisterRemoteSystem()</a> call).
</p>

<p>
This latter method is particularly suited to configurations using
the "Outbound Only" connectivity mode (see <a href="#hH-9d33a877-b4f0-4012-9510-442d81b0837c">multiprocTCPBase</a> for
example) where the Convention Leader is behind a firewall and can
initiate outbound connections to members but those members cannot
initiate inbound connections to the Leader.
</p></li>
</ol>
</div>
</div>

<div id="outline-container-hH-0500ead3-28ea-440c-9ad6-56cb9fbdd648" class="outline-4">
<h4 id="hH-0500ead3-28ea-440c-9ad6-56cb9fbdd648"><span class="section-number-4">4.11.2.</span> Convention Administrator Communications</h4>
<div class="outline-text-4" id="text-hH-0500ead3-28ea-440c-9ad6-56cb9fbdd648">
<p>
The communications between the Convention Leader admin process and the
Convention Member admin process is handled internally by Thespian.
</p>

<p>
To prevent network overload in unexpected or erroneous circumstances,
the Convention communications uses an incremental hysteresis delay on
communications between the admin processes; this delay increases when
there are active messages being exchanged and decreases during idle
times.  The overall traffic between two Convention administrators is
expected to be relatively low volume, but in unusual circumstances
this delay may become observable.  The hysteresis delay is designed to
protect the overall environment from failure scenarios; please contact
the Thespian developers if this hysteresis is adversely affecting your
utilization of Thespian.
</p>
</div>
</div>

<div id="outline-container-hH-33d27852-9cfd-4583-b0c0-5c05f2cb8e5a" class="outline-4">
<h4 id="hH-33d27852-9cfd-4583-b0c0-5c05f2cb8e5a"><span class="section-number-4">4.11.3.</span> Multi-system Global Name support</h4>
<div class="outline-text-4" id="text-hH-33d27852-9cfd-4583-b0c0-5c05f2cb8e5a">
<p>
Actor creation is first attempted locally, but if the Actor's
requirements do not match the local system's capabilities, other
Actor Systems will be invited to create the specified Actor, one
at a time.  The first Actor System that can create the specified
Actor will record the global name in that system; if an Actor
System already has an Actor running under that global name, that
will satisfy the creation attempt.
</p>

<p>
Because this global name is only recorded on a single system and
the creation is on a first-found basis, it is not necessarily the
case that the next attempt to call createActor with the same
globalName will query the same system before another system is
found that is willing to create the target actor.  As a result,
two <code>createActor()</code> calls with the same <code>globalName</code> value may
result in two different target Actors running on two separate
remote Actor Systems.
</p>

<p>
An recommended alternative approach is to create a "registrar"
Actor on the Convention Leader system, using a <code>globalName</code> to
ensure that the registrar instance is unique.  The registrar can
then register for notification of remote Actor Systems
(<a href="#hH-b9f7a2f0-7d2a-4cc0-8241-1fee7c62c44e">notifyOnSystemRegistrationChanges</a>) and when a new remote Actor
System joins the convention, the registrar Actor can create a
specific Actor on that remote system, recording the resulting
address locally in the registrar.  When that unique remote Actor
is needed, the registrar can be consulted to obtain the target
address.
</p>
</div>
</div>
</div>

<div id="outline-container-hH-5e670e59-8334-477e-a9d2-0c2dc39d82dd" class="outline-3">
<h3 id="hH-5e670e59-8334-477e-a9d2-0c2dc39d82dd"><span class="section-number-3">4.12.</span> Performance</h3>
<div class="outline-text-3" id="text-hH-5e670e59-8334-477e-a9d2-0c2dc39d82dd">
<p>
The Thespian implementation is design principles are: correctness,
reliability, responsiveness, and performance &#x2014; in that order.  In
general Thespian is intended to be used in situations involving Actors
that communicate relatively frequently with each other, but not
necessarily with high volumes of data.  While there is nothing in the
Thespian implementation that prevents exchanging multi-megabyte
messages between Actors, the implementation is oriented more towards
low latency and responsiveness rather than high-speed streaming.
</p>

<p>
To further ensure that a Thespian Actor-based application is a good
network citizen, there is automatic rate limiting applied to the
exchange of messages between Actors.  This rate limit is currently set
to approximately 80Mib/s &#x2013; slightly less than the traffic rate that
would saturate a 100Mib/s Ethernet link.  This is designed to protect
the overall environment from runaway failure conditions in the
Actor-based application; please contact Thespian development if this
is adversely affecting your Actor-base application.
</p>
</div>
</div>

<div id="outline-container-hH-ce55494c-dd7a-4258-a1e8-b090c3bbb1e6" class="outline-3">
<h3 id="hH-ce55494c-dd7a-4258-a1e8-b090c3bbb1e6"><span class="section-number-3">4.13.</span> Logging</h3>
<div class="outline-text-3" id="text-hH-ce55494c-dd7a-4258-a1e8-b090c3bbb1e6">
<p>
The standard Python logging can be used with the Thespian Actor
system, although there are some Thespian modifications to logging that
improve the logging experience using Thespian.
</p>

<p>
The optional <code>logDefs</code> argument passed to the <code>ActorSystem()</code>
instantiation (see below) will specify the primary logging
configuration for Thespian and corresponding Actors (regardless of
where the logger is obtained).
</p>

<p>
The functionality provided by logging in the Thespian environment
possibly includes sending log messages to a central Logging actor (as
explicitly indicated in the <a href="#hH-2a5fa63d-e6eb-43b9-bea8-47223b27544e">ActorSystem Implementations</a> section).
This is needed because the standard Python logging is not
multi-process safe and attempts to use it as-is will result in missing
or duplicated log messages.
</p>

<p>
In addition to sending log messages to the Logging actor, the
Convention Manager ActorSystem also receives all log messages from any
conference member that is of <code>WARNING</code> level or above.  This
facilitates centralized logging of significant issues across a
multitude of hosts running ActorSystems.
</p>

<p>
Once the logging configuration has been specified in the
<code>ActorSystem()</code> call, the normal python logging library can be used to
generate logging messages; these messages will be forwarded to the
Logging actor (and possibly the Convention Manager) where the actual
logging will occur.
</p>

<p>
Log output generated by Actors may automatically have an
"actorAddress" attribute added, which can be referenced by the log
formatter (in the same manner as the standard attributes such as
"levelname" and "message").  The "actorAddress" attribute is not
always present because some logging can be generated externally to the
actors; the formatting operation cannot account for this, so a
filter should be used to ensure the right formatter is specified.
</p>

<p>
The logging configuration is specified using the standard Python
Logging dictionary specification (documented in
<a href="https://docs.python.org/3/library/logging.config.html">https://docs.python.org/3/library/logging.config.html</a>).  For example:
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">import</span> logging

<span class="org-keyword">class</span> <span class="org-type">actorLogFilter</span>(logging.Filter):
    <span class="org-keyword">def</span> <span class="org-function-name">filter</span>(<span class="org-keyword">self</span>, logrecord):
        <span class="org-keyword">return</span> <span class="org-string">'actorAddress'</span> <span class="org-keyword">in</span> logrecord.<span class="org-builtin">__dict__</span>
<span class="org-keyword">class</span> <span class="org-type">notActorLogFilter</span>(logging.Filter):
    <span class="org-keyword">def</span> <span class="org-function-name">filter</span>(<span class="org-keyword">self</span>, logrecord):
        <span class="org-keyword">return</span> <span class="org-string">'actorAddress'</span> <span class="org-keyword">not</span> <span class="org-keyword">in</span> logrecord.<span class="org-builtin">__dict__</span>

<span class="org-variable-name">logcfg</span> <span class="org-operator">=</span> { <span class="org-string">'version'</span>: 1,
           <span class="org-string">'formatters'</span>: {
               <span class="org-string">'normal'</span>: {<span class="org-string">'format'</span>: <span class="org-string">'%(levelname)-8s %(message)s'</span>},
               <span class="org-string">'actor'</span>: {<span class="org-string">'format'</span>: <span class="org-string">'%(levelname)-8s %(actorAddress)s =&gt; %(message)s'</span>}},
           <span class="org-string">'filters'</span>: { <span class="org-string">'isActorLog'</span>: { <span class="org-string">'()'</span>: actorLogFilter},
                        <span class="org-string">'notActorLog'</span>: { <span class="org-string">'()'</span>: notActorLogFilter}},
           <span class="org-string">'handlers'</span>: { <span class="org-string">'h1'</span>: {<span class="org-string">'class'</span>: <span class="org-string">'logging.FileHandler'</span>,
                                <span class="org-string">'filename'</span>: <span class="org-string">'example.log'</span>,
                                <span class="org-string">'formatter'</span>: <span class="org-string">'normal'</span>,
                                <span class="org-string">'filters'</span>: [<span class="org-string">'notActorLog'</span>],
                                <span class="org-string">'level'</span>: logging.INFO},
                         <span class="org-string">'h2'</span>: {<span class="org-string">'class'</span>: <span class="org-string">'logging.FileHandler'</span>,
                                <span class="org-string">'filename'</span>: <span class="org-string">'example.log'</span>,
                                <span class="org-string">'formatter'</span>: <span class="org-string">'actor'</span>,
                                <span class="org-string">'filters'</span>: [<span class="org-string">'isActorLog'</span>],
                                <span class="org-string">'level'</span>: logging.INFO},},
           <span class="org-string">'loggers'</span> : { <span class="org-string">''</span>: {<span class="org-string">'handlers'</span>: [<span class="org-string">'h1'</span>, <span class="org-string">'h2'</span>], <span class="org-string">'level'</span>: logging.DEBUG}}
         }
</pre>
</div>

<p>
This logging configuration complexity is unfortunately imposed by the
need to select the proper formatter, but this complexity can be
captured in an auxiliary file and is only needed for passing to the
<code>ActorSystem()</code> instantiation.
</p>
</div>

<div id="outline-container-h:3ef538e8-a989-481b-992d-a9d165a2ce26" class="outline-4">
<h4 id="h:3ef538e8-a989-481b-992d-a9d165a2ce26"><span class="section-number-4">4.13.1.</span> Logging Level Management</h4>
<div class="outline-text-4" id="text-h:3ef538e8-a989-481b-992d-a9d165a2ce26">
<p>
When each Actor is started, the base level of messages forwarded to
the Logging Actor for that started Actor is based on the <b>minimum</b>
logging level specified in the <code>logDefs</code> dictionary (for any
<code>handlers</code>, <code>loggers</code>, or <code>root</code> entry).  
</p>

<ul class="org-ul">
<li>If no <code>logDefs</code> dictionary is specified, the base level is 0.</li>

<li>If any <code>handler</code>, <code>loggers</code>, or the <code>root</code> entry does not
explicitly specify the logging level, the Python default level is
0, which will be the minimum logging level extracted from the
<code>logDefs</code> configuration.</li>

<li>A logging level of 0 results in <b>all</b> messages being forwarded to
the Logging Actor.</li>

<li>For Thespian versions 3.10.1 and before, the <code>logDefs</code> does not
affect the logging level of each Actor and the level is
effectively 1.</li>
</ul>

<p>
In implementation terms, the forwarding to the Logging Actor is
implemented as a <a href="https://docs.python.org/3/library/logging.html#handler-objects">Log Handler</a>.  In Python, there may be multiple Log
Handlers defined but the handler which forwards to the Logging Actor
is pre-declared.  
</p>

<p>
The Python Logging API is implemented via a <a href="https://docs.python.org/3/library/logging.html#logger-objects">Logger object</a>, which
provides its own filters and log-level thresholds before passing log
messages to the handlers for performing the logging.  Each Actor can
adjust the logging level for the Logger object to modify the level at
which messages are logged, but setting the Logger's log-level below
the level that the Logging Actor Handler was started with has no
effect: the Logger will low log-level messages to the Handler but they
will fail the handler's threshold check and not be forwarded to the
Logging Actor.
</p>

<p>
<span class="underline">Note:</span> the Python Logging API's do not allow a Handler to be
retrieved from the Logging framework, so it is not possible for the
Actor to modify the logging threshold level of the Handler.
</p>
</div>
</div>

<div id="outline-container-h:46850001-c8cf-42e6-90cf-dd7236ae9436" class="outline-4">
<h4 id="h:46850001-c8cf-42e6-90cf-dd7236ae9436"><span class="section-number-4">4.13.2.</span> Logging Transmit Overruns</h4>
<div class="outline-text-4" id="text-h:46850001-c8cf-42e6-90cf-dd7236ae9436">
<p>
Some libraries or python code will perform significant amounts of
logging, especially at the <code>DEBUG</code> level, since normally these are not
displayed but they can be useful when debugging problem situations.
</p>

<p>
This can, however, create an issue in Thespian if the <code>logDefs</code> are
not specified and the Actor does not set a <code>Logger</code> level: all of
these log messages will be forwarded to the Logging Actor.  Thespian
maintains an outbound message threshold; if this threshold is exceeded
(e.g. by too many queued log messages), then the Actor is placed into
transmit-only mode until the queue has dropped back below a lower
threshold (see <a href="#hH-3d280f21-4a99-416f-8cd7-9c9380a1c86c">Message Delivery</a> for more details).  This can degrade
the Actor's responsiveness due to messages that are subsequently
discarded by the Logging Actor.
</p>

<p>
Prior and up to Thespian release 3.10.1, the only way to address this
is for the Actor to change the <code>Logger</code> logging level
(e.g. <code>logging.getLogger().setLevel(logging.WARNING)</code>) so that those
messages are dropped by the <code>Logger</code> and not forwarded to the Logging
Actor.  After Thespian 3.10.1, the minimum logging level in the
<code>logDefs</code> supplied to the <code>ActorSystem()</code> initialization is applied to
each Actor created and can be used to control the logging threshold
even for Actors that don't dynamically change their level.
</p>
</div>
</div>

<div id="outline-container-hH-856a7ffe-676b-42a9-95eb-bd89a5810f53" class="outline-4">
<h4 id="hH-856a7ffe-676b-42a9-95eb-bd89a5810f53"><span class="section-number-4">4.13.3.</span> Thespian Internals Logging</h4>
<div class="outline-text-4" id="text-hH-856a7ffe-676b-42a9-95eb-bd89a5810f53">
<p>
Because Thespian instruments the standard logging functionality to
provide the Convention forwarding ability, it is not possible to use
logging from within most of Thespian itself because this can cause
infinite recursions hangs.
</p>

<p>
Thespian internals write logging information to a file
(<code>/tmp/thespian.log</code> by default) with a single backup rotation of that
file at a specified size limit.  This internal logging can be
controlled via the following environment variables that must be set
before the ActorSystem is started:
</p>

<dl class="org-dl">
<dt>THESPLOG_FILE</dt><dd>specifies the filepath for the Thespian
internals logging.  By default this writes to
<code>/tmp/thespian.log</code>.</dd>

<dt>THESPLOG_FILE_MAXSIZE</dt><dd>specifies the maximum size for the
Thespian internals logging file.  There is a single backup
rotation (<code>{filepath}.old</code>), so the actual space consumed can
reach twice this value.  The default value of 50KB is
relatively small, but this file should normally not be needed
by developers writing Actors and is usually only needed by
developers modifying Thespian internals.</dd>

<dt>THESPLOG_THRESHOLD</dt><dd>specifies the minimum log level that will get
written the THESPLOG_FILE. The default value is <code>WARNING</code> and the
following log levels are recognized: <code>CRITICAL</code>, <code>ERROR</code>, <code>WARNING</code>,
 <code>INFO</code>, and <code>DEBUG</code>.</dd>
</dl>
</div>
</div>
</div>

<div id="outline-container-hH-955ec990-a267-4d08-8f4d-5f980c777173" class="outline-3">
<h3 id="hH-955ec990-a267-4d08-8f4d-5f980c777173"><span class="section-number-3">4.14.</span> Actor Code Distribution</h3>
<div class="outline-text-3" id="text-hH-955ec990-a267-4d08-8f4d-5f980c777173">
<p>
The Thespian ActorSystem provides a feature to specify the code
used for Actor implementations.
</p>

<p>
By default, an Actor implementation is obtained by importing from
the current environment and then passing that object to a
<code>createActor()</code> call.  When used in this default manner, all of the
<code>.py</code> sources used to implement Actors must be in the import path of
the Thespian ActorSystem itself.
</p>

<p>
With the Code Distribution feature provided by Thespian it is
possible to load specific Actor code as provided by a (possibly
encrypted) zipfile.  The zipfile can be dynamically loaded into an
already-running Thespian ActorSystem.  This provides a number of
advantages:
</p>

<ul class="org-ul">
<li>The Thespian ActorSystem can be distributed and activated as a
standalone element.  The code for Actors to be run within the
system can be distributed separately.</li>

<li>Actor implementation code can be protected by encryption,
allowing that code to run only when the proper decryption key is
provided.  This provides both distribution security (Python
source files are not readable by anyone with access to the
computer on which they are installed) and validation of
authorization to interact with and execute the Actor code
(especially in cases where the ActorSystem runs with elevated
privileges).</li>

<li>Multiple unrelated sets of Actors can share the same ActorSystem
without adverse interactions.</li>

<li>Running Actor implementations can be updated without requiring
the entire ActorSystem to be stopped and restarted.  This is
especially useful when the ActorSystem is hosting multiple
different and independent sets of Actors.</li>

<li>Multiple instances of the same set of Actors can be running in
the same ActorSystem simultaneously.  This is especially useful
when upgrading to a new version of a set of Actors where all new
messages are directed to the new Actors while allowing all
messages circulating between the older Actors to drain; in this
scenario there is no downtime to customers when upgrading an
Actor implementation.</li>
</ul>

<p>
When the Thespian Actor Code Distribution mechanism is used in a
multi-ActorSystem configuration (e.g. cooperating ActorSystems
between several computers), it is only necessary to load the zipfile
into one ActorSystem.  The different ActorSystems will automatically
pull the zipfile from the source system to support a createActor
operations that would occur in that other ActorSystems (e.g. due to
system capabilities or actor requirements).  This mechanism allows
the following additional benefits:
</p>

<ul class="org-ul">
<li>Actor code distribution can be done by simply loading the new
code version into a single ActorSystem (usually the convention
leader) and all other ActorSystems will automatically update
with that code on an as-needed basis.</li>

<li>Actor implementation synchronization.  The createActor will
automatically synchronize the current zipfile version to the
target ActorSystem before instantiating the new Actor, thereby
ensuring that the local Actor is communicating with an
up-to-date version of the remote Actor.  There is no longer a
risk that a newer version of an Actor will attempt to
communicate with a remote Actor instance that is out-of-date and
encounter version-related problems.</li>
</ul>

<p>
The <a href="#hH-731cff6e-674d-4341-bd92-80a08113d5df">loadActorSource</a> operation describes this capability in more
detail, including security protections associated with this feature.
</p>

<p>
The <a href="director.html">Thespian Director</a> document describes the Director utility and
how it can help to use loadable Actor sources in a safe and
practical manner.
</p>
</div>
</div>
</div>

<div id="outline-container-hH-c3ba9430-5229-44ad-bbd5-ff5426e03e5e" class="outline-2">
<h2 id="hH-c3ba9430-5229-44ad-bbd5-ff5426e03e5e"><span class="section-number-2">5.</span> Actor API</h2>
<div class="outline-text-2" id="text-hH-c3ba9430-5229-44ad-bbd5-ff5426e03e5e">
<p>
The Actor API is the set of operations that a running Actor can
perform.  Thespian implements this API as a set of methods on an
<code>Actor</code> baseclass that all running Actors should subclass.
</p>

<p>
The Actor API is made available by importing the <code>thespian.actors</code>
module.
</p>

<p>
Each Actor is represented by an Actor baseclass:
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">from</span> thespian.actors <span class="org-keyword">import</span> Actor

<span class="org-keyword">class</span> <span class="org-type">MyActor</span>(Actor): ...
</pre>
</div>

<p>
Versioning of the Actor API and the ActorSystem are described in
<a href="#hH-a17e6c70-5592-4d06-b818-bd25350c4c53">ActorSystem Capabilities</a>.
</p>

<p>
It is important to note that the Actor is not fully initialized
until the <code>__init__</code> function completes, so no actor-level
operations (e.g. <code>self.send()</code>, <code>self.createActor()</code>) should be
performed in the class's <code>__init__</code> function.  Actor initialization
can be handled in the <code>receiveMessage</code> in a number of ways,
including:
</p>

<ul class="org-ul">
<li>detecting <code>None</code> values of members and replacing them with the
results of initialization at that time</li>

<li>Handling a specific initialization message sent by some other
entity.</li>

<li>A combination of the above, using the <code>initializing_messages</code>
decorator provided by the <code>thespian/initmsgs.py</code> helper.</li>
</ul>
</div>

<div id="outline-container-hH-584dd408-9496-4f6f-8a86-0f0236f73893" class="outline-3">
<h3 id="hH-584dd408-9496-4f6f-8a86-0f0236f73893"><span class="section-number-3">5.1.</span> myAddress</h3>
<div class="outline-text-3" id="text-hH-584dd408-9496-4f6f-8a86-0f0236f73893">
<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">self</span>.myAddress
</pre>
</div>

<p>
This property is the ActorAddress of this Actor.
</p>
</div>
</div>

<div id="outline-container-hH-f89540de-f853-42e3-9d52-23b1f84a251e" class="outline-3">
<h3 id="hH-f89540de-f853-42e3-9d52-23b1f84a251e"><span class="section-number-3">5.2.</span> receiveMessage</h3>
<div class="outline-text-3" id="text-hH-f89540de-f853-42e3-9d52-23b1f84a251e">
<div class="org-src-container">
<pre class="src src-python">    <span class="org-keyword">def</span> <span class="org-function-name">receiveMessage</span>(<span class="org-keyword">self</span>, message, sender): ...
</pre>
</div>

<p>
This method is the primary entry point into the Actor to handle
received messages.  Each subclass should override the base Actor
receiveMessage() method as appropriate.  The <code>message</code> argument is
the message being received, and the <code>sender</code> is the ActorAddress of
the Actor (or <a href="#hH-c183ae4b-b397-433f-aa4e-69a6838ece38">External Communications</a> endpoint) sending the
message.
</p>

<p>
The message can be discarded once it has been handled.  As
described previously in <a href="#hH-2889c112-6505-4b32-9dce-ac3e4a16ad11">Actors</a>, there are three things an Actor can
do when handling a message:
</p>
<ol class="org-ol">
<li>Update internal state</li>
<li>Create a finite number of other Actors</li>
<li>Send a finite number of messages to other Actors</li>
</ol>

<p>
If the processing of the message causes an exception, the failure
will be caught by the ActorSystem and the message may be retried or
returned to the sender as described in <a href="#hH-62e20202-9bff-4455-968e-73fee0b9f66a">PoisonMessage Returns</a>.  Note
that the <i>original</i> copy of the receive message is passed to the
Actor with each attempt; if the Actor modifies the message before
failing with an exception, the retried or Poison-returned version
will contain the modifications made by the original attempt.
</p>
</div>

<div id="outline-container-hH-c7c7275c-fa32-4466-9d1a-e888f993e67c" class="outline-4">
<h4 id="hH-c7c7275c-fa32-4466-9d1a-e888f993e67c"><span class="section-number-4">5.2.1.</span> Return Value</h4>
<div class="outline-text-4" id="text-hH-c7c7275c-fa32-4466-9d1a-e888f993e67c">
<p>
Ordinarily the return value from an Actor's <code>receiveMessage()</code>
method is ignored, but if the underlying ActorSystem implementation
supports the Thespian Watch extension (see <a href="#hH-94edef18-154e-4847-864f-027dff4f6e0a">Watching File
Descriptors</a>) then the Actor may return a ThespianWatch object which
specifies a list of the file numbers to watch for incoming data;
the Actor's <code>receiveMessage()</code> will subsequently be passed a
<a href="#hH-8a46cfae-7ccc-407a-91c1-d4301b7a653c">WatchMessage</a> with the file number(s) for which data is available.
</p>

<p>
Any other value or object returned from <code>.receiveMessage()</code> will be
ignored.
</p>

<p>
The <a id="org795302e"></a> object is initialized with the list of file
numbers to watch for incoming data from.
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">from</span> thespian.actors <span class="org-keyword">import</span> Actor, ThespianWatch

<span class="org-keyword">class</span> <span class="org-type">MyActor</span>(Actor):
    <span class="org-keyword">def</span> <span class="org-function-name">receiveMessage</span>(<span class="org-keyword">self</span>, message, sender):
       ...process message...
       <span class="org-keyword">return</span> ThespianWatch([<span class="org-keyword">self</span>.socket1.fileno(),
                             <span class="org-keyword">self</span>.socket2.fileno()])
</pre>
</div>

<p>
Any invalid or closed file descriptors will be ignored.  The file
descriptors are watched only until the next call to the Actor's
<code>.receiveMessage()</code> method, so each call to this method must return
the set of file descriptors that should be watched when it exits.
</p>
</div>
</div>
</div>

<div id="outline-container-hH-3663d87d-8a2f-485b-aeef-c6e9cf418b4c" class="outline-3">
<h3 id="hH-3663d87d-8a2f-485b-aeef-c6e9cf418b4c"><span class="section-number-3">5.3.</span> createActor</h3>
<div class="outline-text-3" id="text-hH-3663d87d-8a2f-485b-aeef-c6e9cf418b4c">
<div class="org-src-container">
<pre class="src src-python"><span class="org-variable-name">newAddress</span> <span class="org-operator">=</span> <span class="org-keyword">self</span>.createActor(<span class="org-keyword">self</span>, actorClass,
                              targetActorRequirements<span class="org-operator">=</span><span class="org-constant">None</span>,
                              globalName<span class="org-operator">=</span><span class="org-constant">None</span>,
                              sourceHash<span class="org-operator">=</span><span class="org-constant">None</span>)
</pre>
</div>

<p>
This method is called by the Actor to create a new Actor
represented by the specified <code>actorClass</code>.  The <code>actorClass</code> may be
specified as either a class object or as a module-qualified string
(e.g. "foo.bar.BarActor" will search for <code>class BarActor</code> in the
<code>bar.py</code> in the <code>foo</code> directory).  The InvalidActorSpecification
exception will be thrown if the actorClass is not specified in a
valid manner.
</p>

<p>
The optional <code>targetActorRequirements</code> argument is a value that
will be passed passed to the <a href="#hH-0e9f4a6a-3083-40fa-a75b-ced37d70eef0">actorSystemCapabilityCheck</a> to use for
validating whether the Actor can be started within the current
ActorSystem environment (see <a href="#hH-a17e6c70-5592-4d06-b818-bd25350c4c53">ActorSystem Capabilities</a>).  The value
specified for this argument can be anything the target Actor's
<code>actorSystemCapabilityCheck()</code> method can understand, although
typically it is a Python dictionary.
</p>

<p>
The <code>globalName</code> argument, if specified, should be a string
specifying the "name" of the Actor within the ActorSystem.  As
describe in <a href="#hH-2d5ef9c7-2132-45f9-b6eb-6f2729f5b232">Named Actors</a>, this name allows the Actor to be a
system-wide singleton and to be uniquely identified and referenced
in a manner additional to the ActorAddress of the actor.
</p>

<p>
The <code>sourceHash</code> argument, if specified, indicates a loaded source
in which the <code>actorClass</code> should be found when attempting to load
the <code>actorClass</code> source and start the Actor.  See
<a href="#hH-a565af1b-aabb-4336-a51d-7505c072c319">ActorSys.createActor()</a> for more details.
</p>

<p>
The context for the created Actor will be the context under which
the Thespian system was started.  <span class="underline">This means that if the Thespian
system was started as root, then all Actors will run as root.</span>
</p>

<p>
The source for the <code>actorClass</code> to be created is established by
the current Actor, relative to any <a href="#hH-731cff6e-674d-4341-bd92-80a08113d5df">loadActorSource</a> operation that
apply to the creating Actor itself:
</p>

<ul class="org-ul">
<li>If an Actor class is specified directly, that class is obtained
via import operations.  These import operations use the lookup
search path that already use a searchpath that contains any
loaded actor source operations.</li>

<li>If a module-qualified string specifies the <code>actorClass</code>, then
the lookup of that class will use the same source hash lookup
path that the Actor itself came from.</li>

<li>It is not possible to specify an alternate source file hash
when performing a <code>createActor()</code> call from within an Actor
(only the ActorSystem <code>createActor()</code> method can do that).</li>

<li>If the target Actor must be instantiated in a separate
ActorSystem and that ActorSystem does not have the
loadActorSource for the target Actor available, it will
automatically obtain that loadActorSource file from the current
system and then start the target Actor from that source.  This
can be used as a code distribution methodology for the
ActorSystems' environment.  The ActorSystem that initiated the
<code>createActor()</code> call with the hash must already have that source
loaded.</li>
</ul>

<p>
The return value of this method is the ActorAddress of the
newly-created Actor.  Note that this address may be provided even
before the target Actor is instantiated and is ready for handling
messages.  The ActorSystem will automatically buffer any messages
sent to the new Actor until that Actor is ready; the creating Actor
is free to send messages immediately on completion of this request
and does not need to be concerned with the asynchronous startup
aspect of the target Actor.  However, due to this asynchronous
startup, it is possible that the new Actor cannot be started at
all; in this event all messages intended for the new target Actor
will be handled as described in the <a href="#hH-5af075c1-73b1-4f7c-8515-e55ed96c03a9">Dead Letter Handling</a> section.
</p>
</div>


<div id="outline-container-hH-c5ae8d61-9358-463d-b0f0-d15ae0246059" class="outline-4">
<h4 id="hH-c5ae8d61-9358-463d-b0f0-d15ae0246059"><span class="section-number-4">5.3.1.</span> globalName</h4>
<div class="outline-text-4" id="text-hH-c5ae8d61-9358-463d-b0f0-d15ae0246059">
<p>
The parent for a Named Actor (created when the <code>globalName</code> argument
is specified) is the ActorSystem itself, rather than the requesting
Actor.  This is because there may be multiple createActor requests
for the same global name and they should all return the Address of
the same Actor, but an Actor cannot have multiple Parents.
</p>

<p>
A Named Actor persists as long as it is not killed (via an
ActorExitRequest) and can be referenced by any Actor requesting a
create with the same globalName.
</p>

<p>
When a Named Actor exits, only the ActorSystem is aware of the
exit; there is no <a href="#hH-ed408390-5a74-4955-9f7d-a84e87595459">ChildActorExited</a> notification sent to any Actors
that requested the creation of the Named Actor.
</p>
</div>
</div>

<div id="outline-container-hH-57dd8b71-0f60-4ad2-9628-08edf2c5b00c" class="outline-4">
<h4 id="hH-57dd8b71-0f60-4ad2-9628-08edf2c5b00c"><span class="section-number-4">5.3.2.</span> Actor Creation Gotchas</h4>
<div class="outline-text-4" id="text-hH-57dd8b71-0f60-4ad2-9628-08edf2c5b00c">
<p>
There are a few issues to be aware of when creating Actors:
</p>

<ol class="org-ol">
<li><p>
When creating an actor using a string specification of the Actor
Class, the name <b>must</b> be a fully-qualified module specification
and not simply the name of an ActorClass in the current source.
</p>

<p>
While the latter would be convenient, it is not possible for
remote processes to have access to the current source frame to
load these Actors.  One solution is to use a class reference
rather than a string (but see the next issue).
</p>

<p>
The InvalidActorSpecification exception will be thrown if the
actorClass is not specified in a valid manner.
</p></li>

<li><p>
Actor classes must either have been in the system path when the
ActorSystem was created, or they must exist in a loaded Actor
Source (see <a href="#hH-731cff6e-674d-4341-bd92-80a08113d5df">loadActorSource</a>).  Many ActorSystems use separate
processes to manage and create new Actors, so any changes in the
current process after the ActorSystem process is started up will
not be visible to the latter.
</p>

<p>
This is also especially surprising when modifying the implementation
of the Actor and retrying; the new code will not seem to be running,
and indeed it is not because the previous version of the code is still
existing in the running Admin.  The Admin must be stopped and restarted
as part of the new code implementation to have that new implementation
available to it.
</p></li>

<li>Creating an actor inside the main <code>.py</code> file run from the command
line and specifying the class object does not work because the
module to which the class is assigned is "<span class="underline"><span class="underline">main</span></span>", which cannot
be resolved by the Admin.  There are two solutions:

<ol class="org-ol">
<li>Place the Actor in a different file and import it explicitly
from that file (which therefore correctly idenfifies that
file as the module context for the Actor).</li>

<li>Create a loadable module instead and reference the actor by
a name/import-path string.</li>
</ol></li>
</ol>
</div>
</div>
</div>

<div id="outline-container-hH-28cb6d46-fa93-4efd-bc83-88bbbd50df66" class="outline-3">
<h3 id="hH-28cb6d46-fa93-4efd-bc83-88bbbd50df66"><span class="section-number-3">5.4.</span> send</h3>
<div class="outline-text-3" id="text-hH-28cb6d46-fa93-4efd-bc83-88bbbd50df66">
<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">self</span>.send(targetAddress, message)
</pre>
</div>

<p>
This is the method used to send a message from the current Actor
to another Actor as identified by the <code>targetAddress</code>.  The
<code>message</code> can be anything the current Actor desires, although most
ActorSystem implementations will require that the <code>message</code> can be
pickled by the Python <code>pickle</code> utility.
</p>

<p>
There is no response to the send, and the message is delivered to
the target asynchronously.  There is no guarantee that the target
has received the message by the time the <code>.send()</code> method returns.
The ActorSystem delivers the message at some point by best-effort,
sending the message to <a href="#hH-5af075c1-73b1-4f7c-8515-e55ed96c03a9">Dead Letter Handling</a> if it cannot be
delivered.
</p>
</div>
</div>

<div id="outline-container-hH-b2b4b63a-c256-4793-8591-1ce8dbd87131" class="outline-3">
<h3 id="hH-b2b4b63a-c256-4793-8591-1ce8dbd87131"><span class="section-number-3">5.5.</span> wakeupAfter</h3>
<div class="outline-text-3" id="text-hH-b2b4b63a-c256-4793-8591-1ce8dbd87131">
<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">self</span>.wakeupAfter(timePeriod, payload<span class="org-operator">=</span><span class="org-constant">None</span>)
</pre>
</div>

<p>
The <code>timePeriod</code> specifies a Python <code>datetime.timedelta</code> period.
When this time period has expired, the ActorSystem will deliver a
<code>WakeupMessage</code> to the Actor via the normal <code>.receiveMessage()</code>
entrypoint (the sender will be the Actor itself).  See <a href="#hH-9cc1acd4-7f35-44ac-94fc-0326dc87a7a5">Timer
Messages</a> for more information.
</p>

<p>
The <code>payload</code> argument can be used to specify a value that is held
by Thespian and returned in the <code>WakeupMessage</code> when the elapsed
time has expired.  The <code>payload</code> can be used by the Actor to
provide context for the wakeup operation.  The <code>payload</code> value is
arbitrary, but it is accrued against the actor's memory until it
is delivered; hence, it is recommended to keep the <code>payload</code>
reasonably small.
</p>
</div>
</div>

<div id="outline-container-hH-4022d522-cdc6-487a-b5d5-5d992572c531" class="outline-3">
<h3 id="hH-4022d522-cdc6-487a-b5d5-5d992572c531"><span class="section-number-3">5.6.</span> handleDeadLetters</h3>
<div class="outline-text-3" id="text-hH-4022d522-cdc6-487a-b5d5-5d992572c531">
<div class="org-src-container">
<pre class="src src-python">    <span class="org-keyword">self</span>.handleDeadLetters(startHandling<span class="org-operator">=</span><span class="org-constant">True</span>)
</pre>
</div>

<p>
This method can be called to register or de-register this Actor for
handling Dead Letters.
</p>
</div>
</div>

<div id="outline-container-hH-b9f7a2f0-7d2a-4cc0-8241-1fee7c62c44e" class="outline-3">
<h3 id="hH-b9f7a2f0-7d2a-4cc0-8241-1fee7c62c44e"><span class="section-number-3">5.7.</span> notifyOnSystemRegistrationChanges</h3>
<div class="outline-text-3" id="text-hH-b9f7a2f0-7d2a-4cc0-8241-1fee7c62c44e">
<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">self</span>.notifyOnSystemRegistrationChanges(startHandling<span class="org-operator">=</span><span class="org-constant">True</span>)
</pre>
</div>

<p>
This method can be called to register or de-register this Actor for
handling system registration events from other ActorSystems (see
<a href="#hH-3c8aa454-9a21-4d24-a623-ad86bfd4f5a7">Other Actor Systems</a>) via <a href="#hH-f311fc02-d355-4d68-b9af-958404637e57">ActorSystemConventionUpdate</a> messages.
</p>
</div>
</div>

<div id="outline-container-hH-5ae05479-5a6d-4f01-bd7d-c4f544f7b98a" class="outline-3">
<h3 id="hH-5ae05479-5a6d-4f01-bd7d-c4f544f7b98a"><span class="section-number-3">5.8.</span> registerSourceAuthority</h3>
<div class="outline-text-3" id="text-hH-5ae05479-5a6d-4f01-bd7d-c4f544f7b98a">
<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">self</span>.registerSourceAuthority()
</pre>
</div>

<p>
This method registers the current Actor as the Source Authority
handler for the current ActorSystem as described in the <a href="#hH-b26e4f60-d3fa-40b1-bc33-bb20b61ff2d4">Security Considerations</a> section of the <a href="#hH-731cff6e-674d-4341-bd92-80a08113d5df">loadActorSource</a> ActorSystem API
call.  Once registered, this Actor will receive <a href="#hH-3119580d-80a6-4061-a217-1b2b21014172">ValidateSource</a>
messages and be responsible for decrypting (if necessary) and
determining authorization for loaded sources to run.
</p>

<p>
The current Actor continues as the Source Authority until another
Actor registers for this role.
</p>
</div>
</div>

<div id="outline-container-hH-731cff6e-674d-4341-bd92-80a08113d5df" class="outline-3">
<h3 id="hH-731cff6e-674d-4341-bd92-80a08113d5df"><span class="section-number-3">5.9.</span> loadActorSource</h3>
<div class="outline-text-3" id="text-hH-731cff6e-674d-4341-bd92-80a08113d5df">
<div class="org-src-container">
<pre class="src src-python"><span class="org-variable-name">sourceHash</span> <span class="org-operator">=</span> <span class="org-keyword">self</span>.loadActorSource(fileref)
</pre>
</div>

<p>
The <code>loadActorSource()</code> method is used to load a (possibly
encrypted) zipfile containing Python source code in standard Python
zipimport format (via PEP302<sup><a id="fnr.1" class="footref" href="#fn.1" role="doc-backlink">1</a></sup> methodologies).  The return value
is an internally-generated hash value identifying that loaded source
zipfile that can be used in subsequent <a href="#hH-3663d87d-8a2f-485b-aeef-c6e9cf418b4c">createActor</a> calls to
instantiate Actors found in that sourcefile.
</p>

<p>
There must be a valid Source Authority registered (via the
<a href="#hH-5ae05479-5a6d-4f01-bd7d-c4f544f7b98a">registerSourceAuthority</a> method) to validate the loaded source; by
default this method does nothing if no Source Authority has been
loaded.  See <a href="#hH-b26e4f60-d3fa-40b1-bc33-bb20b61ff2d4">Security Considerations</a> for more information.
</p>

<p>
See the description of the same function in the <a href="#hH-7d2b4986-95d3-4460-9d19-ea0dcdb34fca">ActorSystem API</a>
section for more details.
</p>
</div>
</div>

<div id="outline-container-hH-02eaa317-996a-419b-b9e5-462a28a749c0" class="outline-3">
<h3 id="hH-02eaa317-996a-419b-b9e5-462a28a749c0"><span class="section-number-3">5.10.</span> unloadActorSource</h3>
<div class="outline-text-3" id="text-hH-02eaa317-996a-419b-b9e5-462a28a749c0">
<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">self</span>.unloadActorSource(sourceHash)
</pre>
</div>

<p>
The <code>unloadActorSource()</code> method is used to unload a source zipfile
previously loaded by the <a href="#hH-731cff6e-674d-4341-bd92-80a08113d5df">loadActorSource</a> operation.
</p>

<p>
See the description of the same function in the <a href="#hH-7d2b4986-95d3-4460-9d19-ea0dcdb34fca">ActorSystem API</a>
section for more details.
</p>
</div>
</div>

<div id="outline-container-hH-460d04d8-3961-43c4-a4c3-8282c2e4a892" class="outline-3">
<h3 id="hH-460d04d8-3961-43c4-a4c3-8282c2e4a892"><span class="section-number-3">5.11.</span> notifyOnSourceAvailability</h3>
<div class="outline-text-3" id="text-hH-460d04d8-3961-43c4-a4c3-8282c2e4a892">
<div class="org-src-container">
<pre class="src src-python">    <span class="org-keyword">self</span>.notifyOnSourceAvailability(enable<span class="org-operator">=</span><span class="org-constant">True</span>)
</pre>
</div>

<p>
This method can be called to register or de-register (based on the
<code>enable</code> argument) this Actor for being informed of loaded or
unloaded source loads.  Load notifications are delivered via the
<a href="#hH-7cc41555-6b60-4844-8cea-0ec3714cf8f8">LoadedSource</a> message and source unloads generate <a href="#hH-2a5fa63d-e6eb-43b9-bea8-47223b27544e">UnloadedSource</a>
messages to the notification registrant.
</p>

<p>
Registration is with the local actor system only, and notifications
are only for loads and unloads of available sources in the local
system; remote registration and corresponding notifications are
available, but are not triggered by local load or unload events.
</p>
</div>
</div>

<div id="outline-container-hH-0e9f4a6a-3083-40fa-a75b-ced37d70eef0" class="outline-3">
<h3 id="hH-0e9f4a6a-3083-40fa-a75b-ced37d70eef0"><span class="section-number-3">5.12.</span> actorSystemCapabilityCheck</h3>
<div class="outline-text-3" id="text-hH-0e9f4a6a-3083-40fa-a75b-ced37d70eef0">
<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">def</span> <span class="org-function-name">actorSystemCapabilityCheck</span>(capabilities, requirements<span class="org-operator">=</span><span class="org-constant">None</span>):
    <span class="org-keyword">return</span> <span class="org-constant">True</span>
</pre>
</div>

<p>
This is a <b>static</b> method provided by the Actor object that is
called to see if the Actor can be created within the context of the
current ActorSystem.
</p>

<p>
The <code>capabilities</code> argument specifies the key/value dictionary of
capabilities of the current ActorSystem.  ActorSystem capabilities
are free-form and are determined solely by agents specifying those
capabilities (see <a href="#hH-a17e6c70-5592-4d06-b818-bd25350c4c53">ActorSystem Capabilities</a>).
</p>

<p>
The optional <code>requirements</code> argument specifies the additional
requirements that the creating Actor specified in the
<code>.createActor()</code> call.
</p>

<p>
The <code>.actorSystemCapabilityCheck()</code> should return <code>True</code> to indicate
that the Actor may be created in the current ActorSystem, or <code>False</code>
to indicate otherwise.  It is free to base this decision on any,
all, or none of the capabilities or requirements provided.
</p>

<p>
This static method may also be called to re-validate the Actor's
viability if the capabilities of its ActorSystem are updated (as
described in the <a href="#hH-1dc4362f-78dd-4adf-833c-d7bebda07ef8">updateCapability</a> section), and if it returns False
then the existing Actor will be killed with an <a href="#hH-7e6106e4-a631-47a4-9d22-3fd63f7e1951">ActorExitRequest</a>
message.
</p>
</div>

<div id="outline-container-hH-3bafc1e2-9e3d-4073-8e75-c01ad792b5be" class="outline-4">
<h4 id="hH-3bafc1e2-9e3d-4073-8e75-c01ad792b5be"><span class="section-number-4">5.12.1.</span> requireCapability decorator</h4>
<div class="outline-text-4" id="text-hH-3bafc1e2-9e3d-4073-8e75-c01ad792b5be">
<p>
To facilitate easy specification of requirements, there is a
<code>requireCapability</code> class decorator defined which can be used to
specify that a capability must be present in the system
capabilities.
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-type">@requireCapability</span>(capabilityName[, capabilityValue])
</pre>
</div>

<p>
The <code>requireCapability</code> decorator can also specify a
value for the capability; if no value is specified then the
capability's value must be "truthy" (i.e. some expression that
evaluates as truthful).
</p>

<p>
The decorator can be repeated multiple times for a single Actor and
it may be used in conjunction with an actual
<code>actorSystemCapabilityCheck()</code> method.
</p>

<p>
For example:
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">class</span> <span class="org-type">MyActor</span>(Actor):

    @<span class="org-builtin">staticmethod</span>
    <span class="org-keyword">def</span> <span class="org-function-name">actorSystemCapabilityCheck</span>(capabilities, requirements):
        <span class="org-keyword">return</span> capabilities.get(<span class="org-string">'Has Lightbulb'</span>, <span class="org-constant">False</span>) <span class="org-keyword">and</span> \
               capabilities.get(<span class="org-string">'Lit'</span>, <span class="org-constant">False</span>) <span class="org-keyword">and</span> \
               capabilities.get(<span class="org-string">'Color'</span>, <span class="org-string">'none'</span>) <span class="org-operator">==</span> <span class="org-string">'Yellow'</span>

    <span class="org-keyword">def</span> <span class="org-function-name">receiveMessage</span>(<span class="org-keyword">self</span>, msg, sender): <span class="org-keyword">pass</span>
</pre>
</div>

<p>
is equivalent to the following combined use:
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-type">@requireCapability</span>(<span class="org-string">'Has Lightbulb'</span>)
<span class="org-type">@requireCapability</span>(<span class="org-string">'Lit'</span>)
<span class="org-keyword">class</span> <span class="org-type">MyActor</span>(Actor):

    @<span class="org-builtin">staticmethod</span>
    <span class="org-keyword">def</span> <span class="org-function-name">actorSystemCapabilityCheck</span>(capabilities, requirements):
        <span class="org-keyword">return</span> capabilities.get(<span class="org-string">'Color'</span>, <span class="org-string">'none'</span>) <span class="org-operator">==</span> <span class="org-string">'Yellow'</span>

    <span class="org-keyword">def</span> <span class="org-function-name">receiveMessage</span>(<span class="org-keyword">self</span>, msg, sender): <span class="org-keyword">pass</span>
</pre>
</div>

<p>
or the equivalent use of only the decorator:
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-type">@requireCapability</span>(<span class="org-string">'Has Lightbulb'</span>)
<span class="org-type">@requireCapability</span>(<span class="org-string">'Lit'</span>)
<span class="org-type">@requireCapability</span>(<span class="org-string">'Color'</span>, <span class="org-string">'Yellow'</span>)
<span class="org-keyword">class</span> <span class="org-type">MyActor</span>(Actor):

    <span class="org-keyword">def</span> <span class="org-function-name">receiveMessage</span>(<span class="org-keyword">self</span>, msg, sender): <span class="org-keyword">pass</span>
</pre>
</div>

<p>
In the above examples, the <code>MyActor</code> Actor can be instantiated
in an ActorSystem that had the capabilities of:
</p>

<div class="org-src-container">
<pre class="src src-python">{
  <span class="org-string">'Has Lightbulb'</span>: 5,
  <span class="org-string">'Lit'</span>: <span class="org-constant">True</span>,
  <span class="org-string">'Color'</span> : <span class="org-string">'Yellow'</span>
}
</pre>
</div>

<p>
Note that the value of 5 is "true", as compared to a value of 0
that is "false".  Any value that would represent as true in an <b>if</b>
expression is a valid value.
</p>

<p>
An example of a much simpler case:
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">class</span> <span class="org-type">MyActor</span>(Actor):

    @<span class="org-builtin">staticmethod</span>
    <span class="org-keyword">def</span> <span class="org-function-name">actorSystemCapabilityCheck</span>(capabilities, requirements):
        <span class="org-keyword">return</span> capabilities.get(<span class="org-string">'Has Lightbulb'</span>, <span class="org-constant">False</span>)

    <span class="org-keyword">def</span> <span class="org-function-name">receiveMessage</span>(<span class="org-keyword">self</span>, msg, sender): <span class="org-keyword">pass</span>
</pre>
</div>

<p>
is equivalent to:
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-type">@requireCapability</span>(<span class="org-string">'Has Lightbulb'</span>)
<span class="org-keyword">class</span> <span class="org-type">MyActor</span>(Actor):

    <span class="org-keyword">def</span> <span class="org-function-name">receiveMessage</span>(<span class="org-keyword">self</span>, msg, sender): <span class="org-keyword">pass</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-hH-1dc4362f-78dd-4adf-833c-d7bebda07ef8" class="outline-3">
<h3 id="hH-1dc4362f-78dd-4adf-833c-d7bebda07ef8"><span class="section-number-3">5.13.</span> updateCapability</h3>
<div class="outline-text-3" id="text-hH-1dc4362f-78dd-4adf-833c-d7bebda07ef8">
<p>
The <code>updateCapability()</code> method is used to update the capabilities of
the current ActorSystem this Actor is running in (there is a
corresponding method on the ActorSystem for externally-specified
updates; see the <a href="#hH-7d2b4986-95d3-4460-9d19-ea0dcdb34fca">ActorSystem API</a> for that version).
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">self</span>.updateCapability(capabilityName, capabilityValue<span class="org-operator">=</span><span class="org-constant">None</span>)
</pre>
</div>

<p>
If the capability value is specified and is not None, the specified
capability already exists, its value updated, otherwise it is
created with the specified value.
</p>

<p>
If the capability value is not specified or is None, the specified
capability is removed from the ActorSystem if it exists.
</p>

<p>
If the capabilities of the ActorSystem are modified by this method
(i.e. the capability value is not already set as requested) then
all Actors within that ActorSystem are re-validated by calling
their <a href="#hH-0e9f4a6a-3083-40fa-a75b-ced37d70eef0">actorSystemCapabilityCheck</a> static method and sending them an
ActorExitRequest if the capability check call returns false.  This
could result in killing the Actor that initiated the capability
exchange, even if new capabilities are added.  Actors may be
recreated as desired; the new Actors will validate against the new
set of capabilities.
</p>

<p>
The current set of ActorSystem capabilities can be obtained by
issuing a <a href="#hH-6428fa90-8749-4777-a0b1-752ec5eb1650">Thespian_StatusReq</a> to the ActorSystem.
</p>
</div>
</div>

<div id="outline-container-hH-956e30d5-c035-4e1e-86cb-73332e28d8d4" class="outline-3">
<h3 id="hH-956e30d5-c035-4e1e-86cb-73332e28d8d4"><span class="section-number-3">5.14.</span> preRegisterRemoteSystem</h3>
<div class="outline-text-3" id="text-hH-956e30d5-c035-4e1e-86cb-73332e28d8d4">
<p>
The <code>preRegisterRemoteSystem()</code> method is used to inform the local
ActorSystem about a remote ActorSystem.
</p>

<p>
<i>This method is normally not used or needed, and should be avoided
if possible.</i>
</p>

<p>
Normally ActorSystems will communicate with each other and
automatically perform discovery, and Actors themselves should not
be aware or involved this functionality.
</p>

<p>
However, there are certain transport configurations where this
auto-discovery is not possible.  In these configurations, this
method can be used to initiate communications between the two
ActorSystems.  This method will only work for ActorSystem bases
that support Conventions (as describe in the <a href="#hH-3c8aa454-9a21-4d24-a623-ad86bfd4f5a7">Other Actor Systems</a>
section).
</p>

<p>
Because the remote System and the local System cannot
perform auto-discovery, the local system also assumes
responsibility for actively initiating convention membership checks
of the pre-registered remote system.  These pre-registration checks
will continue to occur periodically until the pre-registered remote
member is removed (via the <code>deRegisterRemoteSystem()</code> method
described below).  The current system will also automatically
become the Convention Leader for the remote system.
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">self</span>.preRegisterRemoteSystem(remoteSystemAddress,
                             remoteSystemCapabilities)
</pre>
</div>

<p>
The <code>remoteSystemAddress</code> parameter is not a true Actor Address: it
specifies the remote system address in string format in a syntax
that will be interpreted by the local ActorSystem.  If the
specified string is not recognizeable by the local ActorSystem, no
Convention membership will be added.  For example, the
multiprocTCPBase and multiprocUDPBase system bases can recognize
"ipaddr:port" formats.
</p>

<p>
The <code>remoteSystemCapabilities</code> parameter specifies a dictionary of
the initial remote system capabilities.  These capabilities will be
updated with actual capabilities once the two systems have
established communications.
</p>
</div>
</div>

<div id="outline-container-hH-ce801678-bcff-497d-be2a-439cb34fc519" class="outline-3">
<h3 id="hH-ce801678-bcff-497d-be2a-439cb34fc519"><span class="section-number-3">5.15.</span> deRegisterRemoteSystem</h3>
<div class="outline-text-3" id="text-hH-ce801678-bcff-497d-be2a-439cb34fc519">
<p>
The <code>deRegisterRemoteSystem()</code> method is used to unregister a
previously registered remote system.  This method is the
counterpart to the <code>preRegisterRemoteSystem()</code> method and has all
the same warnings and caveats that apply to the latter.
</p>

<p>
If the remote ActorSystem is still running and communicating with
the local ActorSystem then it will automatically re-register
itself despite having been de-registered by this method.
</p>

<p>
If there is no remote ActorSystem registered for the specified
address, or if the address cannot be successfully recognized by the
local ActorSystem, this method will simply return with no effect.
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">self</span>.preRegisterRemoteSystem(remoteSystemAddress)
</pre>
</div>

<p>
The <code>remoteSystemAddress</code> parameter may be specified in the same
manner as for the <code>preRegisterRemoteSystem()</code> and is usually the
same value that was originally passed to the latter method.  The
<code>remoteSystemAddress</code> parameter may also be an actual ActorAddress
(e.g. the same address that would be provided in the
<a href="#hH-f311fc02-d355-4d68-b9af-958404637e57">ActorSystemConventionUpdate</a> messages).
</p>
</div>
</div>

<div id="outline-container-hH-9e800ed1-ed40-4ff3-8445-f795719f6218" class="outline-3">
<h3 id="hH-9e800ed1-ed40-4ff3-8445-f795719f6218"><span class="section-number-3">5.16.</span> actorSystemShutdown</h3>
<div class="outline-text-3" id="text-hH-9e800ed1-ed40-4ff3-8445-f795719f6218">
<p>
The <code>actorSystemShutdown()</code> method can be called by an actor to
shutdown the <b>entire</b> local ActorSystem, including all Actors
currently running under that system.  This method should not
normally be needed and is intended only for situations where the
local running system is being deactivated.
</p>

<p>
The shutdown operation will be initiated immediately:
ActorExitRequests will be sent to all locally running Actors.
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">self</span>.actorSystemShutdown()
</pre>
</div>

<p>
Use this method with caution.
</p>
</div>
</div>

<div id="outline-container-hH-2f5b52bd-72b8-41eb-b879-809d174c0e30" class="outline-3">
<h3 id="hH-2f5b52bd-72b8-41eb-b879-809d174c0e30"><span class="section-number-3">5.17.</span> ActorTypeDispatcher</h3>
<div class="outline-text-3" id="text-hH-2f5b52bd-72b8-41eb-b879-809d174c0e30">
<p>
An alternative base class for creating Actors is the
<code>ActorTypeDispatcher</code> which extends the <code>Actor</code> base class.  The
<code>ActorTypeDispatcher</code> defines a `receiveMessage` method that
automatically determines the type of incoming messages and calls a
receive method related to that type instead of the generic
<code>receiveMessage()</code> called by the Actor base class.  The type-based
receive methods are named "receiveMsg_TYPE" where TYPE is the actual
type.
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">class</span> <span class="org-type">Typer</span>(ActorTypeDispatcher):

    <span class="org-keyword">def</span> <span class="org-function-name">receiveMsg_str</span>(<span class="org-keyword">self</span>, message, sender):
        <span class="org-keyword">self</span>.send(sender, <span class="org-string">"Got a string"</span>)

    <span class="org-keyword">def</span> <span class="org-function-name">receiveMsg_int</span>(<span class="org-keyword">self</span>, message, sender):
        <span class="org-keyword">self</span>.send(sender, <span class="org-string">"Got an int"</span>)
</pre>
</div>

<p>
This dispatching works for user-defined classes as well as built-in
types, and will iterate through the base classes if a higher-level
handler is not found.
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">class</span> <span class="org-type">BaseMsg</span>(<span class="org-builtin">object</span>): <span class="org-keyword">pass</span>

<span class="org-keyword">class</span> <span class="org-type">ShortMsg</span>(BaseMsg):
    <span class="org-keyword">def</span> <span class="org-function-name">__init__</span>(<span class="org-keyword">self</span>, report <span class="org-operator">=</span> <span class="org-string">''</span>):
        <span class="org-keyword">self</span>.<span class="org-variable-name">report</span> <span class="org-operator">=</span> report

<span class="org-keyword">class</span> <span class="org-type">LongMsg</span>(BaseMsg): <span class="org-keyword">pass</span>


<span class="org-keyword">class</span> <span class="org-type">Typer</span>(ActorTypeDispatcher):

    <span class="org-keyword">def</span> <span class="org-function-name">receiveMsg_str</span>(<span class="org-keyword">self</span>, message, sender):
        <span class="org-keyword">self</span>.send(sender, <span class="org-string">"Got a string"</span>)

    <span class="org-keyword">def</span> <span class="org-function-name">receiveMsg_int</span>(<span class="org-keyword">self</span>, message, sender):
        <span class="org-keyword">self</span>.send(sender, <span class="org-string">"Got an int"</span>)

    <span class="org-keyword">def</span> <span class="org-function-name">receiveMsg_LongMsg</span>(<span class="org-keyword">self</span>, message, sender):
        <span class="org-keyword">self</span>.send(sender, <span class="org-string">"Got a long message"</span>)

    <span class="org-keyword">def</span> <span class="org-function-name">receiveMsg_BaseMsg</span>(<span class="org-keyword">self</span>, message, sender):
        <span class="org-keyword">self</span>.send(sender, <span class="org-string">"Got a message"</span>)
</pre>
</div>

<pre class="example" id="org22cc587">
&gt;&gt;&gt; asys = ActorSystem()
&gt;&gt;&gt; t = asys.createActor(Typer)
&gt;&gt;&gt; print(asys.ask(t, 1))
Got an int
&gt;&gt;&gt; print(asys.ask(t, "1"))
Got a string
&gt;&gt;&gt; print(asys.ask(t, LongMsg()))
Got a long message
&gt;&gt;&gt; print(asys.ask(t, ShortMsg()))
Got a message
&gt;&gt;&gt;
</pre>

<p>
The `receiveMessage` method is defined by `ActorTypeDispatcher` so the
actor subclassing it should not define that method; if the
`receiveMessage` is defined in the subclass then it will override the
`ActorTypeDispatcher`'s implementation and all message handling will
revert to the subclass's `receiveMessage` method.
</p>
</div>

<div id="outline-container-h:96440ac7-3db5-4cb4-9496-6c8c46075f14" class="outline-4">
<h4 id="h:96440ac7-3db5-4cb4-9496-6c8c46075f14"><span class="section-number-4">5.17.1.</span> Derived Classes</h4>
<div class="outline-text-4" id="text-h:96440ac7-3db5-4cb4-9496-6c8c46075f14">
<p>
This receive method lookup also works for derived classes:
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">class</span> <span class="org-type">Subtyper</span>(Typer):
    <span class="org-keyword">def</span> <span class="org-function-name">receiveMsg_ShortMsg</span>(<span class="org-keyword">self</span>, message, sender):
        <span class="org-keyword">self</span>.send(sender, <span class="org-string">"Got a short message"</span>)
</pre>
</div>

<pre class="example" id="org417d0f7">
&gt;&gt;&gt; asys = ActorSystem()
&gt;&gt;&gt; a1 = asys.createActor(Typer)
&gt;&gt;&gt; print(asys.ask(a1, ShortMsg()))
Got a message
&gt;&gt;&gt; print(asys.ask(a1, LongMsg()))
Got a long message
&gt;&gt;&gt;
&gt;&gt;&gt; a2 = asys.createActor(Subtyper)
&gt;&gt;&gt; print(asys.ask(a2, ShortMsg()))
Got a short message
&gt;&gt;&gt; print(asys.ask(a2, LongMsg()))
Got a long message
&gt;&gt;&gt;
</pre>

<p>
The matching does not rely on import path specifications.  In the
following example, the creation of Message2 requires import
qualification, but the <code>ActorTypeDispatcher</code>-supported
<code>receiveMsg_Message1</code> will match <code>Message1</code> without the import
namespace prefix:
</p>

<div class="org-src-container">
<pre class="src src-python" id="org38e06d0"><span class="linenr">1: </span><span class="org-keyword">class</span> <span class="org-type">Message1</span>: ...
<span class="linenr">2: </span><span class="org-keyword">class</span> <span class="org-type">Message2</span>: ...
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python" id="org7b63ef7"><span class="linenr">1: </span><span class="org-keyword">import</span> messagedefs
<span class="linenr">2: </span>
<span class="linenr">3: </span><span class="org-keyword">class</span> <span class="org-type">SendActor</span>(ActorTypeDispatcher):
<span class="linenr">4: </span>    <span class="org-keyword">def</span> <span class="org-function-name">receiveMsg_Message1</span>(<span class="org-keyword">self</span>, msg, sender):
<span class="linenr">5: </span>        <span class="org-keyword">self</span>.send(sender, messagedefs.Message2())
<span class="linenr">6: </span>
<span class="linenr">7: </span><span class="org-keyword">class</span> <span class="org-type">RcvActor</span>(ActorTypeDispatcher):
<span class="linenr">8: </span>    <span class="org-keyword">def</span> <span class="org-function-name">receiveMsg_Message2</span>(<span class="org-keyword">self</span>, msg, sender):
<span class="linenr">9: </span>        ...
</pre>
</div>
</div>
</div>


<div id="outline-container-h:d92333c1-bb53-48d1-8323-f6013e479750" class="outline-4">
<h4 id="h:d92333c1-bb53-48d1-8323-f6013e479750"><span class="section-number-4">5.17.2.</span> Unrecognized Messages</h4>
<div class="outline-text-4" id="text-h:d92333c1-bb53-48d1-8323-f6013e479750">
<p>
Normally the ActorTypeDispatcher will quietly discard messages that do
not match any of the type-related receive methods.  It is possible to
specify a fallback handler for the <code>ActorTypeDispatcher</code> if the type
is not explicitly recognized by defining the
<code>receiveUnrecognizedMessage()</code> method.
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">class</span> <span class="org-type">Subtyper2</span>(Typer):

    <span class="org-keyword">def</span> <span class="org-function-name">receiveMsg_ShortMsg</span>(<span class="org-keyword">self</span>, message, sender):
        <span class="org-keyword">self</span>.send(sender, <span class="org-string">"Got a short message"</span>)

    <span class="org-keyword">def</span> <span class="org-function-name">receiveUnrecognizedMessage</span>(<span class="org-keyword">self</span>, message, sender):
        <span class="org-keyword">self</span>.send(sender, <span class="org-string">"Did not recognize the message type: %s"</span><span class="org-operator">%</span><span class="org-builtin">type</span>(message))
</pre>
</div>

<pre class="example" id="org1ca59c2">
&gt;&gt;&gt; asys = ActorSystem()
&gt;&gt;&gt; st = asys.createActor(Subtyper2)
&gt;&gt;&gt; print(asys.ask(st, ShortMsg()))
Got a short message
&gt;&gt;&gt; print(asys.ask(st, 1))
Got an int
&gt;&gt;&gt; print(asys.ask(st, 1.0))
Did not recognize the message type: &lt;type 'float'&gt;
&gt;&gt;&gt;
</pre>

<p>
It is important to note that an Actor based on the
ActorTypeDispatcher that is also using the <a href="#org795302e">5.2.1</a>
functionality should implement the <code>receiveUnrecognizedMessage</code>
entrypointto ensure that a proper <code>ThespianWatch</code> message is
returned when an unrecognized message is received.
</p>
</div>
</div>

<div id="outline-container-hH-e58ce3a1-df40-4d3f-bc1f-e7743e3c1dc1" class="outline-4">
<h4 id="hH-e58ce3a1-df40-4d3f-bc1f-e7743e3c1dc1"><span class="section-number-4">5.17.3.</span> Type Handling Deferral</h4>
<div class="outline-text-4" id="text-hH-e58ce3a1-df40-4d3f-bc1f-e7743e3c1dc1">
<p>
In a normal Python subclass, it is possible for a method in the
subclass to call a method in the base class by using the <code>super()</code>
function:
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">class</span> <span class="org-type">ClassA</span>(<span class="org-builtin">object</span>):
    <span class="org-keyword">def</span> <span class="org-function-name">method1</span>(<span class="org-keyword">self</span>): <span class="org-keyword">pass</span>

<span class="org-keyword">class</span> <span class="org-type">ClassB</span>(<span class="org-builtin">object</span>):
    <span class="org-keyword">def</span> <span class="org-function-name">method1</span>(<span class="org-keyword">self</span>, val):
        <span class="org-keyword">if</span> val <span class="org-operator">==</span> 1: <span class="org-keyword">pass</span>
        <span class="org-builtin">super</span>(ClassB, <span class="org-keyword">self</span>).method1()
</pre>
</div>

<p>
However, this <code>super()</code> technique is not as useful when using the
<code>ActorTypeDispatcher</code> because it only looks for the specifically
identified method, which would abort the receive handler search
operation implemented by <code>ActorTypeDispatcher</code>:
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">class</span> <span class="org-type">SubTyper3</span>(Typer):
    <span class="org-keyword">def</span> <span class="org-function-name">receiveMsg_ShortMsg</span>(<span class="org-keyword">self</span>, message, sender):
        <span class="org-keyword">if</span> <span class="org-string">"private"</span> <span class="org-keyword">in</span> message.report:
            <span class="org-builtin">super</span>(SubTyper3, <span class="org-keyword">self</span>).receiveMsg_ShortMsg(<span class="org-keyword">self</span>, message, sender)
        <span class="org-keyword">else</span>:
            <span class="org-keyword">self</span>.send(sender, <span class="org-string">"Got a public short message"</span>)
</pre>
</div>

<pre class="example" id="org697b925">
&gt;&gt;&gt; asys = ActorSystem()
&gt;&gt;&gt; st = asys.createActor(SubTyper3)
&gt;&gt;&gt; print(asys.ask(st, ShortMsg("This is public")), 2)
Got a public short message
&gt;&gt;&gt; print(asys.ask(st, ShortMsg("This is private")), 2)
# Poison message trace because super has no 'receiveMsg_ShortMsg'
&gt;&gt;&gt;
</pre>

<p>
The last step in the above example timed out (returning <code>None</code>)
because there is no base class with an explicity
<code>receiveMsg_ShortMsg()</code> method.  Instead, the current method should
return <code>ActorTypeDispatcher.SUPER</code> to instruct the
<code>ActorTypeDispatcher</code> to continue the normal search,
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">class</span> <span class="org-type">SubTyper4</span>(Typer):
    <span class="org-keyword">def</span> <span class="org-function-name">receiveMsg_ShortMsg</span>(<span class="org-keyword">self</span>, message, sender):
        <span class="org-keyword">if</span> <span class="org-string">"private"</span> <span class="org-keyword">in</span> message.report:
            <span class="org-keyword">return</span> <span class="org-keyword">self</span>.SUPER
        <span class="org-keyword">else</span>:
            <span class="org-keyword">self</span>.send(sender, <span class="org-string">"Got a public short message"</span>)
</pre>
</div>

<pre class="example" id="org3ffc387">
&gt;&gt;&gt; asys = ActorSystem()
&gt;&gt;&gt; st = asys.createActor(SubTyper4)
&gt;&gt;&gt; print(asys.ask(st, ShortMsg("This is public"), 2))
Got a public short message
&gt;&gt;&gt; print(asys.ask(st, ShortMsg("This is private"), 2))
Got a message
&gt;&gt;&gt;
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-hH-7d2b4986-95d3-4460-9d19-ea0dcdb34fca" class="outline-2">
<h2 id="hH-7d2b4986-95d3-4460-9d19-ea0dcdb34fca"><span class="section-number-2">6.</span> ActorSystem API</h2>
<div class="outline-text-2" id="text-hH-7d2b4986-95d3-4460-9d19-ea0dcdb34fca">
<p>
The ActorSystem is created or connected-to by instantiating the
ActorSystem object.  External applications use the ActorSystem API
to interact with Actors running within that system.
</p>

<p>
The ActorSystem API is made available by importing the
<code>thespian.actors</code> module:
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">import</span> thespian.actors
</pre>
</div>
</div>

<div id="outline-container-hH-a91e6169-660d-4df0-af13-15b3ad5e63bc" class="outline-3">
<h3 id="hH-a91e6169-660d-4df0-af13-15b3ad5e63bc"><span class="section-number-3">6.1.</span> Exceptions</h3>
<div class="outline-text-3" id="text-hH-a91e6169-660d-4df0-af13-15b3ad5e63bc">
<p>
All exceptions generated by the ActorSystem itself are based on the
<code>ActorSystemException</code> base class.
</p>

<p>
Exceptions which are generated as a result of unexpected failures
within calls to the ActorSystem are based on the
<code>ActorSystemFailure</code> base class.  It is not expected that these are
caused by an application error or that they can be retried and/or
fixed by the application to expect a successful result.
</p>

<p>
The following shows the heirarchy of defined Thespian exceptions:
</p>

<ul class="org-ul">
<li><code>ActorSystemException</code>
<ul class="org-ul">
<li><code>InvalidActorAddress</code></li>
<li><code>NoCompatibleSystemForActor</code></li>
<li><code>ActorSystemFailure</code>
<ul class="org-ul">
<li><code>ActorSystemStartupFailure</code></li>
<li><code>ActorSystemRequestTimeout</code></li>
</ul></li>
<li><code>InvalidActorSourceHash</code></li>
<li><code>InvalidActorSpecification</code></li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-hH-f71b7bfa-c57b-4716-a2c7-ad83a2ed3582" class="outline-3">
<h3 id="hH-f71b7bfa-c57b-4716-a2c7-ad83a2ed3582"><span class="section-number-3">6.2.</span> ActorSystem</h3>
<div class="outline-text-3" id="text-hH-f71b7bfa-c57b-4716-a2c7-ad83a2ed3582">
<div class="org-src-container">
<pre class="src src-python"><span class="org-variable-name">actorSys</span> <span class="org-operator">=</span> ActorSystem(systemBase <span class="org-operator">=</span> <span class="org-constant">None</span>,
                       capabilities <span class="org-operator">=</span> <span class="org-constant">None</span>,
                       logDefs <span class="org-operator">=</span> <span class="org-constant">None</span>,
                       transientUnique <span class="org-operator">=</span> <span class="org-constant">False</span>)
</pre>
</div>

<p>
The <code>systemBase</code> argument should specify which ActorSystem
implementation base should be used for this ActorSystem, as
selected from those systems describe in the <a href="#hH-2a5fa63d-e6eb-43b9-bea8-47223b27544e">ActorSystem Implementations</a> section. If <code>systemBase</code> is None, this call will
check to see if there was a previous call to ActorSystem in the
current process and if so, re-use the <code>systemBase</code> from the
previous call. If there is no previous call, the default system
base is the <code>simpleSystemBase</code> (see <a href="#hH-924dc0fe-c15b-491e-a6d1-8b88683d4c0d">simpleSystemBase</a>).
</p>

<p>
The <code>capabilities</code> argument should be a dictionary of capability
keys and values as describe in the <a href="#hH-a17e6c70-5592-4d06-b818-bd25350c4c53">ActorSystem Capabilities</a>
section.  These capabilities form the initial set of capabilities
for the ActorSystem if it is started; the capabilities are ignored
if an ActorSystem is already running.
</p>

<p>
The <code>logDefs</code> argument is used to specify a logging configuration
dictionary (in standard logdict format).  If not specified, a
default logging configuration is usually supplied.  If specified
as <code>False</code>, then no logging configuration is supplied; this latter
is useful in situations where another component is attempting to
establish a logging configuration (e.g. nosetest logcapture).  As
described in the <a href="#hH-ce55494c-dd7a-4258-a1e8-b090c3bbb1e6">Logging</a> section, the Convention Leader will
receive forwarding of log messages at Warning level or higher,
providing a centralized logging capability.
</p>

<p>
Normally the created ActorSystem becomes a process-wide (and
possibly system-wide) singleton instance.  The <code>transientUnique</code>
argument may be set to true to get a new, un-registered
ActorSystem.  This leads to the following behavior:
</p>

<dl class="org-dl">
<dt><code>ActorSystem(...)</code></dt><dd>return an object which references an
ActorSystem with the configuration specified by the
arguments, creating a new ActorSystem if necessary.
Subsequent calls with the same arguments will get an
instance referencing that same ActorSystem.</dd>

<dt><code>ActorSystem()</code></dt><dd><p>
return an object which references any
previous ActorSystem created by this process.  If there is
no ActorSystem, it will create one with the default
parameters (currently defaulting to a "simpleSystemBase"
instance).  This is a convenience mechanism for accessing an
ActorSystem that may have been created elsewhere in the
application where more specific knowledge regarding the
creation parameters was available.
</p>

<pre class="example" id="org2140247">
          def start_system():
              cfg = read_config_file()
              ActorSystem(systemBase=cfg.system_base,
                          capabilities = { 'foo': cfg.foo_capability, ...},
                          ...)

          def do_something():
              mine = ActorSystem().createActor(MyActor)
              r = ActorSystem().ask(mine, 'ready?', timedelta(seconds=3))
              ...

          if __name__ == "__main__":
              start_system()
              do_something()
</pre>

<p>
The following is equivalent to the above, although it
requires extra code to pass the actor system to the various
components needing it:
</p>

<pre class="example" id="orgf66b05e">
          def start_system():
              cfg = read_config_file()
              asys = ActorSystem(systemBase=cfg.system_base,
                                 capabilities = { 'foo': cfg.foo_capability, ...},
                                 ...)
              return asys

          def do_something(asys):
              mine = asys.createActor(MyActor)
              r = asys.ask(mine, 'ready?', timedelta(seconds=3))
              ...

          if __name__ == "__main__":
              asys = start_system()
              do_something(asys)
</pre></dd>

<dt><code>ActorSystem(..., transientUnique=True)</code></dt><dd>ensures that a new
ActorSystem is created instead of retrieving a
previously-created ActorSystem.  Note that the other
arguments should specify the configuration of the new
ActorSystem, and global resource collisions (e.g. port
names) will prevent the new ActorSystem from being created.</dd>
</dl>
</div>
</div>


<div id="outline-container-hH-654a6c81-b326-4c0a-98bc-638ac5ce631f" class="outline-3">
<h3 id="hH-654a6c81-b326-4c0a-98bc-638ac5ce631f"><span class="section-number-3">6.3.</span> ActorSystem.shutdown</h3>
<div class="outline-text-3" id="text-hH-654a6c81-b326-4c0a-98bc-638ac5ce631f">
<div class="org-src-container">
<pre class="src src-python">actorSys.shutdown()
</pre>
</div>

<p>
The <code>shutdown()</code> ActorSystem method is used to terminate an
ActorSystem and all Actors running in that system.  If issued to a
ActorSystem that is part of a multi-system Convention that
ActorSystem is shutdown and the other Convention members are
notified (but they continue to exist).
</p>

<p>
As described previously, the ActorSystem is a process-global
singleton that may be a system-wide singleton, depending on the
system base used (see <a href="#hH-2a5fa63d-e6eb-43b9-bea8-47223b27544e">ActorSystem Implementations</a> for details).
The <code>shutdown()</code> method is the proper way to stop those
process-wide or system-wide ActorSystems when they are no longer
needed.  The decision of when to do this is left to the user; in
some situations the ActorSystem should be a long-running service
that matches the lifetime of the system itself.
</p>

<p>
If the ActorSystem was started with <code>transientUnique = True</code>, the
<code>shutdown()</code> should still be used to properly stop the current
ActorSystem, but any global ActorSystem registration will be
unaffected by stopping the transient unique ActorSystem.
</p>
</div>
</div>

<div id="outline-container-hH-a565af1b-aabb-4336-a51d-7505c072c319" class="outline-3">
<h3 id="hH-a565af1b-aabb-4336-a51d-7505c072c319"><span class="section-number-3">6.4.</span> ActorSystem.createActor</h3>
<div class="outline-text-3" id="text-hH-a565af1b-aabb-4336-a51d-7505c072c319">
<div class="org-src-container">
<pre class="src src-python"><span class="org-variable-name">actorAddr</span> <span class="org-operator">=</span> actorSys.createActor(actorClass,
                                 targetActorRequirements <span class="org-operator">=</span> <span class="org-constant">None</span>,
                                 globalName <span class="org-operator">=</span> <span class="org-constant">None</span>,
                                 sourceHash <span class="org-operator">=</span> <span class="org-constant">None</span>)
</pre>
</div>

<p>
The <code>createActor()</code> method is used by external applications to
request the creation of an Actor in the ActorSystem environment.
This call is very similar to the <a href="#hH-3663d87d-8a2f-485b-aeef-c6e9cf418b4c">createActor</a> Actor API call except
that this version creates "Top-Level" Actors and will block until
the Actor is created and throw an exception on failures.
</p>

<p>
The <code>actorClass</code> argument can be specified either as a class object
or as a module-qualified string identifying a class object
(e.g. "foo.bar.BarActor" will search for <code>class BarActor</code> in the
<code>bar.py</code> in the <code>foo</code> directory).
</p>

<p>
The <code>targetActorRequirements</code> argument is a value that will be
passed to the <a href="#hH-0e9f4a6a-3083-40fa-a75b-ced37d70eef0">actorSystemCapabilityCheck</a> to use for validating
whether the Actor can be started within the current ActorSystem
environment (see <a href="#hH-a17e6c70-5592-4d06-b818-bd25350c4c53">ActorSystem Capabilities</a>).  The value specified
for this argument can be anything the target Actor's
<code>actorSystemCapabilityCheck()</code> method can understand, although
typically it is a Python dictionary.
</p>

<p>
The <code>globalName</code> argument, if specified, should be a string
specifying the "name" of the Actor within the ActorSystem.  As
describe in <a href="#hH-2d5ef9c7-2132-45f9-b6eb-6f2729f5b232">Named Actors</a>, this name allows the Actor to be a
system-wide singleton and to be uniquely identified and referenced
in a manner additional to the ActorAddress of the actor.
</p>

<p>
The <code>sourceHash</code> argument, if specified, indicates a source file
which should be prepended to the import path when attempting to
load the <code>actorClass</code> source and start the Actor.
</p>
<ul class="org-ul">
<li>The source file must previously have been loaded by the
<a href="#hH-73b564d2-faa3-4fc8-bfdf-5362626c03be">loadActorSource</a> operation.</li>
<li>If not specified, then the <code>actorClass</code> is expected to be found
on the standard path.  If the <code>sourceHash</code> value does not match
any loaded sources then an <code>InvalidActorSourceHash</code>
exception will be thrown.</li>
<li>If the <code>globalName</code> argument is already specified and an Actor
is running under that name, this argument is ignored, even if
the running Actor did not come from the specified source file;
otherwise the Actor started and assigned the global name.</li>
<li>The specified loaded source file is merely prepended to the
search list.  If the loaded source file does not contain source
for the specified <code>actorClass</code> but the standard path
environment for the running Thespian ActorSystem <b>does</b> contain
source for that <code>actorClass</code>, then the latter will be used to
instantiate the new Actor.</li>
<li>The source specified by the hash must have been loaded into the
current ActorSystem, or previously have been obtained from a
remote ActorSystem; this operation will <b>not</b> cause a query of
remote actor systems to locate the source if the Actor cannot
be found locally (the behavior of a <code>createActor()</code>
call made by an Actor itself may be different).</li>
</ul>

<p>
This method may throw the following exceptions:
</p>

<ul class="org-ul">
<li><code>NoCompatibleSystemForActor</code> if it is unable to find an
ActorSystem whose capabilities match the Actor's requirements.</li>

<li><code>InvalidActorSourceHash</code> if a source hash is specified that does
not match any currently loaded source.</li>
</ul>
</div>
</div>

<div id="outline-container-hH-a5dcf9d2-7bda-43c7-ab44-86265992e972" class="outline-3">
<h3 id="hH-a5dcf9d2-7bda-43c7-ab44-86265992e972"><span class="section-number-3">6.5.</span> tell</h3>
<div class="outline-text-3" id="text-hH-a5dcf9d2-7bda-43c7-ab44-86265992e972">
<p>
Tell is used to inject a message into the Actor system (targeting a
specific Actor) without waiting for any response message.
</p>

<div class="org-src-container">
<pre class="src src-python">actorSys.tell(targetAddr, message)
</pre>
</div>

<p>
The <code>targetAddr</code> must be an Actor Address known to the current
application (global Actors are useful targets in this regard).
</p>

<p>
The <code>message</code> may be anything that can be sent to a remote process
(i.e. pickled).
</p>

<p>
The <code>tell()</code> operation does not await a response, but it may block
until the send is completed.
</p>
</div>
</div>

<div id="outline-container-hH-8e52624b-cda1-4218-bc9f-693cf06b0758" class="outline-3">
<h3 id="hH-8e52624b-cda1-4218-bc9f-693cf06b0758"><span class="section-number-3">6.6.</span> ask</h3>
<div class="outline-text-3" id="text-hH-8e52624b-cda1-4218-bc9f-693cf06b0758">
<p>
Ask is used to send a message to an Actor (injecting it into the
Actor system) and wait for a response message.
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-variable-name">responseMessage</span> <span class="org-operator">=</span> actorSys.ask(targetAddr, message[, timeout])
</pre>
</div>

<p>
As with the <code>tell()</code> operation, the target address must be a valid
Actor Address and the <code>message</code> can be anything that can be sent.
</p>

<p>
The "response message" is any message received by the local
endpoint.  The local endpoint looks like a normal Actor with an
ActorAddress to the rest of the system.  <b>Any</b> Actor sending a
message to this address will cause the <code>ask()</code> operation to
complete with that message.
</p>

<p>
If the <code>timeout</code> field specifies a non-None timeout value then the
<code>ask()</code> will only block for the specified timeout period, returning
a None value if the timeout has occurred.  The recommended manner
of specifying a timeout period is as an instance of the
<code>datetime.timedelta</code> class, although an integer or floating point
value will be accepted as a specification of a number of seconds.
</p>
</div>

<div id="outline-container-hH-b660216f-003b-4041-93cb-566be7edf72c" class="outline-4">
<h4 id="hH-b660216f-003b-4041-93cb-566be7edf72c"><span class="section-number-4">6.6.1.</span> Gotchas</h4>
<div class="outline-text-4" id="text-hH-b660216f-003b-4041-93cb-566be7edf72c">
<ul class="org-ul">
<li>The response may come from a previous <code>tell()</code> (or <code>ask()</code> if that
ask caused the Actor to send multiple messages to the requestor,
not the message sent as part of this <code>ask()</code>.</li>

<li>Each <code>ask()</code> call terminates with a single response; if Actors have
sent multiple messages to the <code>ask()</code> endpoint, the additional
messages may either be delivered on subsequent <code>ask()</code> calls, or
discarded as failed message sends if this endpoint does not issue
an <code>ask()</code> in a reasonable time period.</li>

<li>If using the <code>simpleSystemBase</code> (currently the default if no base
is specified on the initial <code>ActorSystem()</code> call) then timeouts
are unlikely to work as expected.  For example, an actor call that
sleeps for 5 seconds and then sends a response will block all
processing and the response will be delivered, even if the <code>ask()</code>
specified a timeout shorter than the 5 seconds.  Furthermore, if
there are no actor messages to be propagated and handled, the
<code>simpleSystemBase</code> call to <code>ask()</code> will return immediately and
without waiting for any requested time period.</li>
</ul>

<p>
These concerns can obviously make using <code>ask()</code> tricky if there are
<code>tell()</code> calls that cause responses or multiple responses to an ask;
the application must be prepared to use techniques like no-response
<code>asks()</code> with timeouts and message identifiers to
</p>
</div>
</div>
</div>

<div id="outline-container-hH-c68f8ef8-94e9-46d6-8e67-634d04c16562" class="outline-3">
<h3 id="hH-c68f8ef8-94e9-46d6-8e67-634d04c16562"><span class="section-number-3">6.7.</span> listen</h3>
<div class="outline-text-3" id="text-hH-c68f8ef8-94e9-46d6-8e67-634d04c16562">
<p>
Listen is used to wait for a message.
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-variable-name">responseMessage</span> <span class="org-operator">=</span> actorSys.listen([timeout])
</pre>
</div>

<p>
The received message is any message received by the local endpoint.
The local endpoint looks like a normal Actor with an ActorAddress
to the rest of the system.  <b>Any</b> Actor sending a message to this
address will cause the <code>listen()</code> operation to complete with that
message.
</p>

<p>
If the <code>timeout</code> field specifies a non-None timeout value then the
<code>listen()</code> will only block for the specified timeout period,
returning a None value if the timeout has occurred.  The
recommended manner of specifying a timeout period is as an instance
of the <code>datetime.timedelta</code> class, although an integer or floating
point value will be accepted as a specification of a number of
seconds.
</p>

<p>
Just as with the <code>ask()</code> timeout, the <code>listen</code> timeout is not
generally useful when using a <code>simpleSystemBase</code> actor base.  The
timeout will typically either be ignored while there is active work
to be done, or the call will return immediately if the actor system
is quiescent with no messages to be delivered.
</p>
</div>
</div>

<div id="outline-container-actorsystem.private" class="outline-3">
<h3 id="actorsystem.private"><span class="section-number-3">6.8.</span> private</h3>
<div class="outline-text-3" id="text-actorsystem.private">
<p>
The <code>tell()</code>, <code>ask()</code>, and <code>listen()</code> operations are used by external
applications to communicate with Actors, but they only provide a
single "address" for the external application.  If the external
application is multi-threaded, and different threads wish to
communicate with actors, some mechanism to route responses to the
proper thread is needed.
</p>

<p>
To accomplish this, the <code>ActorSystem.private()</code> method can be used to
obtain a "private" context for a particular thread.  While it exists,
this context creates a unique endpoint for the external application's
threads and ensures that response messages sent by actors are sent to
the proper initiating thread.
</p>

<p>
The <code>private()</code> context is easy to use along with the <code>with</code> statement:
</p>

<div class="org-src-container">
<pre class="src src-python">...
<span class="org-variable-name">asys</span> <span class="org-operator">=</span> ActorSystem()
...
[thread1:]
<span class="org-keyword">with</span> asys.private() <span class="org-keyword">as</span> mysys:
    <span class="org-variable-name">r</span> <span class="org-operator">=</span> mysys.ask(addr, message, timeout)
    <span class="org-keyword">if</span> r <span class="org-keyword">is</span> <span class="org-keyword">not</span> <span class="org-constant">None</span>:
        mysys.tell(addr2, <span class="org-string">'completed'</span>)
...
[thread2:]
<span class="org-keyword">with</span> asys.private() <span class="org-keyword">as</span> sys2:
    <span class="org-variable-name">resp</span> <span class="org-operator">=</span> sys2.ask(addr5, msg, timeout)
    <span class="org-builtin">print</span>(resp)
</pre>
</div>

<p>
In the above example, the response message sent by the actor at <code>addr</code>
will properly be directed to thread1, and the response message sent by
the actor at <code>addr5</code> will only be sent to thread2.
</p>
</div>
</div>

<div id="outline-container-hH-bf228654-b542-48f0-a5b5-78bc883528b9" class="outline-3">
<h3 id="hH-bf228654-b542-48f0-a5b5-78bc883528b9"><span class="section-number-3">6.9.</span> updateCapability</h3>
<div class="outline-text-3" id="text-hH-bf228654-b542-48f0-a5b5-78bc883528b9">
<p>
The <code>updateCapability()</code> method is used update the capabilities of
the ActorSystem.  This is the external interface to updating
capabilities; Actors can issue capability updates as well.
</p>

<div class="org-src-container">
<pre class="src src-python">actorSys.updateCapability(capabilityName, capabilityValue<span class="org-operator">=</span><span class="org-constant">None</span>)
</pre>
</div>

<p>
If the capability value is specified and is not None, the specified
capability already exists, its value updated, otherwise it is
created with the specified value.
</p>

<p>
If the capability value is not specified or is None, the specified
capability is removed from the ActorSystem if it exists.
</p>

<p>
If the capabilities of the ActorSystem are modified by this method
(i.e. the capability value is not already set as requested) then
all Actors within that ActorSystem are re-validated by calling
their <a href="#hH-0e9f4a6a-3083-40fa-a75b-ced37d70eef0">actorSystemCapabilityCheck</a> static method and sending them an
ActorExitRequest if the capability check call returns false.  <span class="underline">This
could result in killing the Actor that initiated the capability
exchange, even if new capabilities are added.</span> Actors may be
recreated as desired; the new Actors will validate against the new
set of capabilities.
</p>

<p>
The current set of ActorSystem capabilities can be obtained by
issuing a <a href="#hH-6428fa90-8749-4777-a0b1-752ec5eb1650">Thespian_StatusReq</a> to the ActorSystem.
</p>
</div>
</div>


<div id="outline-container-hH-73b564d2-faa3-4fc8-bfdf-5362626c03be" class="outline-3">
<h3 id="hH-73b564d2-faa3-4fc8-bfdf-5362626c03be"><span class="section-number-3">6.10.</span> loadActorSource</h3>
<div class="outline-text-3" id="text-hH-73b564d2-faa3-4fc8-bfdf-5362626c03be">
<div class="org-src-container">
<pre class="src src-python"><span class="org-variable-name">sourceHash</span> <span class="org-operator">=</span> actorSys.loadActorSource(fileref)
</pre>
</div>

<p>
The <code>loadActorSource()</code> method is used to load a (possibly
encrypted) zipfile containing Python source code in standard Python
zipimport format (via PEP302<sup><a id="fnr.1.100" class="footref" href="#fn.1" role="doc-backlink">1</a></sup> methodologies).  The return value
is an internally-generated hash value identifying that loaded source
zipfile that can be used in subsequent <a href="#hH-0e9f4a6a-3083-40fa-a75b-ced37d70eef0">createActor</a> calls to
instantiate Actors found in that sourcefile.
</p>

<p>
There must be a valid Source Authority registered (via the
<a href="#hH-5ae05479-5a6d-4f01-bd7d-c4f544f7b98a">registerSourceAuthority</a> method) to validate the loaded source; by
default this method does nothing if no Source Authority has been
loaded.  See <a href="#hH-b26e4f60-d3fa-40b1-bc33-bb20b61ff2d4">Security Considerations</a> for more information.
</p>

<p>
Although a plaintext zipfile may be loaded, it is highly recommended
that production environments encrypt the zipFile using some sort of
encryption methodology.  The reasons for this are discussed in the
<a href="#hH-b26e4f60-d3fa-40b1-bc33-bb20b61ff2d4">Security Considerations</a> section below; when an encrypted zipfile is
loaded it is first decrypted and/or authorized as described therein.
</p>

<p>
The <code>fileref</code> argument can be a string specifying an input file path
or it can be a file-like object.  If the <code>fileref</code> is invalid or
specifies a corrupted source file, then the returned sourceHash it
is not added to the list of available sources, but there is no other
feedback (excepting perhaps the <code>/tmp/Thespian.log</code> logfile).
</p>
</div>

<div id="outline-container-hH-e23490e4-d720-4e84-9b9a-e768fa3e717d" class="outline-4">
<h4 id="hH-e23490e4-d720-4e84-9b9a-e768fa3e717d"><span class="section-number-4">6.10.1.</span> Source Loading Issues</h4>
<div class="outline-text-4" id="text-hH-e23490e4-d720-4e84-9b9a-e768fa3e717d">
<p>
Although the <code>loadActorSource()</code> functionality works quite well,
there are a few scenarios that can cause difficulties:
</p>

<ol class="org-ol">
<li>Loaded sources containing or relying on object libraries.  The
<code>loadActorSource()</code> functionality affects the Python module
lookup, but it does not affect object file lookups that would
need to be performed for native object libraries.  In addition,
object libraries are specific to their build environment and may
not work in all target environments.  If the loaded source
simply <b>refers</b> to an externally available library
(e.g. PyOpenSSL python package refers to <code>/usr/lib/libssl.so</code>)
then this may work if the proper object library has been
installed on the target system by other means (i.e. not via the
<code>loadActorSource()</code> call.</li>

<li>Sources containing other PEP302 path importers may not work
correctly when used in conjuction with the <code>loadActorSource()</code>
PEP302 importer.  As an example, the <code>loadActorSource()</code>
importer prefixes loaded modules with the Source Hash associated
with those modules to ensure uniqueness.  This is not always
compatible with other PEP302 importers.

<ol class="org-ol">
<li><p>
The <code>six</code> package (providing Python2/Python3 compatibility)
uses a PEP302 importer to manage moved packages.  This
functionality of the <code>six</code> package is broken by the
<code>loadActorSource()</code> Source Hash prefixing. To avoid this
<code>loadActorSource()</code> processing handles <code>six</code> as a special
case and <i>does not</i> prefix <code>six</code> with any Source Hash.
</p>

<p>
The assumption is that <code>six</code> is a mature and unchanging
package and a global version is acceptable for all loaded
sources (and that a working <code>six</code> importer is preferrable to
a non-working importer).
</p></li>
</ol></li>

<li>The <code>importlib</code> package has a subtle flaw that is not compatible
with the Source Hash prefixing performed by <code>loadActorSource()</code>.
To work around this problem Thespian provides an updated version
of <code>importlib</code>; use " <code>import thespian.importlib as importlib</code> "
instead of just " <code>import importlib</code> " in Actor sources that
will be loaded via <code>loadActorSource()</code>.</li>

<li>Loaded sources should expect that <code>__file__</code> or other internals
can be set to None.</li>

<li>It is not possible to send a pickled message between sources,
even if that message is imported from the same file/module in
both loaded sources.  This is because each loaded source (and
all of its top level symbols) are internally prefixed with the
hash of the source they are contained in; this helps preserve
independence between loaded source modules and prevents
interference between them, but it means that the pickled object
will have a different source hash on the target side than on the
sender side.  The object should be encoded in a more
conventional format (e.g. JSON).</li>
</ol>
</div>
</div>

<div id="outline-container-hH-b26e4f60-d3fa-40b1-bc33-bb20b61ff2d4" class="outline-4">
<h4 id="hH-b26e4f60-d3fa-40b1-bc33-bb20b61ff2d4"><span class="section-number-4">6.10.2.</span> Security Considerations</h4>
<div class="outline-text-4" id="text-hH-b26e4f60-d3fa-40b1-bc33-bb20b61ff2d4">
<p>
When <code>loadActorSource()</code> is not used, the source for all
instantiated Actors must come from the existing Python import path
in the context of the Thespian ActorSystem.  In this configuration,
it is the System Administrator's responsibility to provide
reasonable security and protection against code injection attacks
(e.g. by using a virtualenv in a protected directory environment).
</p>

<p>
In order to prevent code injection attacks from being used with
<code>loadActorSource()</code> techniques, the ActorSystem must be able to
validate the following for each set of code loaded:
</p>

<ol class="org-ol">
<li>The source file has not been tampered with.</li>
<li>The source file is acceptable to run in this ActorSystem.</li>
</ol>

<p>
To achieve this protection, an Actor can register itself with the
system to handle authorization and/or description of
<code>loadActorSource()</code> inputs.  This Actor is referred to as the Source
Authority Actor.  Any input subsequently provided to
<code>loadActorSource()</code> is first passed to this Source Authority Actor.
The Source Authority Actor can perform any validation and/or
decryption of the input that it would like to and then sends back
either an error or the authorized source in a form that can be
utilized by the local ActorSystem.
</p>

<p>
There can be only one Source Authority Actor registered with an
ActorSystem at any one time.  Any Actor can register itself as the
new Source Authority; it is assumed that the previous authorization
of that Actor validated that it is allowed to run in the system and
therefore assume Source Authority responsibilities.  Note that in
highly paranoid environments, the initial Source Authority can be
used to authorize the next Source Authority, and this process can be
repeated as indicated by the level of paranoia to further obfuscate
the manner in which the Source Authority is established.
</p>

<p>
By default, at ActorSystem startup time, there is no Source
Authority.  When there is no Source Authority, any
<code>loadActorSource()</code> input is ignored.  This ensures that all
Thespian systems are secure by default.  For debugging and simple
local applications this may not be convenient; in these situations,
a Source Authority similar to the following may be used to
automatically accept and enable all loaded sources:
</p>

<pre class="example" id="org536339d">
from thespian.actors import *
class SimpleSourceAuthority(ActorTypeDispatcher):
    def receiveMsg_str(self, msg, sender):
        self.registerSourceAuthority()
    def receiveMsg_ValidateSource(self, msg, sender):
        self.send(sender, ValidatedSource(msg.sourceHash, msg.sourceData))
</pre>

<p>
Note that it is possible to disable the <code>loadActorSource()</code>
functionality entirely by registering an Actor as the Source
Authority that will reject all loaded sources.
</p>
</div>

<ol class="org-ol">
<li><a id="hH-059157fd-4272-4d2e-a1c8-aa0069e5b1f5"></a>Multi-System Source Authorization<br />
<div class="outline-text-5" id="text-hH-059157fd-4272-4d2e-a1c8-aa0069e5b1f5">
<p>
The Source Authority registration is unique to an ActorSystem.
Different ActorSystems in a <a href="#hH-461f4dc3-4bd6-46fe-a33e-2ad2a8d82d53">Multiple Systems</a> configuration can each
have a separate Source Authority that may perform different
authorization techniques.  However, as described in <a href="#hH-955ec990-a267-4d08-8f4d-5f980c777173">Actor Code
Distribution</a>, ActorSystems joined together in a Convention can
exchange sources on demand to satisfy Actor creation requests.
sources exchanged between ActorSystems in this manner are not
subject to further <b>validation</b> after the initial load on the
original system (although the local ActorSystem can choose the level
of sharing it wishes to perform; see the <b>AllowRemoteActorSources</b>
capability setting in the <a href="#hH-2a4bcad4-9fe0-4399-86d4-4bbf0ba0acb7">Common Capabilities</a> section).
</p>

<p>
This functionality allows for maximum flexibility in handling
different deployment environments:
</p>

<ul class="org-ul">
<li>In an environment where the Convention Leader ActorSystem is the
centralized command-and-control system and sources should only be
loaded on that system, the other ActorSystems can be initialized
with a Source Authority that rejects all <code>loadActorSource()</code>
attempts and therefore can run only sources provdied by the
Convention Leader.</li>

<li>In an environment where all ActorSystems are trusted equally and
new Actor source can be loaded via any system, they can all
utilize the same Source Authority as loaded into each Actor system
at the time it is started.</li>

<li>In a loose confederation of trusting ActorSystems, each
ActorSystem can load its own Source Authority to control sources
loaded via that system, while still sharing sources loaded on any
system.</li>
</ul>

<p>
It is important to note that in all configurations, different loaded
sources are essentially independent, regardless of the method by
which they are loaded and validated.  The only way for one source
load to access code in another source load is by issuing a
<code>createActor()</code> request using the known name of an Actor in the
other source load, or by being passed the ActorAddress of an already
running Actor in the other source load via independent means.
</p>

<p>
The <a href="director.html">Thespian Director</a> document describes the Director utility and
how it can help to use loadable Actor sources in a safe and
practical manner.
</p>
</div>
</li>
</ol>
</div>
</div>


<div id="outline-container-hH-3e2f292f-2797-46d7-9fc6-48c1619d4bec" class="outline-3">
<h3 id="hH-3e2f292f-2797-46d7-9fc6-48c1619d4bec"><span class="section-number-3">6.11.</span> unloadActorSource</h3>
<div class="outline-text-3" id="text-hH-3e2f292f-2797-46d7-9fc6-48c1619d4bec">
<div class="org-src-container">
<pre class="src src-python">actorSys.unloadActorSource(sourceHash)
</pre>
</div>

<p>
The <code>unloadActorSource()</code> method is used to unload a source zipfile
previously loaded by the <a href="#hH-731cff6e-674d-4341-bd92-80a08113d5df">loadActorSource</a> operation.
</p>

<p>
This will not affect (i.e. stop) any remaining Actors running
instances from that source, but it will prevent the creation of any
new Actors from that source<sup><a id="fnr.2" class="footref" href="#fn.2" role="doc-backlink">2</a></sup>.
</p>


<p>
This effect of this call on running Actors' ability to access the
unloaded source via imports or subseqeuent Actor creation is
indeterminate: in some system bases this would fail, whereas in
other bases this would succeed.
</p>

<p>
The <code>sourceHash</code> argument should specify the return value from a
previous <code>loadActorSource()</code> call; if there is no source loaded with
that sourceHash this request does nothing silently.
</p>
</div>
</div>
</div>

<div id="outline-container-hH-b889aca8-b50d-4920-8496-34b1420cf664" class="outline-2">
<h2 id="hH-b889aca8-b50d-4920-8496-34b1420cf664"><span class="section-number-2">7.</span> ActorSystem Messages</h2>
<div class="outline-text-2" id="text-hH-b889aca8-b50d-4920-8496-34b1420cf664">
<p>
The following Messages can be delivered to Actors by the ActorSystem
as a result of events within the ActorSystem itself.  All of these
messages inherit from the ActorSystemMessage.
</p>

<p>
In addition, the PoisonMessage, Thespian_SystemStatus, and
Thespian_ActorStatus messages may be delivered to external code (as
a response to an <code>ActorSystem().tell()</code> or <code>ActorSystem().ask()</code>
call).  All other ActorSystemMessage instances are filtered and not
returned to an <code>ask()</code> or <code>tell()</code> call.
</p>
</div>

<div id="outline-container-hH-407c4c79-2a05-442d-b6e8-5bf7c2f2d068" class="outline-3">
<h3 id="hH-407c4c79-2a05-442d-b6e8-5bf7c2f2d068"><span class="section-number-3">7.1.</span> PoisonMessage</h3>
<div class="outline-text-3" id="text-hH-407c4c79-2a05-442d-b6e8-5bf7c2f2d068">
<p>
The <code>PoisonMessage</code> object is delivered to an Actor or to external
code when message sent to an Actor has caused the target Actor to
fail.  The <code>PoisonMessage</code> is a wrapper around the original message
that caused the failure.  The originating sender receives this
poison message indication to allow it to perform any desired
cleanup or alternative work based on the target Actor failure (see <a href="#hH-62e20202-9bff-4455-968e-73fee0b9f66a">PoisonMessage Returns</a>).
</p>
</div>

<div id="outline-container-hH-7655532a-ec5a-49c0-9f4e-0b4207f21080" class="outline-4">
<h4 id="hH-7655532a-ec5a-49c0-9f4e-0b4207f21080"><span class="section-number-4">7.1.1.</span> Attributes</h4>
<div class="outline-text-4" id="text-hH-7655532a-ec5a-49c0-9f4e-0b4207f21080">
<ul class="org-ul">
<li><code>.poisonMessage</code> is the original message causing the target Actor
failures.</li>

<li><code>.details</code> may provide additional details (as a string) regarding
the failure that caused the poison message return (e.g. the
exception stack trace).</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-hH-32b3df34-552e-4398-83bb-b78f3f6483bc" class="outline-3">
<h3 id="hH-32b3df34-552e-4398-83bb-b78f3f6483bc"><span class="section-number-3">7.2.</span> WakeupMessage</h3>
<div class="outline-text-3" id="text-hH-32b3df34-552e-4398-83bb-b78f3f6483bc">
<p>
The <code>WakeupMessage</code> is delivered to the Actor by the ActorSystem as
a result of a previous call to the Actor's <code>.wakeupAfter()</code> method
call (see <a href="#hH-9cc1acd4-7f35-44ac-94fc-0326dc87a7a5">Timer Messages</a>).
</p>
</div>

<div id="outline-container-hH-865814f4-6d08-4657-bb89-c3be8b8a9453" class="outline-4">
<h4 id="hH-865814f4-6d08-4657-bb89-c3be8b8a9453"><span class="section-number-4">7.2.1.</span> Attributes</h4>
<div class="outline-text-4" id="text-hH-865814f4-6d08-4657-bb89-c3be8b8a9453">
<ul class="org-ul">
<li><code>.delayPeriod</code> which is the python <code>datetime.timedelta</code> value of
the delay period that has expired.</li>

<li><code>.payload</code> specifies the payload value (if any) that the Actor
specified on the original <code>.wakeupAfter()</code> call.</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-hH-8a46cfae-7ccc-407a-91c1-d4301b7a653c" class="outline-3">
<h3 id="hH-8a46cfae-7ccc-407a-91c1-d4301b7a653c"><span class="section-number-3">7.3.</span> WatchMessage</h3>
<div class="outline-text-3" id="text-hH-8a46cfae-7ccc-407a-91c1-d4301b7a653c">
<p>
The <code>WatchMessage</code> is delivered to the Actor by the ActorSystem when
one or more file descriptors has available data.  The WatchMessage
specifies which file numbers have data available.
</p>

<p>
This functionality is not available from all ActorSystem
implementations.  See <a href="#hH-94edef18-154e-4847-864f-027dff4f6e0a">Watching File Descriptors</a> for more
information.
</p>
</div>

<div id="outline-container-hH-a4719aee-2054-466c-a013-03b6938b084e" class="outline-4">
<h4 id="hH-a4719aee-2054-466c-a013-03b6938b084e"><span class="section-number-4">7.3.1.</span> Attributes</h4>
<div class="outline-text-4" id="text-hH-a4719aee-2054-466c-a013-03b6938b084e">
<ul class="org-ul">
<li><code>.ready</code> specifies a list of file numbers for which data is
available.  This will be a subset of the original set of file
numbers returned from the Actor's <code>receiveMessage()</code> method in the
<a href="#org795302e">5.2.1</a> return value.</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-hH-7e6106e4-a631-47a4-9d22-3fd63f7e1951" class="outline-3">
<h3 id="hH-7e6106e4-a631-47a4-9d22-3fd63f7e1951"><span class="section-number-3">7.4.</span> ActorExitRequest</h3>
<div class="outline-text-3" id="text-hH-7e6106e4-a631-47a4-9d22-3fd63f7e1951">
<p>
The <code>ActorExitRequest</code> object is sent to any Actor to request that
Actor to exit.  The Actor's <code>receiveMessage()</code> is invoked with the
<code>ActorExitRequest</code> object to allow the Actor to do any internal
cleanup; the cleanup must be completed because when the Actor's
<code>receiveMessage()</code> method exits from handling the
<code>ActorExitRequest</code> object, the Actor is killed with no further
functioning.
</p>

<p>
The <code>ActorExitRequest</code> may be originated by the ActorSystem itself
(e.g. a ActorSystem shutdown time) or it may be sent by any other
Actor within the system.
</p>
</div>

<div id="outline-container-hH-8155fe0d-ad17-4677-b606-f830c6f9f249" class="outline-4">
<h4 id="hH-8155fe0d-ad17-4677-b606-f830c6f9f249"><span class="section-number-4">7.4.1.</span> Attributes</h4>
<div class="outline-text-4" id="text-hH-8155fe0d-ad17-4677-b606-f830c6f9f249">
<ul class="org-ul">
<li><code>.isRecursive</code> indicates that this ActorExitRequest will
automatically be propagated to all children of the current Actor
following its processing by this Actor.</li>

<li><code>.notRecursive()</code> updates this ActorExitRequest to disable recursive
propagation to all child Actors.</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-hH-ed408390-5a74-4955-9f7d-a84e87595459" class="outline-3">
<h3 id="hH-ed408390-5a74-4955-9f7d-a84e87595459"><span class="section-number-3">7.5.</span> ChildActorExited</h3>
<div class="outline-text-3" id="text-hH-ed408390-5a74-4955-9f7d-a84e87595459">
<p>
The <code>ChildActorExited</code> object is delivered to the Parent Actor of
an Actor when that Actor has exited.  This is delivered regardless
of whether the exit was due to the receipt of an <a href="#hH-7e6106e4-a631-47a4-9d22-3fd63f7e1951">ActorExitRequest</a>
message or if the Actor was killed by other means.
</p>

<p>
The Parent of <a href="#hH-2d5ef9c7-2132-45f9-b6eb-6f2729f5b232">Named Actors</a> is the ActorSystem itself; no
other Actor will receive a <code>ChildActorExited</code> message when a
Named Actor exits.
</p>

<p>
Actors which were created by the external system via the
ActorSystem interface will have no Parent; their exit is
unremarked.
</p>
</div>

<div id="outline-container-hH-c32348b6-fed3-4ff1-bf95-3cf491049518" class="outline-4">
<h4 id="hH-c32348b6-fed3-4ff1-bf95-3cf491049518"><span class="section-number-4">7.5.1.</span> Attributes</h4>
<div class="outline-text-4" id="text-hH-c32348b6-fed3-4ff1-bf95-3cf491049518">
<ul class="org-ul">
<li><code>.childAddress</code> is the address of the child Actor that exited.
Note that this <code>.childAddress</code> may be different than the <code>sender</code>
argument passed to the current Actor's <code>.receiveMessage()</code> method.</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-hH-e3d4bfa0-7fad-4622-b707-8f67e4f75d5c" class="outline-3">
<h3 id="hH-e3d4bfa0-7fad-4622-b707-8f67e4f75d5c"><span class="section-number-3">7.6.</span> DeadEnvelope</h3>
<div class="outline-text-3" id="text-hH-e3d4bfa0-7fad-4622-b707-8f67e4f75d5c">
<p>
The <code>DeadEnvelope</code> object is delivered to the Dead Letter handler as
described in <a href="#hH-5af075c1-73b1-4f7c-8515-e55ed96c03a9">Dead Letter Handling</a>.  The <code>DeadEnvelope</code> is a wrapper
around the original message that could not be delivered to the
target Actor because the target is no longer running.
</p>
</div>

<div id="outline-container-hH-fc0fb45a-a981-42ce-9922-705dabbbda37" class="outline-4">
<h4 id="hH-fc0fb45a-a981-42ce-9922-705dabbbda37"><span class="section-number-4">7.6.1.</span> Attributes</h4>
<div class="outline-text-4" id="text-hH-fc0fb45a-a981-42ce-9922-705dabbbda37">
<ul class="org-ul">
<li><code>.deadMessage</code> &#x2013; the original, undeliverable message</li>
<li><code>.deadAddress</code> &#x2013; the address to which the message could not be delivered</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-hH-f311fc02-d355-4d68-b9af-958404637e57" class="outline-3">
<h3 id="hH-f311fc02-d355-4d68-b9af-958404637e57"><span class="section-number-3">7.7.</span> ActorSystemConventionUpdate</h3>
<div class="outline-text-3" id="text-hH-f311fc02-d355-4d68-b9af-958404637e57">
<p>
The <code>ActorSystemConventionUpdate</code> object is delivered to an Actor
that has registered to be notified on changes in ActorSystem
convention membership (as described in <a href="#hH-955ec990-a267-4d08-8f4d-5f980c777173">Other Actor Systems</a>).  This
message is generated by the ActorSystem itself.
</p>
</div>

<div id="outline-container-hH-a1cda86c-ca86-4aaa-bcb5-935e92435647" class="outline-4">
<h4 id="hH-a1cda86c-ca86-4aaa-bcb5-935e92435647"><span class="section-number-4">7.7.1.</span> Attributes</h4>
<div class="outline-text-4" id="text-hH-a1cda86c-ca86-4aaa-bcb5-935e92435647">
<ul class="org-ul">
<li><code>.remoteAdminAddress</code> &#x2013; Address of the Admin for the remote ActorSystem.</li>

<li><code>.remoteCapabilities</code> &#x2013; The current capabilities of the remote ActorSystem.</li>

<li><code>.remoteAdded</code> &#x2013; True if the ActorSystem is registering, False if
it is actively de-registering or has been automatically
de-registered for failing to checkin.</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-hH-3119580d-80a6-4061-a217-1b2b21014172" class="outline-3">
<h3 id="hH-3119580d-80a6-4061-a217-1b2b21014172"><span class="section-number-3">7.8.</span> ValidateSource</h3>
<div class="outline-text-3" id="text-hH-3119580d-80a6-4061-a217-1b2b21014172">
<p>
The <code>ValidateSource</code> object is delivered to the registered Source
Authority.  The contents are the source file provided via the
<a href="#hH-731cff6e-674d-4341-bd92-80a08113d5df">loadActorSource</a> call to the ActorSystem.  The Actor receiving this
message should decrypt and validate the source to ensure that the
source is authorized to run in the context of the current
ActorSystem.
</p>

<p>
If the specified source is not authorized to run in the current
ActorSystem, the Source Authority may either simply discard this
message and take no further action, or it may send a
<a href="#hH-1db8e94e-ca54-4817-b120-b4c51c680cdd">ValidatedSource</a> message specifying None as the validated source.
The latter is recommended since it allows immediate response
handling for pending actors for that source; otherwise a source
load timeout must expire before rejecting actor create requests for
the rejected source load attempt.
</p>

<p>
If the specified source is valid for running in the current
ActorSystem, the Source Authority should return a zipfile
containing the sources to the sender in a <a href="#hH-1db8e94e-ca54-4817-b120-b4c51c680cdd">ValidatedSource</a> message.
</p>

<p>
At the present time, only <code>.py</code> sources are utilized; any <code>.pyc</code> or
<code>.pyo</code> sources are ignored if present in the zipfile.
</p>

<p>
It is important to note that the sources provided to the
<code>loadActorSource()</code> call are not actually available for use in
<code>createActor()</code> calls until the Source Authority has responded with
the ValidatedSource message.  If it is expected that the Source
Authority will experience delays in validating the source, or that
the attempts to use the loaded source will immediately follow the
<code>loadActorSource()</code> call, the code calling the latter should
implement a delay or an explicit validation of the results of the
load via the <a href="#hH-6428fa90-8749-4777-a0b1-752ec5eb1650">Thespian_StatusReq</a> operation.
</p>
</div>

<div id="outline-container-hH-d6db3148-7664-4e50-9061-6733fe5d3a3f" class="outline-4">
<h4 id="hH-d6db3148-7664-4e50-9061-6733fe5d3a3f"><span class="section-number-4">7.8.1.</span> Attributes</h4>
<div class="outline-text-4" id="text-hH-d6db3148-7664-4e50-9061-6733fe5d3a3f">
<ul class="org-ul">
<li><code>.sourceHash</code> &#x2013; the hash associated with this loaded source.</li>
<li><code>.sourceData</code> &#x2013; the input data (file contents) provided to the
<a href="#hH-731cff6e-674d-4341-bd92-80a08113d5df">loadActorSource</a> call to the ActorSystem.</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-hH-1db8e94e-ca54-4817-b120-b4c51c680cdd" class="outline-3">
<h3 id="hH-1db8e94e-ca54-4817-b120-b4c51c680cdd"><span class="section-number-3">7.9.</span> ValidatedSource</h3>
<div class="outline-text-3" id="text-hH-1db8e94e-ca54-4817-b120-b4c51c680cdd">
<p>
This message is not sent by the ActorSystem to an Actor, but is
instead sent by the Source Authority Actor back to the system as
the response to a <a href="#hH-3119580d-80a6-4061-a217-1b2b21014172">ValidateSource</a> message.  The data associated with
this response is a zipfile in zipimport format providing the source
file tree of <code>.py</code> files that were extracted from the input data
sent via the <code>ValidateSource</code> message.  By sending this message
back to the sender, the Source Authority Actor is indicating that
the associated contents are valid for running within the current
ActorSystem environment (and any other ActorSystems that are part
of the Convention).
</p>

<p>
At this time, only <code>.py</code> files are used from the loaded source: any
<code>.pyc</code> or <code>.pyo</code> files are ignored.
</p>

<p>
This message may also be sent by the Source Authority with None as
the data to indicate that the associated Source Hash is invalid and
is being actively rejected.
</p>
</div>

<div id="outline-container-hH-92e91efa-fdc2-42bb-94f8-8a329618214c" class="outline-4">
<h4 id="hH-92e91efa-fdc2-42bb-94f8-8a329618214c"><span class="section-number-4">7.9.1.</span> Attributes</h4>
<div class="outline-text-4" id="text-hH-92e91efa-fdc2-42bb-94f8-8a329618214c">
<ul class="org-ul">
<li><code>.sourceHash</code> &#x2013; the hash associated with the loaded source as
provided in the <code>ValidateSource</code> input message.</li>
<li><code>.sourceZip</code> &#x2013; the zipimport-format decrypted and validated
compiled form of the originally provided source, or None to reject
the load attempt.</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-hH-7cc41555-6b60-4844-8cea-0ec3714cf8f8" class="outline-3">
<h3 id="hH-7cc41555-6b60-4844-8cea-0ec3714cf8f8"><span class="section-number-3">7.10.</span> LoadedSource</h3>
<div class="outline-text-3" id="text-hH-7cc41555-6b60-4844-8cea-0ec3714cf8f8">
<p>
The <code>LoadedSource</code> object is delivered to an Actor that has
registered to be notified on changes in the loaded sources
available in the local ActorSystem.  This message is generated by
the ActorSystem itself.
</p>

<p>
This message indicates that the associated source module has been
loaded successfully and is now available for creating new actors.
This message is delivered to each <a href="#hH-460d04d8-3961-43c4-a4c3-8282c2e4a892">notifyOnSourceAvailability</a>
registered notification target on the <span class="underline">local</span> system when the
source has been loaded on that system; remote loads will cause
corresponding notifications to registrants on those systems at such
time as the loaded source is provided to that remote system.
</p>

<p>
This message is also delivered for each loaded source that is
present at the time of the registration (via the
<code>notifyOnSourceAvailability</code> system call).
</p>
</div>

<div id="outline-container-hH-54e4613a-3c85-4d1e-a81d-0dd348af4199" class="outline-4">
<h4 id="hH-54e4613a-3c85-4d1e-a81d-0dd348af4199"><span class="section-number-4">7.10.1.</span> Attributes</h4>
<div class="outline-text-4" id="text-hH-54e4613a-3c85-4d1e-a81d-0dd348af4199">
<ul class="org-ul">
<li><code>.sourceHash</code> &#x2013; The hash value of the source that has been loaded
and successfully registered.</li>

<li><code>.sourceInfo</code> &#x2013; The text information field associated with the
loaded source.  This should be treated as informational; there is
no specific format or content dictated.</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-hH-72c2180e-97c4-4209-9f09-031069cb5cbe" class="outline-3">
<h3 id="hH-72c2180e-97c4-4209-9f09-031069cb5cbe"><span class="section-number-3">7.11.</span> UnloadedSource</h3>
<div class="outline-text-3" id="text-hH-72c2180e-97c4-4209-9f09-031069cb5cbe">
<p>
The <code>UnloadedSource</code> object is delivered to an Actor that has
registered to be notified on changes in the loaded sources
available in the local ActorSystem.  This message is generated by
the ActorSystem itself.
</p>

<p>
This message indicates that the associated source module has been
unloaded and is therefore unavailable for creating new actors.
</p>
</div>

<div id="outline-container-hH-3b58b48d-4d73-45c1-9486-3f6b8eb80d59" class="outline-4">
<h4 id="hH-3b58b48d-4d73-45c1-9486-3f6b8eb80d59"><span class="section-number-4">7.11.1.</span> Attributes</h4>
<div class="outline-text-4" id="text-hH-3b58b48d-4d73-45c1-9486-3f6b8eb80d59">
<ul class="org-ul">
<li><code>.sourceHash</code> &#x2013; The hash value of the source that has been unloaded
and de-registered.</li>

<li><code>.sourceInfo</code> &#x2013; The text information field associated with the
unloaded source.  This should be treated as informational; there is
no specific format or content dictated.</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-hH-6428fa90-8749-4777-a0b1-752ec5eb1650" class="outline-3">
<h3 id="hH-6428fa90-8749-4777-a0b1-752ec5eb1650"><span class="section-number-3">7.12.</span> Thespian_StatusReq</h3>
<div class="outline-text-3" id="text-hH-6428fa90-8749-4777-a0b1-752ec5eb1650">
<p>
The <code>Thespian_StatusReq</code> object can be sent to any Actor (or to the
ActorSystem&#x2026;e.g. the Admin if the ActorSystem has one) to request
Thespian-related status information.  The status information is
information from within Thespian itself; the Actor does not receive
or provide handling of this message itself.
</p>

<p>
The response to the <code>Thespian_StatusReq</code> is either a
<a href="#hH-704cb0e0-30c0-4e30-82cb-52718839704f">Thespian_SystemStatus</a> or a <a href="#hH-1a0b5d02-e4b6-4c8c-9687-6e5f939d3827">Thespian_ActorStatus</a>
message, depending on whether the <code>Thespian_StatusReq</code> was sent to
an Actor or the ActorSystem.
</p>
</div>

<div id="outline-container-hH-02212902-4a42-4f1e-ae6a-59464043ff50" class="outline-4">
<h4 id="hH-02212902-4a42-4f1e-ae6a-59464043ff50"><span class="section-number-4">7.12.1.</span> Attributes</h4>
<div class="outline-text-4" id="text-hH-02212902-4a42-4f1e-ae6a-59464043ff50">
<p>
The <code>Thespian_StatusReq</code> object has no attributes.
</p>
</div>
</div>
</div>

<div id="outline-container-hH-704cb0e0-30c0-4e30-82cb-52718839704f" class="outline-3">
<h3 id="hH-704cb0e0-30c0-4e30-82cb-52718839704f"><span class="section-number-3">7.13.</span> Thespian_SystemStatus</h3>
<div class="outline-text-3" id="text-hH-704cb0e0-30c0-4e30-82cb-52718839704f">
<p>
The <code>Thespian_SystemStatus</code> object is returned by the
ActorSystem with status information about that ActorSystem.  The
information in this message is informational only and subject to
change: relying on specific fields or values in this message is not
recommended.
</p>
</div>
</div>

<div id="outline-container-hH-1a0b5d02-e4b6-4c8c-9687-6e5f939d3827" class="outline-3">
<h3 id="hH-1a0b5d02-e4b6-4c8c-9687-6e5f939d3827"><span class="section-number-3">7.14.</span> Thespian_ActorStatus</h3>
<div class="outline-text-3" id="text-hH-1a0b5d02-e4b6-4c8c-9687-6e5f939d3827">
<p>
The <code>Thespian_ActorStatus</code> object is returned by the
ActorSystem with status information about that ActorSystem.  The
information in this message is informational only and subject to
change: relying on specific fields or values in this message is not
recommended.
</p>
</div>
</div>
</div>

<div id="outline-container-hH-d4e592db-8bab-45bd-9643-e952510bd7dc" class="outline-2">
<h2 id="hH-d4e592db-8bab-45bd-9643-e952510bd7dc"><span class="section-number-2">8.</span> Patterns and Helpers</h2>
<div class="outline-text-2" id="text-hH-d4e592db-8bab-45bd-9643-e952510bd7dc">
<p>
The elements described in this section is supplemental to the base
Thespian functionality.  It is entirely possible to use Thespian
without using any of the elements here, but these elements represent
common patterns or helpers that can be used when developing a Thespian
actor-based application.
</p>

<p>
The helpers describe here are all implemented via the Thespian API and
do not make use of the Thespian implementation internals.  If the
helpers here do not provide the specific functionality needed for a
particular use case, please feel free to consider them as examples for
creating your own helpers.
</p>
</div>

<div id="outline-container-hH-c796bc0d-a150-4fb9-8918-58f470813175" class="outline-3">
<h3 id="hH-c796bc0d-a150-4fb9-8918-58f470813175"><span class="section-number-3">8.1.</span> Actor Troupe Support</h3>
<div class="outline-text-3" id="text-hH-c796bc0d-a150-4fb9-8918-58f470813175">
<p>
The use of <a href="#hH-19cf92bf-a6ae-492c-844c-b0831c108a3a">Actor Troupes</a> is supported by importing the
<code>thespian.troupe</code> file and adding a <code>@troupe()</code> decorator to the Actor
definition.   This decorator turns a regular Actor into a dynamic
Actor Troupe, where multiple Actors are spun up on-demand to handle
messages.
</p>

<p>
This pattern is especially useful for situations where multiple
requests are received and processing individual requests may take some
time to perform.
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">from</span> thespian.troupe <span class="org-keyword">import</span> troupe

<span class="org-type">@troupe</span>()
<span class="org-keyword">class</span> <span class="org-type">MyActor</span>(Actor):
   ...

</pre>
</div>


<p>
The optional arguments to the troupe decorator are:
</p>

<ul class="org-ul">
<li><code>max_count</code> is the maximum number of actors in the troupe
(defaulting to 10).</li>

<li><code>idle_count</code> is the default number of actors in the troupe when
idle. As work is received, the number of actors will grow up to
the max_count, but when there is no more work, the number of
actors will shrink back down to this number.  Note that there may
be fewer than this number of actors present: actors are only
created if work is received and there are no idle actors to
handle that work.</li>
</ul>

<p>
The decorator usage above works very well for a simple worker actor
that can perform all of the necessary work utilizing only the message
sent to it; the actor can be turned into a troupe member with no
change other than adding the decorator.
</p>

<p>
The arguments to the troupe decorator are static and are applied at
the time the Actor source is loaded.  However, it is possible to
update the <code>max_count</code> and <code>idle_count</code> for the troupe dynamically at
any time using either text strings or the <code>UpdateTroupeSettings</code> object:
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-variable-name">r</span> <span class="org-operator">=</span> ActorSystem().ask(troupeActor, <span class="org-string">"troupe:set_max_count=9"</span>)
<span class="org-keyword">assert</span> r <span class="org-operator">==</span> <span class="org-string">"Set troupe max_count to 9"</span>

<span class="org-variable-name">r</span> <span class="org-operator">=</span> ActorSystem().ask(troupeActor, <span class="org-string">"troupe:set_idle_count=4"</span>)
<span class="org-keyword">assert</span> r <span class="org-operator">==</span> <span class="org-string">"Set troupe idle_count to 4"</span>

<span class="org-variable-name">r</span> <span class="org-operator">=</span> ActorSystem().ask(troupeActor, UpdateTroupeSettings(max_count<span class="org-operator">=</span>10, idle_count<span class="org-operator">=</span>4))
<span class="org-keyword">assert</span> <span class="org-builtin">isinstance</span>(r, UpdateTroupeSettings)
<span class="org-keyword">assert</span> r.max_count <span class="org-operator">==</span> 10
<span class="org-keyword">assert</span> r.idle_count <span class="org-operator">==</span> 4

</pre>
</div>

<p>
Note that the adjustments of the troupe max and idle counts do not
necessarily immediately reduce the number of running troupe workers if
the counts are adjusted lower; troupe workers are reduced after the
worker has successfully completed work.  Increasing either of these
counts should make more workers available immediately though.
</p>

<p>
An actor which must interact with other actors to process the work
requires additional modifications to allow the troupe manager to know
when the actor has finished performing the work.  A troupe member that
has not fully performed the work and is exchanging messages with other
actors to complete the work (or awaiting <a href="#hH-9cc1acd4-7f35-44ac-94fc-0326dc87a7a5">WakeupMessages</a>) must set the
<code>troupe_work_in_progress</code> attribute on self to <code>True</code>.  Once the work
is completed by a subsequent message delivery, it should set this
attribute to <code>False</code>, which will cause the troupe manager to be
notified that the actor is ready for more work.
</p>

<ul class="org-ul">
<li>Failure to set the <code>troupe_work_in_progress</code> attribute to <code>True</code>
on a multi-step actor will result in either (a) the actor
receiving more work before it has completed the previous work, or
(b) the actor will be killed by the troupe manager before
finishing the work because the manager believes the actor is
finished.</li>

<li>Failure to reset the <code>troup_work_in_progress</code> attribute to
<code>False</code> will cause the troupe manager to never send any more work
requests to the troupe actor, even if the latter is idle.  The
troupe actor will also never be killed until the troupe manager
itself is killed.</li>
</ul>

<p>
Manipulating the <code>troupe_work_in_progress</code> member variable for
non-troupe actors has no effect on their behavior and is safe to do.
</p>
</div>
</div>

<div id="outline-container-hH-99783a4a-183f-4b69-8910-014d01edbf1c" class="outline-3">
<h3 id="hH-99783a4a-183f-4b69-8910-014d01edbf1c"><span class="section-number-3">8.2.</span> Transient Actors</h3>
<div class="outline-text-3" id="text-hH-99783a4a-183f-4b69-8910-014d01edbf1c">
<p>
Some actors should automatically die at some period after they are
initially used, or after they are last used.  These actors are
referred to as "transient" in contrast to normal actors that will
persist until explicitly shutdown (either by themselves or by another
Actor).
</p>

<p>
Implementing transient actors is made easier by importing the
<code>thespian.transient</code> file and adding a <code>@transient()</code> or
<code>@transient_idle()</code> decorator to the Actor definition.
</p>

<p>
The <code>transient</code> decorator cause the actor to exit at some time period
after it receives its first message.
</p>

<p>
The <code>transient_idle</code> decorator causes the actor to exit at some time
period after it has received its last message.
</p>

<p>
Both decorators default to a period of 10 seconds, and both take an
optional <code>exit_delay</code> argument value that specifies an alternate time
period.  The time period should be a <code>datetime.timedelta</code> object.
</p>


<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">from</span> thespian.transient <span class="org-keyword">import</span> transient_idle

<span class="org-type">@transient_idle</span>(timedelta(seconds<span class="org-operator">=</span>3, milliseconds<span class="org-operator">=</span>250))
<span class="org-keyword">class</span> <span class="org-type">BoredActor</span>(Actor):
   ...

<span class="org-type">@transient</span>()
<span class="org-keyword">class</span> <span class="org-type">TempActor</span>(Actor):
   ...

</pre>
</div>

<p>
Note that a transient actor which is created but which never receives
any messages does not exit; the timer for transient exit is only
started after receipt of the actor's first message.
</p>
</div>
</div>

<div id="outline-container-h:5f80e194-ab38-406e-b077-984496b37073" class="outline-3">
<h3 id="h:5f80e194-ab38-406e-b077-984496b37073"><span class="section-number-3">8.3.</span> Initialization Messages</h3>
<div class="outline-text-3" id="text-h:5f80e194-ab38-406e-b077-984496b37073">
<p>
It is common for an Actor to require one or more messages to
"initialize" the Actor and prepare it for normal operations.
</p>

<p>
The <code>thespian.initmsgs</code> module provides an <code>initializing_messages</code>
decorator that can assist with managing this initialization.
</p>

<p>
This pattern is especially useful for Actors which need to receive
multiple different messages to initialize their state before normal
processing begins.  Each message is stored in a corresponding
attribute on the Actor class, and (unless <code>init_passthru</code> is True) no
messages are delivered to the receiveMessages entrypoint until all of
the initialization messages have been received.
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">from</span> thespian.initmsgs <span class="org-keyword">import</span> initializing_messages
<span class="org-type">@initializing_messages</span>(initset, initdone<span class="org-operator">=</span><span class="org-constant">None</span>, init_passthru<span class="org-operator">=</span><span class="org-constant">False</span>)
</pre>
</div>

<p>
The required argument to the <code>@initializing_messages</code> decorator is a
list of tuples, where the first tuple value is the name of an
attribute to be set on this actor and the second tuple value is the
type of the corresponding message.  If the tuple has three entries and
the third is True, then when the message type is matched, an attribute
corresponding to the first element plus the suffix "_sender" is set to
the sender of that message.
</p>

<p>
If multiple initialization messages of the same type are received, the
corresponding attribute will be set to the last messages received.
</p>

<p>
The <code>initdone</code> argument, if set, specifies a method name (as a string)
that should be called when all initialization message have been
received.
</p>

<p>
The <code>init_passthru</code> can be set to True to pass <b>all</b> messages received
during initialization to the normal Actor handling; the default is
false and init messages are discarded and non-init messages are saved
and delivered after initialization is completed.  (All
ActorSystemMessage messages are treated as if <code>init_passthru</code> was True).
</p>

<p>
Example:
</p>

<div class="org-src-container">
<pre class="src src-python">    <span class="org-type">@initializing_messages</span>([(<span class="org-string">'init_m1'</span>, Msg1, <span class="org-constant">True</span>),
                            (<span class="org-string">'init_tgt'</span>, ActorAddress),
                            (<span class="org-string">'frog'</span>, <span class="org-builtin">str</span>)],
                            initdone<span class="org-operator">=</span><span class="org-string">'init_completed'</span>)
    <span class="org-keyword">class</span> <span class="org-type">FooActor</span>(ActorTypeDispatcher):
        <span class="org-keyword">def</span> <span class="org-function-name">init_completed</span>(<span class="org-keyword">self</span>):
            <span class="org-keyword">self</span>.send(<span class="org-keyword">self</span>.init_m1_sender, <span class="org-string">'Running'</span>)
        <span class="org-keyword">def</span> <span class="org-function-name">receiveMsg_Croak</span>(<span class="org-keyword">self</span>, croakmsg, sender):
            <span class="org-keyword">self</span>.send(sender, <span class="org-keyword">self</span>.frog)
            <span class="org-keyword">self</span>.send(<span class="org-keyword">self</span>.init_m1_sender, <span class="org-keyword">self</span>.init_m1)
            <span class="org-keyword">self</span>.send(<span class="org-keyword">self</span>.init_tgt, croakmsg)
</pre>
</div>

<p>
This actor will wait for three different initialization messages
(Msg1, an ActorAddress, and a string) and store each as an attribute,
as well as storing the sender address for the Msg1 message.  When all
three have been received, the init_completed method is called, and
then all Croak messages cause three messages to be sent.  Note that
any Croak messages received before all three initialization messages
will be stored and delivered after initialization is complete.
</p>

<p>
This decorator is incompatible with the <code>@troupe</code> decorator.
</p>

<p>
This decorator must appear before the <code>@transient</code> or <code>@transient_idle</code>
decorator:
</p>

<div class="org-src-container">
<pre class="src src-python">    <span class="org-type">@initializing_messages</span>([(<span class="org-string">'init_m1'</span>, Msg1, <span class="org-constant">True</span>),
                            (<span class="org-string">'init_tgt'</span>, ActorAddress),
                            (<span class="org-string">'frog'</span>, <span class="org-builtin">str</span>)],
                            initdone<span class="org-operator">=</span><span class="org-string">'init_completed'</span>)
    <span class="org-type">@transient</span>(timedelta(seconds<span class="org-operator">=</span>2, milliseconds<span class="org-operator">=</span>250))
    <span class="org-keyword">class</span> <span class="org-type">FooActor</span>(ActorTypeDispatcher): ...
</pre>
</div>
</div>
</div>

<div id="outline-container-h:523e1df1-8cab-44dc-a46b-f7638dded176" class="outline-3">
<h3 id="h:523e1df1-8cab-44dc-a46b-f7638dded176"><span class="section-number-3">8.4.</span> Thespian Director</h3>
<div class="outline-text-3" id="text-h:523e1df1-8cab-44dc-a46b-f7638dded176">
<p>
The Thespian Director is a support utility that provides
functionality that makes it easier to use the Loadable Sources
functionality provided by Thespian.  It is possible to use loadable
sources without using the Director, but it's easier to use the
Director to provide a base set of support functionality.
</p>

<p>
See the <a href="director.html">Thespian Director</a> document for more information on the Director.
</p>
</div>
</div>


<div id="outline-container-h:108786e0-6ddd-46c3-974b-ffa353c4f1f1" class="outline-3">
<h3 id="h:108786e0-6ddd-46c3-974b-ffa353c4f1f1"><span class="section-number-3">8.5.</span> RunCommand support</h3>
<div class="outline-text-3" id="text-h:108786e0-6ddd-46c3-974b-ffa353c4f1f1">
<p>
The <code>thespian.runcommand</code> helper module can be used to execute
commands on the local system and collect results.  This effectively
encapsulates the Python <code>subprocess.Popen</code> functionality into an Actor
which isolates the Popen operation, using messages to request the
execution of a command and retrieve the results of the command.
</p>

<p>
See the docstrings in the <code>thespian/runcommand.py</code> file for more
details and the <code>test/test_runcommand.py</code> file for example usage.
</p>
</div>
</div>
</div>

<div id="outline-container-hH-2a5fa63d-e6eb-43b9-bea8-47223b27544e" class="outline-2">
<h2 id="hH-2a5fa63d-e6eb-43b9-bea8-47223b27544e"><span class="section-number-2">9.</span> ActorSystem Implementations</h2>
<div class="outline-text-2" id="text-hH-2a5fa63d-e6eb-43b9-bea8-47223b27544e">
<p>
One of the convenient aspects of an Actor architecture is that the
Actors themselves are insulated from and agnostic to any particular
transport type: the ActorSystem provides the message delivery and
underlying Actor support functionality.
</p>

<ul class="org-ul">
<li>The implementation of the ActorSystem can be changed or
redesigned without the Actors themselves needing to change.</li>

<li>Different implementations can be chosen for different circumstances
to meet the needs of that particular circumstance.</li>
</ul>

<p>
The Actors themselves interact with the ActorSystem via the normal
<code>.send()</code>, <code>.createActor()</code>, <code>.receiveMessage()</code> methods defined for
the Actor.
</p>

<p>
The external environment can interact with the Actors by making
requests via the ActorSystem object itself.  In addition, the
ActorSystem must be initially created to provide an environment for
all Actors that are subsequently run within that ActorSystem; this
creation is the responsibility of code in this external environment.
When external code calls the <code>ActorSystem()</code> constructor, an
ActorSystem is started if one is not already running.
</p>

<p>
An argument may be passed to the <a href="#hH-4adf735c-f237-4a8e-98db-ec52567353ac">ActorSystem</a> constructor to specify
the <code>systemBase</code> (a.k.a ActorSystem implementation) that should be used
for starting the ActorSystem if one is not already running; if an
ActorSystem is already running, this argument is ignored.  If no
argument is specified and no ActorSystem is running, the default
<a href="#hH-924dc0fe-c15b-491e-a6d1-8b88683d4c0d">simpleSystemBase</a> ActorSystem will be started.
</p>

<p>
The following table provides a summary of the different bases; more
details are available in each section:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Base</th>
<th scope="col" class="org-left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">simpleSystemBase</td>
<td class="org-left">No parallelism. Primarily useful for unit testing. Default base.</td>
</tr>

<tr>
<td class="org-left">multiprocQueueBase</td>
<td class="org-left">Multiple processses using Python Queue for communications.  Cannot support conventions.</td>
</tr>

<tr>
<td class="org-left">multiprocTCPBase</td>
<td class="org-left">Multiprocessing using TCP communications.  Use this base if your are unsure of which base to choose.</td>
</tr>

<tr>
<td class="org-left">multiprocUDPBase</td>
<td class="org-left">Multiprocessing using UDP communications.  Lighter-weight than TCP version, but can drop packets.</td>
</tr>
</tbody>
</table>
</div>



<div id="outline-container-hH-2a4bcad4-9fe0-4399-86d4-4bbf0ba0acb7" class="outline-3">
<h3 id="hH-2a4bcad4-9fe0-4399-86d4-4bbf0ba0acb7"><span class="section-number-3">9.1.</span> Common Capabilities</h3>
<div class="outline-text-3" id="text-hH-2a4bcad4-9fe0-4399-86d4-4bbf0ba0acb7">
<p>
As described in <a href="#hH-a17e6c70-5592-4d06-b818-bd25350c4c53">ActorSystem Capabilities</a> each ActorSystem has a set of
capabilities that describe that ActorSystem and which can be audited
by the Actor's <a href="#hH-0e9f4a6a-3083-40fa-a75b-ced37d70eef0">actorSystemCapabilityCheck</a> method to determine if the
Actor is compatible with the ActorSystem.  Many capabilities can be
set when the ActorSystem is started (see <a href="#hH-4adf735c-f237-4a8e-98db-ec52567353ac">ActorSystem</a>), or updated at
run-time (see <a href="#hH-1dc4362f-78dd-4adf-833c-d7bebda07ef8">updateCapability</a> for either the Actor or the ActorSystem
API); those marked <i>read-only</i> below may only be viewed, but not set
or changed when the ActorSystem is started.
</p>

<p>
Each ActorSystem may specify capabilities unique to that ActorSystem
and the application can add capabilities to that ActorSystem; in
addition, the following common capabilities are defined for all
ActorSystems:
</p>

<dl class="org-dl">
<dt><b>Python Version</b></dt><dd>tuple

<dl class="org-dl">
<dt>usage</dt><dd><i>read-only</i></dd>
<dt>description</dt><dd>This is set to the tuple value of the Python
version under which the ActorSystem is running
(this is the same value supplied by
<code>sys.version_info</code>).  Any Actors wishing to
enforce any version restrictions use this
capability to do so.</dd>
</dl></dd>

<dt><b>Thespian Generation</b></dt><dd>tuple

<dl class="org-dl">
<dt>usage</dt><dd><i>read-only</i></dd>
<dt>description</dt><dd><p>
This is the Thespian API functionality specifier
as a tuple of two values: <code>(generation,
                     enhancement)</code>. The first value is the
<code>generation</code> and indicates a major functionality
level (which is not necessarily
backwards-compatible with the previous
functionality level).  The second number is the
<code>enhancement</code> value and is incremented when
backwards-compatible functional enhancements have
been added within the current <code>generation</code>.  The
<code>generation</code> value is monotonically increasing,
whereas the <code>enhancement</code> value monotonically
increases within a <code>generation</code> but resets to
zero when the generation changes. The Thespian
Release Notes should be consulted to determine
what features are supported in what generations.
</p>

<p>
This value is also available to current code in
the <code>thespian.api</code> import as the
<code>ThespianGeneration</code> value; if this local value
is different than the ActorSystem provides in the
capabilities
</p></dd>
</dl></dd>

<dt><b>Thespian Version</b></dt><dd>number

<dl class="org-dl">
<dt>usage</dt><dd><i>read-only</i></dd>
<dt>description</dt><dd>This is the identifier for the version of
Thespian running in the current environment.
This is a single numeric value where later
releases will have a higher (but not necessarily
successor) value.</dd>
</dl></dd>

<dt><b>Thespian ActorSystem Name</b></dt><dd>string

<dl class="org-dl">
<dt>usage</dt><dd><i>read-only</i></dd>
<dt>description</dt><dd>This is the name of the running ActorSystem
implementation.  It is encouraged that Actors are
not written to be unique to any particular
implementation, but this information is present
to allow ActorSystem-specific capability
verification.</dd>
</dl></dd>

<dt><b>Thespian ActorSystem Version</b></dt><dd>number

<dl class="org-dl">
<dt>usage</dt><dd><i>read-only</i></dd>
<dt>description</dt><dd>This is the ActorSystem version as a single
numeric value (similar to the <code>Thespian Version</code>
capability.  This value may be incremented
separately from the <code>Thespian Version</code> to
indicate an update in the underlying ActorSystem
implementation.  The value of a specific
ActorSystem will increment, but different
ActorSystems have different version namespaces
and switching from one to another does not
guarantee that the ActorSystem version will
increment.</dd>
</dl></dd>

<dt><b>AllowRemoteActorSources</b></dt><dd>string

<dl class="org-dl">
<dt>usage</dt><dd><i>optional settable</i></dd>
<dt>values</dt><dd><code>Yes</code>, <code>No</code>, <code>LeaderOnly</code></dd>
<dt>default</dt><dd><code>Yes</code></dd>
<dt>description</dt><dd><p>
This capability specifies whether or not this
ActorSystem will accept sources loaded via remote
ActorSystems as described in the <a href="#hH-955ec990-a267-4d08-8f4d-5f980c777173">Actor Code
Distribution</a> section.  Valid values for this
capability are:
</p>

<dl class="org-dl">
<dt><b>Yes</b></dt><dd>Any Actor Source validated by a Source
Authority on a remote system can be
run on this system as well (this is
the default).</dd>

<dt><b>No</b></dt><dd>No Actor Sources from remote systems
will be accepted locally.</dd>

<dt><b>LeaderOnly</b></dt><dd>Only Actor Sources provided by
the Convention Leader will be
accepted locally.</dd>
</dl>

<p>
Any unrecognized value will be treated as <b>No</b>
and will disallow sources loaded on remote
systems to be used in the current ActorSystem.
If this capability is not specified, the default
is <b>Yes</b> which will accept sources loaded on any
of the remote ActorSystems that are part of the
Convention.
</p></dd>
</dl></dd>
</dl>
</div>
</div>

<div id="outline-container-hH-924dc0fe-c15b-491e-a6d1-8b88683d4c0d" class="outline-3">
<h3 id="hH-924dc0fe-c15b-491e-a6d1-8b88683d4c0d"><span class="section-number-3">9.2.</span> simpleSystemBase</h3>
<div class="outline-text-3" id="text-hH-924dc0fe-c15b-491e-a6d1-8b88683d4c0d">
<p>
The simpleSystemBase implementation is primarily designed for Unit
Testing and other very simplistic Actor environments:
</p>

<ul class="org-ul">
<li>All Actors run synchronously in the context of the current
process thread.</li>
<li>It is possible for an Actor to modify global state referenced by
other Actors (as a matter of principal, accessing global state
is an anti-pattern for the Actor Model).</li>
<li>It is possible for an Actor to modify the caller's version of
the message (see <a href="#hH-23ac66d7-ba55-40dc-ade8-a71e51c7a404">Message Mutability</a>).</li>
<li>The <a href="#hH-0e9f4a6a-3083-40fa-a75b-ced37d70eef0">actorSystemCapabilityCheck</a> is not called for any Actors: all
actors are created in the current ActorSystem regardless of
their capability requirements.</li>
<li>No support for <a href="#hH-461f4dc3-4bd6-46fe-a33e-2ad2a8d82d53">Multiple Systems</a> (e.g. Conventions)</li>
</ul>

<p>
Specifically, whenever an ActorSystem <code>.tell()</code> or <code>.ask()</code> is
called, the message is passed to the target Actor and any subsequent
actorCreate or message sends performed by that Actor are run in
sequence, etc. recursively.  When the <code>.tell()</code> or <code>.ask()</code>
completes back to the caller, most messages have been propagated
through the system and it has reached equilibrium.
</p>

<p>
There is one exception to the equilibrium state: pending <a href="#hH-b2b4b63a-c256-4793-8591-1ce8dbd87131">wakeupAfter</a>
wakeups.  These wakups may still be pending when the <code>.tell()</code> or
<code>.ask()</code> returns, and will not be delivered in the background
subsequent to that return.  If the wakeup time period expires during
a future call to <code>.tell()</code> or <code>.ask()</code> then the <code>WakeupMessage</code> will
be delivered at that point.  Wakeup periods that expire in the
interim are not acted upon until a future <code>.tell()</code> or <code>.ask()</code>, and
if no future calls of this type are made then those wakeups are
never delivered.
</p>

<p>
The simpleSystemBase is commonly used for unit testing
configurations; as such, specifying the <code>logDefs</code> constructor
argument as <code>False</code> helps prevent this system base from interfering
with any log capturing that is performed by the unit testing
framework (e.g. nosetest logcapture).
</p>

<p>
The simpleSystemBase uses the following <a href="#hH-a17e6c70-5592-4d06-b818-bd25350c4c53">ActorSystem Capabilities</a>:
</p>

<dl class="org-dl">
<dt><b>Thespian ActorSystem Name</b></dt><dd>string

<dl class="org-dl">
<dt>usage</dt><dd><i>read-only</i></dd>
<dt>value</dt><dd><code>simpleSystemBase</code></dd>
</dl></dd>
</dl>
</div>
</div>

<div id="outline-container-hH-59ea5ca7-a167-4d51-bd1b-78119eab6df6" class="outline-3">
<h3 id="hH-59ea5ca7-a167-4d51-bd1b-78119eab6df6"><span class="section-number-3">9.3.</span> multiprocQueueBase</h3>
<div class="outline-text-3" id="text-hH-59ea5ca7-a167-4d51-bd1b-78119eab6df6">
<p>
The multiprocQueueBase runs each Actor in its own separate process
for a truly asynchronous system.  The default Actor communication
method is by utilizing multiprocess Queue objects.  The Actors are
constrained to the current system, which is unique to the starting
process. There is no inter-system communications possible, nor sharing
of the ActorSystem with processes that are siblings of the starting
process (i.e. not started by the ActorSystem itself).
</p>

<p>
The multiprocQueueBase System Base is used between all processes
that were created from the original creation of the SystemBase, but a
new SystemBase is created by each initiating process and the Queues
are unique between the different SystemBase elements.  The lifetime of
the ActorSystem is limited to the lifetime of the process that
created it.
</p>

<p>
The multiprocQueueBase uses Python's multiprocess Queue objects, but
due to the fact that these Queues can only be passed by direct process
inheritance and not via pickling, this system base can be somewhat
inefficent due to the manner in which this implementation must route
messages through a chain of actor processes from source to
destination.
</p>

<p>
The multiprocQueueBase can only be used for communications on the
current system and not for inter-system communications.  The
multiprocQueueBase does not support the use of multiple ActorSystems
in a Convention as described in <a href="#hH-461f4dc3-4bd6-46fe-a33e-2ad2a8d82d53">Multiple Systems</a>.
</p>

<p>
The multiprocQueueBase uses the following <a href="#hH-a17e6c70-5592-4d06-b818-bd25350c4c53">ActorSystem Capabilities</a>:
</p>

<dl class="org-dl">
<dt><b>Thespian ActorSystem Name</b></dt><dd>string

<dl class="org-dl">
<dt>usage</dt><dd><i>read-only</i></dd>
<dt>value</dt><dd><code>multiprocQueueBase</code></dd>
</dl></dd>

<dt><b>Admin Address</b></dt><dd>string

<dl class="org-dl">
<dt>usage</dt><dd><i>read-only</i></dd>
<dt>value</dt><dd><code>ThespianQ</code></dd>
<dt>description</dt><dd>the address for the Admin queue. This is an
arbitrary string value.</dd>
</dl></dd>

<dt><b>Process Startup Method</b></dt><dd>string

<dl class="org-dl">
<dt>usage</dt><dd><i>optional settable</i></dd>
<dt>values</dt><dd><code>fork</code> or <code>spawn</code></dd>
<dt>default</dt><dd><code>fork</code> (Unix), or <code>spawn</code> (Windows)</dd>
<dt>description</dt><dd>specifies the multiprocessing process startup
method (see <code>multiprocessing.get_context()</code>).
Supported values are "fork" and "spawn".  The
"spawn" method is generally slower because it
creates each new process from scratch, but it
provides better independence and isolation.  The
"fork" method is faster but can inherit memory
and other resources from the parent, and it is
only available under Unix.  Note that the other
multi-process bases support the multiprocessing
"forkserver" method, but this multiprocQueueBase
does not support the "forkserver" method.</dd>
</dl></dd>
</dl>
</div>

<div id="outline-container-h:815365aa-17f0-46a0-a6c9-def03eb7c5e3" class="outline-4">
<h4 id="h:815365aa-17f0-46a0-a6c9-def03eb7c5e3"><span class="section-number-4">9.3.1.</span> Potential issues</h4>
<div class="outline-text-4" id="text-h:815365aa-17f0-46a0-a6c9-def03eb7c5e3">
<ul class="org-ul">
<li>The multiprocessQueueBase is not efficient for non-adjacent actor messaging</li>
<li>There is a unexplained, core-level concern about dropped
messages/deadlocks for the queue messaging in overload conditions.</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-hH-9d33a877-b4f0-4012-9510-442d81b0837c" class="outline-3">
<h3 id="hH-9d33a877-b4f0-4012-9510-442d81b0837c"><span class="section-number-3">9.4.</span> multiprocTCPBase</h3>
<div class="outline-text-3" id="text-hH-9d33a877-b4f0-4012-9510-442d81b0837c">
<p>
The multiprocTCPBase runs each Actor in its own separate process
for a truly asynchronous system.  The default Actor communication
method is by utilizing TCP socket connections.
</p>

<p>
The multiprocTCP SystemBase is shared between all processes that
utilize the same Administrator coordinates, and can be used for
inter-system communications.  The lifetime of the ActorSystem exceeds
that of the process that started it and persists until an explicit
shutdown.
</p>

<p>
The multiprocTCPBase can be used for Actors on the same system or on
other systems accessible via TCP/IPv4.
</p>

<p>
The multiprocTCPBase supports forwarding of logging messages (warning
and above) to the Convention Leader if used in a multi-system
configuration.
</p>

<p>
The multiprocTCPBase uses the following <a href="#hH-a17e6c70-5592-4d06-b818-bd25350c4c53">ActorSystem Capabilities</a>:
</p>

<dl class="org-dl">
<dt><b>Thespian ActorSystem Name</b></dt><dd>string

<dl class="org-dl">
<dt>usage</dt><dd><i>read-only</i></dd>
<dt>value</dt><dd><code>multiprocTCPBase</code></dd>
</dl></dd>

<dt><b>Admin Port</b></dt><dd>number

<dl class="org-dl">
<dt>usage</dt><dd><i>optional settable</i></dd>
<dt>default</dt><dd><code>1900</code></dd>
<dt>description</dt><dd><p>
specifies the TCP port number upon which the
ActorSystem will listen for new communications.
Actors and the external systems do not need to
access that port specifically: it specifies which
port the ActorSystem uses internally for
coordination of operations.
</p>

<p>
If a multiprocTCPBase ActorSystem is already
listening at that port, then the existing system
will be utilized; otherwise a new
multiprocTCPBase ActorSystem will be started up.
</p></dd>
</dl></dd>
</dl>


<dl class="org-dl">
<dt><b>Convention Address.IPv4</b></dt><dd>tuple or string or array of tuples/strings

<dl class="org-dl">
<dt>usage</dt><dd><i>optional settable</i></dd>
<dt>examples</dt><dd><code>('123.45.6.78', 1923)</code>, <code>123.45.6.78:1923</code>, <code>host-a:1923</code>, or <code>123.45.6.78</code></dd>
<dt>description</dt><dd><p>
the IPv4 address of the convention leader's
Admin.  This should be specified either as a
tuple of <i>(hostname, portnum)</i> or as a string of
the form "hostname:portnum".  The hostname may be
a DNS name or a dotted quad IPv4 address
(specified as a string) and references the host
on which the Convention Leader Admin is to be
found.  The portnum is the <b>Admin Port</b> upon
which that Admin listens; if not specified (no
colon is found) then the port num defaults to the
<b>Admin Port</b> setting.
</p>

<p>
If not specified, then this ActorSystem operates
in isolation and cannot interact with other Actor
Systems.
</p>

<ul class="org-ul">
<li>This can be specified as a list of convention leader
addresses.  In this mode, if a leader is shutdown, the
remaining convention will shift to using one of the other
leaders in the list (providing a measure of
fault-tolerance/high-availability for the convention).</li>
</ul></dd>
</dl></dd>

<dt><b>Admin Routing</b></dt><dd>boolean

<dl class="org-dl">
<dt>usage</dt><dd><i>optional settable</i></dd>
<dt>default</dt><dd><code>False</code></dd>
<dt>description</dt><dd><p>
if this capability is present and has a true
value, this indicates that all Actors in remote
ActorSystems must send all messages to local
Actors through the Admin.  This is commonly used
where the ActorSystem is running on a host node
that has a firewall that only allows the Admin
Port to have network ingress permissions.
</p>

<p>
Note that this capability has no affect on the
way in which the Actors themselves are
implemented; it only changes the way that the
ActorSystem routes messages.
</p></dd>
</dl></dd>

<dt><b>Outbound Only</b></dt><dd>boolean

<dl class="org-dl">
<dt>usage</dt><dd><i>optional settable</i></dd>
<dt>default</dt><dd><code>False</code></dd>
<dt>description</dt><dd><p>
if this capability is present and has a true
value then it means that this ActorSystem (and
all of the Actors within it) can only initiate
outbound connections. Inbound connections are not
supported.
</p>

<p>
This configuration may be needed for a system
that is behind a firewall with very strict
ingress rules but looser egress rules.
</p>

<p>
Specifying this capability as True will
implicitly force "Admin Routing" to be true as
well, regardless of the user setting. This is
because it is impractical for this system to
maintain outbound connections to all possible
remote Actors, so it will maintain a persistent
connection to other Admins only and forward
packets via them using the "Admin Routing"
functionality.
</p>

<p>
In addition, this system will not be able to join
in conventions with other systems unless the
other systems are declared via the
<code>preRegisterRemoteSystem()</code> call, since they
cannot initiate an inbound registration to this
system.
</p>

<p>
Remote systems may encounter periodic delays in
message forwarding messages to an Outbound Only
system because they must await a connection
establishment from that system (which may not
occur until the next Convention Registration time
period has elapsed).  (This mode also requires
socket re-use by the TCP transport, which is the
normal operational mode).
</p></dd>
</dl></dd>

<dt><b>Thespian Watch Supported</b></dt><dd>boolean

<dl class="org-dl">
<dt>usage</dt><dd><i>read-only</i></dd>
<dt>description</dt><dd>If True, then an Actor may return the
<code>ThespianWatch</code> object from its
<code>receiveMessage()</code> method and be called back
later when input is available on any of the
numbered file descriptors passed in the
<code>ThespianWatch</code> object.</dd>
</dl></dd>

<dt><b>Process Startup Method</b></dt><dd>string

<dl class="org-dl">
<dt>usage</dt><dd><i>optional</i></dd>
<dt>values</dt><dd><code>fork</code>, <code>spawn</code>, or <code>forkserver</code></dd>
<dt>default</dt><dd><code>fork</code> (Unix), or <code>spawn</code> (Windows)</dd>
<dt>description</dt><dd>specifies the multiprocessing process startup
method (see <code>multiprocessing.get_context()</code>).
Supported values are "fork", "forkserver", and
"spawn".  The "spawn" method is generally slower
because it creates each new process from scratch,
but it provides better independence and
isolation.  The "fork" method is faster but can
inherit memory and other resources from the
parent, and it is only available under Unix.  The
"forkserver" performance is between the other
two, but closer to the performance of the "spawn"
method.</dd>
</dl></dd>
</dl>

<p>
At startup, the multiprocTCPBase will attempt to determine the local
IP address to use for registering Actor Addresses:
</p>
<ul class="org-ul">
<li>If a Convention Leader is specified, then it will be the address
on which it can communicate with that Convention Leader.</li>
<li>If no Convention Leader is specified, it attempts to identify a
public address (i.e. one that can communicate with IP address
8.8.8.8).</li>
</ul>
<p>
In a situation where neither of the above is appropriate or yields a
useable address, the THESPIAN_BASE_IPADDR environment variable can
be set to the IP address to use before starting Thespian; setting
this environment variable overrides any address probing above, and
setting it to a network address that is not accessible from the
local machine will result in the inability to run any Actors.
</p>
</div>

<div id="outline-container-h:ca576db1-3923-4db4-aaad-e6c41730f552" class="outline-4">
<h4 id="h:ca576db1-3923-4db4-aaad-e6c41730f552"><span class="section-number-4">9.4.1.</span> Configuration Environment Variables</h4>
<div class="outline-text-4" id="text-h:ca576db1-3923-4db4-aaad-e6c41730f552">
<p>
The multiprocTCPBase ActorSystem has various configuration parameters that
control the runtime behavior.  These parameters are defaulted to values which
are intended to support most standard uses of Thespian, but these values can be
adjusted for specific use cases using environment variables.  These environment
variables must be set <b>before</b> the ActorSystem is started for them to affect
the ActorSystem and any Actors started within that ActorSystem.
</p>

<dl class="org-dl">
<dt><code>THESPIAN_BASE_IPADDR</code></dt><dd><p>
specifies the local IP address to use for Actors on
this system.  This should be an IP address that is reachable by any other
ActorSystems that are part of a convention; if no convention is needed,
localhost or 0.0.0.0 is probably sufficient, but otherwise this needs to be
an address that is reachable from those remote systems.  Thespian will
automatically probe on startup and attempt to determine the address to use,
but in situations where this automated probing is insufficient or incorrect,
this environment variable can be used to override the address.
</p>

<pre class="example" id="orgd9ac96c">
    $ export THESPIAN_BASE_IPADDR="1.2.3.4"
</pre>

<dl class="org-dl">
<dt>default</dt><dd>locally probed address</dd>
</dl></dd>

<dt><code>THESPIAN_MAX_PENDING_TRANSMITS</code></dt><dd><p>
Specifies the number of transmit messages
that can actively be sent from an Actor.  The messages are not required to be
directed to the same target.  This threshold should be set to a level that
prevents overflowing the system's <code>socket.send()</code> limitations.
</p>

<pre class="example" id="org6126014">
    $ export THESPIAN_MAX_PENDING_TRANSMITS=10
</pre>

<dl class="org-dl">
<dt>default</dt><dd>20</dd>
</dl></dd>

<dt><code>THESPIAN_MAX_QUEUED_TRANSMITS</code></dt><dd><p>
Actors can transmit messages faster than
they can be processed by recipients.  Thespian maintains a limit of the
number of pending/in-progress transmits that can be created by a single
Actor.  Normally, the <code>.send()</code> method is asynchronous, queueing the message
for transmit and returning immediately to the Actor's code, but when this
theshold is reached, a <code>.send()</code> will block (implementing "backoff" or "back
pressure"). This environment variable overrides the default threshold value.
</p>

<p>
If this value is changed, the <code>THESPIAN_QUEUED_TRANSMIT_UNBLOCK_THRESHOLD</code>
value may need to be explicitly set as well.
</p>

<pre class="example" id="org3690fbd">
    $ export THESPIAN_MAX_QUEUED_TRANSMITS=500
</pre>

<dl class="org-dl">
<dt>default</dt><dd>950</dd>
</dl></dd>

<dt><code>THESPIAN_QUEUED_TRANSMIT_UNBLOCK_THRESHOLD</code></dt><dd><p>
When an Actor's <code>.send()</code>
method is blocked due to reaching the THESPIAN_MAX_QUEUED_TRANSMITS threshold
(either the explicit or default threshold), the <code>.send()</code> will not unblock
until the number of queued transmit messages falls below a lower threshold
value.  By having the resumption threshold set lower than the blocking
threshold, a hysteresis buffer is provided that allows an Actor to run more
smoothly overall instead of introducing jitter as it repeatedly moves above
and below a single threshold value.  This value can be explicitly set with
the <code>THESPIAN_QUEUED_TRANSMIT_UNBLOCK_THRESHOLD</code> environment variable.
</p>

<p>
This value <b>should always be less</b> than the <code>THESPIAN_MAX_QUEUED_TRANSMITS</code>
value.
</p>

<pre class="example" id="org612123a">
    $ export THESPIAN_QUEUED_TRANSMIT_UNBLOCK_THRESHOLD=100
</pre>

<dl class="org-dl">
<dt>default</dt><dd>780</dd>
</dl></dd>

<dt><code>THESPIAN_DROP_TRANSMITS_LEVEL</code></dt><dd><p>
It is possible to configure the Actor to
drop transmit requests if there are too many queued.  Message queueing can
occur via the Actor's intentional <code>.send()</code> call, or implicitly via Actor
management requests exchanged between Actors or the Actor and the
ActorSystem.  The drop threshold will affect both types of messages, and is a
protection against overloading the Actor's system memory.
</p>

<p>
If this value is set lower than the <code>THESPIAN_MAX_QUEUED_TRANSMITS</code> level
then the <code>.send()</code> method will never block (exerting back-pressure) but
instead drop messages.  Normally this value will be set higher than the
<code>THESPIAN_MAX_QUEUED_TRANSMITS</code>.
</p>

<pre class="example" id="org856e9f3">
    $ export THESPIAN_DROP_TRANSMITS_LEVEL=600
</pre>

<dl class="org-dl">
<dt>default</dt><dd>100 plus the maximum queued transmits threshold (which can be
set via <code>THESPIAN_MAX_QUEUED_TRANSMITS</code>).</dd>
</dl></dd>
</dl>

<p>
In addition to the above, the logging environment variables described in
<a href="#hH-856a7ffe-676b-42a9-95eb-bd89a5810f53">Thespian Internals Logging</a> may be set.
</p>
</div>
</div>
</div>

<div id="outline-container-hH-25cfa213-13a6-4265-8828-86ffffed0e12" class="outline-3">
<h3 id="hH-25cfa213-13a6-4265-8828-86ffffed0e12"><span class="section-number-3">9.5.</span> multiprocUDPBase</h3>
<div class="outline-text-3" id="text-hH-25cfa213-13a6-4265-8828-86ffffed0e12">
<p>
The multiprocUDPBase runs each Actor in its own separate process
for a truly asynchronous system.  The default Actor communication
method is by utilizing UDP messages.
</p>

<p>
The multiprocUDP SystemBase is shared between all processes that
utilize the same Administrator coordinates, and can be used for
inter-system communications.  The lifetime of the ActorSystem
exceeds that of the process that started it and persists until an
explicit shutdown.
</p>

<p>
As with most UDP-based exchanges, there is no guarantee that messages
have been delivered.  One effect of this is that it is often difficult
for the ActorSystem to recognize that Actors have exited and so Dead
Letter delivery is unreliable at best for this system base.
</p>

<p>
Additionally, the UDP-based ActorSystem can only exchange messages up
to 64KiB in size.  Larger messages will fail.
</p>

<p>
The multiprocUDPBase can be used for Actors on the same system or on
other systems accessible via UDP/IP.
</p>

<p>
The multiprocUDPBase supports forwarding of logging messages (warning
and above) to the Convention Leader if used in a multi-system
configuration.
</p>

<p>
The multiprocUDPBase uses the following <a href="#hH-a17e6c70-5592-4d06-b818-bd25350c4c53">ActorSystem Capabilities</a>:
</p>

<dl class="org-dl">
<dt><b>Thespian ActorSystem Name</b></dt><dd>string

<dl class="org-dl">
<dt>usage</dt><dd><i>read-only</i></dd>
<dt>value</dt><dd><code>~multiprocUDPBase</code></dd>
</dl></dd>

<dt><b>Admin Port</b></dt><dd>number

<dl class="org-dl">
<dt>usage</dt><dd><i>optional settable</i></dd>
<dt>default</dt><dd><code>1029</code></dd>
<dt>description</dt><dd><p>
specifies the UDP port number upon which the
ActorSystem will listen for new communications.
Actors and the external systems do not need to
access that port specifically: it specifies which
port the ActorSystem uses internally for
coordination of operations.
</p>

<p>
If a multiprocUDPBase ActorSystem is already
listening at that port, then the existing system
will be utilized; otherwise a new
multiprocUDPBase ActorSystem will be started up.
</p></dd>
</dl></dd>

<dt><b>Convention Address.IPv4</b></dt><dd>tuple or string or list of tuples/strings

<dl class="org-dl">
<dt>usage</dt><dd><i>optional settable</i></dd>
<dt>description</dt><dd>the IPv4 address of the convention leader's
Admin.  See the description of the same
capability in the <a href="#hH-9d33a877-b4f0-4012-9510-442d81b0837c">multiprocTCPBase</a> for more
details.</dd>
</dl></dd>
</dl>


<dl class="org-dl">
<dt><b>Process Startup Method</b></dt><dd>string

<dl class="org-dl">
<dt>usage</dt><dd><i>optional</i></dd>
<dt>values</dt><dd><code>fork</code>, <code>spawn</code>, or <code>forkserver</code></dd>
<dt>default</dt><dd><code>fork</code> (Unix), or <code>spawn</code> (Windows)</dd>
<dt>description</dt><dd>specifies the multiprocessing process startup
method (see <code>multiprocessing.get_context()</code>).
Supported values are "fork", "forkserver", and
"spawn".  The "spawn" method is generally slower
because it creates each new process from scratch,
but it provides better independence and
isolation.  The "fork" method is faster but can
inherit memory and other resources from the
parent, and it is only available under Unix.  The
"forkserver" performance is between the other
two, but closer to the performance of the "spawn"
method.</dd>
</dl></dd>
</dl>


<p>
The multiprocUDPBase system base selects a local IP address to use
for Actor Addresses in the same manner as described for the
multiprocTCPBase above.
</p>
</div>
</div>
</div>

<div id="outline-container-h:f3cb3837-435b-4551-91bc-1913af405a67" class="outline-2">
<h2 id="h:f3cb3837-435b-4551-91bc-1913af405a67"><span class="section-number-2">10.</span> Potential Concerns and FAQ</h2>
<div class="outline-text-2" id="text-h:f3cb3837-435b-4551-91bc-1913af405a67">
<p>
Some items of potential concern when working with Thespian and actor
systems in general:
</p>

<dl class="org-dl">
<dt>Dropped messages</dt><dd>While Thespian does its best to ensure that
messages are delivered, this is fundamentally a distributed model
relying on varying levels of network connectivity.  Thespian will
retransmit where it is possible to detect a delivery error (this is
generally not possible with the UDP-based transports but is
provided by the TCP-based transports).  An actor-based application
wanting to address this concern may want to add identification
information to messages that allow a receipient to detect the
absence of expected messages and explicitly re-request them from
the originating actor.</dd>

<dt>Message size limitations</dt><dd>Thespian itself does not impose message
size limitations.  Some transports may have limitations (e.g. UDP)
that will be encountered.  Extremely large messages may overflow
buffers in the network equipment or in the network stack of the
local or remote system.  Thespian has been successfully used to
exchange messages that are tens or hundreds of kilobytes, but it's
recommended that extremely huge messages are split into smaller
messages or handled via some other mechanism.</dd>

<dt>(no term)</dt><dd>Use of Thespian in conjunction with some other scheduling system
(e.g. rabbit-mq, etc.).  Because the scheduling of an actor's receiveMessage
handler is one of the primary goals of the Thespian actor system (or any actor
system), this is usually incompatible with any <b>other</b> scheduling system
expecting to determine when portions of the code are run, which frequently
includes other message passing frameworks that include schedule handling.
Thespian expects to have the CPU context available for servicing
sockets/queues/etc. and to determine when the Actor is called with a message;
conversely the Actor may choose to block for as long as it desires within its
own receiveMessage handler.  There is no commonly viable mechanism for
Thespian to share this management of the CPU context with Other libraries and
frameworks that also expecting to manage that context.</dd>
</dl>
</div>
</div>

<div id="outline-container-hH-23bdc6e2-a5c4-4228-a75c-fb213f537732" class="outline-2">
<h2 id="hH-23bdc6e2-a5c4-4228-a75c-fb213f537732"><span class="section-number-2">11.</span> Deploying Actor-based Projects</h2>
<div class="outline-text-2" id="text-hH-23bdc6e2-a5c4-4228-a75c-fb213f537732">
<p>
Possible Methods for deployment:
</p>
<ul class="org-ul">
<li>Create a virtualenv via os-specific packaging (e.g. RPM) of all
dependencies including Thespian.  This is a single, self-contained
installation containing all needed elements and can be started and
stopped distinctly.</li>

<li>Distribute Thespian and a Source Authority via os-specific
packaging to make the ActorSystem available.  This establishes the
base service and other elements can be deployed via the
loadActorSource() operation.</li>
</ul>

<p>
The former method is a simpler method, but it means that the
ActorSystem cannot be shared amongst separate applications, and that
any deployment will completely shutdown the previous ActorSystem and
Actors before starting the new one.
</p>

<p>
Using the latter method is slightly more complicated from a
packaging complexity perspective, but it allows the ActorSystem to
be shared by multiple Actor-based applications, as well as providing
for seamless upgrades of each application (because the new and old
sources can be running simultaneously).  The <a href="director.html">Thespian Director</a>
document describes the Director utility that can optionally be used
to enhance and support this latter method.
</p>
</div>


<div id="outline-container-hH-7e109f00-76ff-49a1-b307-2166154c3921" class="outline-3">
<h3 id="hH-7e109f00-76ff-49a1-b307-2166154c3921"><span class="section-number-3">11.1.</span> Overall Security Considerations</h3>
<div class="outline-text-3" id="text-hH-7e109f00-76ff-49a1-b307-2166154c3921">
<dl class="org-dl">
<dt><b>ActorSystem Startup</b></dt><dd>ActorSystem startup will inherit the
permissions of the starting user.  In many cases this is root
to afford the actors the needed abilities to perform their
operations.</dd>

<dt><b>ActorSystem Restart</b></dt><dd>This is the process of stopping an
ActorSystem and restarting a new one.  There are no
restrictions placed on stopping an ActorSystem because this
could result in unwarranted difficulties, and the ActorSystem
can already be stopped in other ways (eg. process kill, etc.).
Although it is possible for an attacker to stop the running
ActorSystem and restart it, the resulting ActorSystem will only
be running with the permissions it inherits from that starting
user, and the protections detailed below still apply.  This is
not an effective attack vector for the ActorSystem.</dd>

<dt><b>Actor Injection</b></dt><dd>the use of the Source Authority (see
<a href="#hH-5ae05479-5a6d-4f01-bd7d-c4f544f7b98a">registerSourceAuthority</a>) and associated sourceHash values
prevent the ability to inject bad actors into the ActorSystem.</dd>

<dt><b>Message Injection</b></dt><dd>Each Actor is responsible for any
validation or verification of the messages it receives.</dd>

<dt><b>Message Interception</b></dt><dd>To protect messages from snooping, a VPN
should be used or the configuration should select an
ActorSystem base should be used that provides ssl-secured
communications</dd>

<dt><b>Convention Source Injection</b></dt><dd><p>
In this scenario, another member
of the ActorSystem Convention that has been compromised
attempts to inject bad Actor sources into the system.  This is
prevented by using the <b>AllowRemoteActorSources</b> capability to
prevent injection of sources from ActorSystem hosts that are
subject to compromise.
</p>

<p>
It is often desireable to deploy the Convention Leader into a
more protected environment than may be possible for the remote
ActorSystem Convention members and to use the
<b>AllowRemoteActorSources</b> capability to restrict the use of
newly loaded Actor Sources to only those Sources loaded on the
Convention Leader system.
</p></dd>

<dt><b>Actor Hijacking</b></dt><dd>e.g. sql injection attacks, buffer overrun,
etc.  These are the responsibility of the Actor developer, but
remember the guideline: "Fail Early, Fail Often."</dd>
</dl>
</div>

<div id="outline-container-hH-fcabc7dd-327f-47cf-bcb7-5dd4d202ebdc" class="outline-4">
<h4 id="hH-fcabc7dd-327f-47cf-bcb7-5dd4d202ebdc"><span class="section-number-4">11.1.1.</span> Security Scenarios</h4>
<div class="outline-text-4" id="text-hH-fcabc7dd-327f-47cf-bcb7-5dd4d202ebdc">
<p>
On any particular host where an ActorSystem is running, the primary
focus is on protecting that ActorSystem to prevent injection of code
by malicious users.  It is assumed that the users do not have root
access.
</p>

<p>
On systems where a user has local root access but that user is not a
trusted user for the entire environment, the user's influence through
the ActorSystem should be restricted to only the system they have
access to.  The <i>Convention Source Injection</i> protection describe
above assists in this case.
</p>
</div>
</div>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1" role="doc-backlink">1</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
The PEP302 Python extension specification defines the
ability to add a custom package finder/loader that coordinates with
the Python <code>import</code> statement.  The Thespian <code>loadActorSource</code>
implements a PEP302-compliant package manager.  All loaded packages
are prefixed with their source hash to ensure namespace uniqueness.
</p></div></div>

<div class="footdef"><sup><a id="fn.2" class="footnum" href="#fnr.2" role="doc-backlink">2</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
Note that this can result in behavioral
differences between in-process and multi-process ActorSystems:
unloaded sources are still present in still-existing multi-process
Actors and so import statements and other references will still
succeed in those Actors even after the source has been unloaded.  In
general it is recommended that all Actors running within a loaded
source have exited before the source is unloaded, so this behavioral
difference will remain unaddressed.
</p></div></div>


</div>
</div></div>
<div id="postamble" class="status">
<p class="author">Author: Kevin Quick &lt;kq1quick@gmail.com&gt;</p>
<p class="date">Created: 2025-02-03 Mon 18:20</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
